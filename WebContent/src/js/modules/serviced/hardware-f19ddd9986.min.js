!function(){$.MsgBox={Alert:function(t,e,a){n("alert",t,e),r(a),s()},Judge:function(t,e,a){n("judge",t,e),i(a),s()},Confirm:function(t,e,a){n("confirm",t,e),r(a),s()},Prompt:function(t,e,a){n("prompt",t,e),r(a),s()},Remind:function(t,e,a){n("remind",t,e),r(a),s()}};var n=function(t,e,a){var n="";n+='<div id="mb_box"></div><div id="mb_con"><span id="mb_tit">'+e+"</span>",n+='<a id="mb_ico"></a><div id="mb_msg">'+a+'</div><div id="mb_btnbox">',"alert"==t&&(n+='<input id="mb_btn_ok" type="button" value="确定" />'),"judge"==t&&(n+='<input id="mb_jug_ok" type="button" value="确定" />'),"confirm"==t&&(n+='<input id="mb_btn_ok" type="button" value="是" />',n+='<input id="mb_btn_no" type="button" value="否" />'),"prompt"==t&&(n+='<span style="display:inline-block;width:100%;height:27px;background:#00aeef"></span>'),"remind"==t&&(n+='<span style="display:inline-block;width:100%;height:27px;background:#fff;margin-top: -1px;"></span>'),n+="</div></div>",$("body").append(n),o()},o=function(){$("#mb_box").css({width:"100%",height:"100%",zIndex:"99999",position:"fixed",filter:"Alpha(opacity=60)",backgroundColor:"rgba(10%,20%,30%,0.6)",top:"0",left:"0",opacity:"0.6"}),$("#mb_con").css({zIndex:"999999",width:"355px",height:"189px",position:"fixed",backgroundColor:"White",borderRadius:"",border:"1px solid #fff"}),$("#mb_tit").css({display:"block",fontSize:"16px",color:"#444",padding:"2px 15px",backgroundColor:"#00aeef",borderRadius:"",borderBottom:"",fontWeight:"normal",fontFamily:"microsoft yahei"}),$("#mb_msg").css({height:"60px",lineHeight:"125px",fontSize:"13px",textAlign:"center",fontSize:"16px",fontFamily:"microsoft yahei"}),$("#mb_msg p").css({height:"30px",lineHeight:"30px",width:"350px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}),$("#mb_btnbox").css({margin:"75px 0 0",textAlign:"center",background:"#00aeef",paddingTop:"1px"}),$("#mb_btn_ok,#mb_jug_ok,#mb_btn_no").css({width:"60px",height:"28px",color:"#000",border:"1px solid #fff",borderRadius:"3px",background:"#00aeef",fontSize:"14px",fontFamily:"microsoft yahei"}),$("#mb_btn_ok,#mb_jug_ok").css({backgroundColor:"#00aeef"}),$("#mb_btn_no").css({backgroundColor:"#00aeef",marginLeft:"20px"}),$("#mb_ico").hover(function(){$(this).css({backgroundColor:"Red",color:"White"})},function(){$(this).css({backgroundColor:"#DDD",color:"black"})});var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,a=$("#mb_con").width(),n=$("#mb_con").height();$("#mb_con").css({top:(e-n)/2+"px",left:(t-a)/2+"px"})},r=function(t){$("#mb_btn_ok").click(function(){$("#mb_box,#mb_con").remove(),"function"==typeof t&&t()})},i=function(t){$("#mb_jug_ok").click(function(){$("#mb_box,#mb_con").remove(),"function"==typeof t&&t()})},s=function(){$("#mb_btn_no,#mb_ico").click(function(){$("#mb_box,#mb_con").remove()})}}();var statusNumMap={"交付":"1","尾款":"2","完结":"3"};function pageStyle(t,e,a){a=a||"",1==e?$("#fistPage"+a+", #upPage"+a+", #nextPage"+a+", #lastPage"+a+", #Gotojump"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"):1==t?($("#fistPage"+a+", #upPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#lastPage"+a+", #nextPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):t==e?($("#lastPage"+a+", #nextPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):$("#lastPage"+a+", #nextPage"+a+", #fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")}function Check(t){"singleSelect"==t?($(".select2").hide(),$(".select-content").css("margin-left","33%")):($(".select2").show(),$(".select-content").css("margin-left","23%"))}function INSearch(){$("#search").val("search"),$("#top_text_from").submit()}function Cancel(){$("#search").val("cancel"),$('input[name="searchContent1"]').val(""),$('input[name="searchContent2"]').val(""),$("#top_text_from").submit()}function AddContract(){$("[id^='add_info_']").each(function(){$(this).val(""),$(this).is("#add_info_InstalledTime")&&$(this).val(globalGetToday(!1))}),$(".MailBar_cover_color, .contract_add").slideDown(200)}function FistPage(t){"GetHardwareRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+"1"),$("#top_text_from").submit()):window.location.href=t+"1"}function UpPage(t){"GetHardwareRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t),$("#top_text_from").submit()):window.location.href=t}function NextPage(t){"GetHardwareRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t),$("#top_text_from").submit()):window.location.href=t}function PageJump(t){var e=document.getElementById("jumpNumber").value;null==e||0==e?e=$("#currentPage").html():e>parseInt($("#allPage").html())&&(e=$("#allPage").html()),"GetHardwareRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+e),$("#top_text_from").submit()):window.location.href=t+e}function LastPage(t){var e=parseInt($("#allPage").html());"GetHardwareRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+e),$("#top_text_from").submit()):window.location.href=t+e}"singleSelect"==$('input[name="selected"]:checked').val()?$(".select-content").css("margin-left","33%"):$(".select-content").css("margin-left","23%"),$("#searchContent1").keypress(function(t){$("#search").val("search"),"13"==(t.keyCode?t.keyCode:t.which)&&$("#top_text_from").submit()}),$("#searchContent2").keypress(function(t){$("#search").val("search"),"13"==(t.keyCode?t.keyCode:t.which)&&$("#top_text_from").submit()}),$(document).on("click","#contract_add_submit",function(){var t;if(null==(t=_.find(statusNumMap,function(t,e,a){return e==$("#add_info_Status").val().trim()}))&&(t=$("#add_info_Status").val().trim()),""==t||"--"==t)return $.MsgBox_Unload.Alert("提示","项目状态未填或未选！"),!1;var e=$("#add_info_InstalledTime").val(),a=$("#add_info_Customer").val().trim();if(""==a||"--"==a)return $.MsgBox_Unload.Alert("提示","客户未填！"),!1;var n=$("#add_info_ResponsibleAndProcess").val().trim(),o=$(".contract_add .appendp_p_div tbody>tr");if(0==o.length)return $.MsgBox_Unload.Alert("提示","请至少添加一条详情！"),!1;if(""==$(".contract_add .appendp_p_div tbody>tr:last").find(".progress_detail").text().trim())return $.MsgBox_Unload.Alert("提示","最新进展未填写内容！"),!1;var r=[];o.each(function(){var t={};t.CurrentProgress=$(this).find(".progress_detail").text().trim(),t.Date=$(this).find(".progress_detail_time>input").val(),r.push(t)});var i=[];i.push(_.last(r));var s=JSON.stringify(i),c=JSON.stringify(r),l=$(this);$.ajax({type:"POST",url:"HardwareOperate",data:{InstalledTime:e,Customer:a,Status:t,ResponsibleAndProcess:n,Classify:"Add",LatestProgress:s,CurrentProgress:c},dataType:"json",beforeSend:function(t){eouluGlobal.C_btnDisabled(l,!0,"正在提交...")},success:function(t){$.MsgBox.Alert("提示","添加成功"),$("#contract_add_cancel").trigger("click")},error:function(){$.MsgBox.Alert("提示","服务器繁忙，稍后重试！")},complete:function(t,e){eouluGlobal.C_btnAbled(l,!0,"提交")}})}),$(document).on("click",".contract-edit",function(){$(".MailBar_cover_color, .contract_update").slideDown(200);var a=$(this).parent();$("[id^='update_info_']").each(function(){var t=$(this).attr("id").replace("update_info_","td_"),e=globalDataHandle(a.find("."+t).text(),"");$(this).val(e)});var t=a.find("td").eq(0).attr("value");$(".contract_update .contract_update_title").attr("value",t);var e=a.find(".td_LatestProgress").data("currentprogress"),n="";_.forEach(e,function(t,e,a){0<e&&(console.log("大于0"),n+='<tr><td class="xuhao" value="'+t.ID+'"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span><span class="span_num">'+e+'</span></td><td class="progress_detail" contenteditable="true">'+t.CurrentProgress+'</td><td class="progress_detail_time"><input type="date" class="form-control" value="'+t.Date+'"></td></tr>')}),$(".contract_update .appendp_p_div tbody").empty().append(n)}),$("#contract_update_submit").click(function(){var t,e=$(".contract_update .contract_update_title").attr("value");if(null==(t=_.find(statusNumMap,function(t,e,a){return e==$("#update_info_Status").val().trim()}))&&(t=$("#update_info_Status").val().trim()),""==t||"--"==t)return $.MsgBox_Unload.Alert("提示","项目状态未填或未选！"),!1;var a=$("#update_info_InstalledTime").val(),n=$("#update_info_Customer").val().trim();if(""==n||"--"==n)return $.MsgBox_Unload.Alert("提示","客户未填！"),!1;var o=$("#update_info_ResponsibleAndProcess").val().trim(),r=$(".contract_update .appendp_p_div tbody>tr");if(0==r.length)return $.MsgBox_Unload.Alert("提示","请至少添加一条详情！"),!1;if(""==$(".contract_update .appendp_p_div tbody>tr:last").find(".progress_detail").text().trim())return $.MsgBox_Unload.Alert("提示","最新进展未填写内容！"),!1;var i=[];r.each(function(){var t={};t.CurrentProgress=$(this).find(".progress_detail").text().trim(),t.Date=$(this).find(".progress_detail_time>input").val(),i.push(t)});var s=[];s.push(_.last(i));var c=JSON.stringify(s),l=JSON.stringify(i),d=$(this);$.ajax({type:"POST",url:"HardwareOperate",data:{ID:e,InstalledTime:a,Customer:n,Status:t,ResponsibleAndProcess:o,Classify:"Modify",LatestProgress:c,CurrentProgress:l},dataType:"json",beforeSend:function(t){eouluGlobal.C_btnDisabled(d,!0,"正在提交...")},success:function(t){$.MsgBox.Alert("提示","修改成功"),$("#contract_update_cancel").trigger("click")},error:function(){$.MsgBox.Alert("提示","服务器繁忙，稍后重试！")},complete:function(t,e){eouluGlobal.C_btnAbled(d,!0,"提交")}})}),$(document).on("click","#mb_btn_ok",function(){window.location.reload()}),$(".contract_add_title>span.glyphicon, #contract_add_cancel").click(function(){$(".MailBar_cover_color, .contract_add").slideUp(200)}),$(".contract_update_title>span.glyphicon, #contract_update_cancel").click(function(){$(".MailBar_cover_color, .contract_update").slideUp(200)}),$("span.add_line_p, span.update_line_p").click(function(){var t=$(this).parent().next().find("tbody"),e='<tr><td class="xuhao"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span><span class="span_num">'+(t.children("tr").length+1)+'</span></td><td class="progress_detail" contenteditable="true"></td><td class="progress_detail_time"><input type="date" class="form-control" value="'+globalGetToday(!1)+'"></td></tr>';t.append(e)}),$(document).on("click",".appendp_p_div .xuhao>span.glyphicon",function(){var t=$(this).parents("tbody");$(this).parent().parent().remove(),t.children("tr").each(function(t,e){$(e).find("span.span_num").text(t+1)})}),$(function(){$("td.td_Status").each(function(){var t=$(this).attr("value");switch(t){case"1":$(this).text("交付");break;case"2":$(this).text("尾款");break;case"3":$(this).text("完结");break;default:$(this).text(t)}}),$("td.td_LatestProgress").each(function(){var t=$(this).data("latestprogress");if("string"==typeof t)""==t?$(this).text("未填写最新进展").attr("title","未填写最新进展"):$(this).text(t).attr("title",t);else{var e=t[0].Date+(""==t[0].Date?"":"：")+t[0].CurrentProgress;$(this).text(e).attr("title",e)}}),pageStyle(Number($("#currentPage").html()),Number($("#allPage").html()),"");var t=new Awesomplete(".contract_add input.form-control.dropdown-input",{minChars:0,list:["交付","尾款","完结"]});$(".contract_add button.awesomplete_btn").click(function(){0===t.ul.childNodes.length?(t.minChars=0,t.evaluate()):t.ul.hasAttribute("hidden")?t.open():t.close()});var a=new Awesomplete(".contract_update input.form-control.dropdown-input",{minChars:0,list:["交付","尾款","完结"]});$(".contract_update button.awesomplete_btn").each(function(t,e){e.addEventListener("click",function(){0===a.ul.childNodes.length?(a.minChars=0,a.evaluate()):a.ul.hasAttribute("hidden")?a.open():a.close()})})}),$(document).on("click",".del",function(){var t=$(this).parent().parent().find("td").eq(0).attr("value");$(".yejiao").attr("value",t),console.log(t),$.ajax({type:"get",url:"QualityDelete",data:{ID:t},dataType:"json",success:function(t){$.MsgBox.Alert("提示","删除成功"),$(".MailBar_cover_color").hide(),$(".hidePdf").hide()},error:function(){$.MsgBox.Alert("提示","服务器繁忙，稍后重试！")}});var e=$(this);$.MsgBox.Confirm("提示","确认要删除吗？",function(){e.parents("tr").remove()})});