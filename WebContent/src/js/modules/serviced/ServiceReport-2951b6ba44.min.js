!function(){function g(t,e){this.x=t,this.y=e,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var i=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*i(this.y);else if(0===this.y)this._length=t,this.x=t*i(this.x);else{var e=Math.abs(this.y/this.x),n=Math.sqrt(Math.pow(t,2)/(1+Math.pow(e,2)));e=e*n;this._length=t,this.x=n*i(this.x),this.y=e*i(this.y)}return this},this.angleTo=function(t){var e=this.getLength()*t.getLength();return 0===e?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/e,-1),1))/Math.PI}}function f(t,e){this.x=t,this.y=e,this.getVectorToCoordinates=function(t,e){return new g(t-this.x,e-this.y)},this.getVectorFromCoordinates=function(t,e){return this.getVectorToCoordinates(t,e).reverse()},this.getVectorToPoint=function(t){return new g(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function c(t,e,n,i,a){if(this.data=t,this.context=e,t.length)for(var r,o,s=t.length,l=0;l<s;l++){o=(r=t[l]).x.length,n.call(e,r);for(var d=1;d<o;d++)i.call(e,r,d);a.call(e,r)}this.changed=function(){},this.startStrokeFn=n,this.addToStrokeFn=i,this.endStrokeFn=a,this.inStroke=!1,this._stroke=this._lastPoint=null,this.startStroke=function(t){if(t&&"number"==typeof t.x&&"number"==typeof t.y){this._stroke={x:[t.x],y:[t.y]},this.data.push(this._stroke),this._lastPoint=t,this.inStroke=!0;var e=this._stroke,n=this.startStrokeFn,i=this.context;return setTimeout(function(){n.call(i,e)},3),t}return null},this.addToStroke=function(t){if(this.inStroke&&"number"==typeof t.x&&"number"==typeof t.y&&4<Math.abs(t.x-this._lastPoint.x)+Math.abs(t.y-this._lastPoint.y)){var e=this._stroke.x.length;this._stroke.x.push(t.x),this._stroke.y.push(t.y),this._lastPoint=t;var n=this._stroke,i=this.addToStrokeFn,a=this.context;return setTimeout(function(){i.call(a,n,e)},3),t}return null},this.endStroke=function(){var t=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,t){var e=this._stroke,n=this.endStrokeFn,i=this.context,a=this.changed;return setTimeout(function(){n.call(i,e),a.call(i)},3),!0}return null}}function b(t,e,n){var i=this.$parent=$(t);t=this.eventTokens={},this.events=new m(this);var a,r,o=$.fn.jSignature("globalEvents"),s={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[],signatureLine:!1};for(var l in $.extend(s,function(t){var e,n,i,a,r=t.css("color");t=t[0];for(var o=!1;t&&!n&&!o;){try{e=$(t).css("background-color")}catch(t){e="transparent"}"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e&&(n=e),o=t.body,t=t.parentNode}return t=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,o=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,e=void 0,(e=r.match(t))?i={r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}:(e=r.match(o))&&(i={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}),n?(e=void 0,(e=n.match(t))?a={r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}:(e=n.match(o))&&(a={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)})):a=i&&127<Math.max.apply(null,[i.r,i.g,i.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255},e=function(t){return"rgb("+[t.r,t.g,t.b].join(", ")+")"},i&&a?(t=Math.max.apply(null,[i.r,i.g,i.b]),i=Math.max.apply(null,[a.r,a.g,a.b]),i={r:i=Math.round(i+-.75*(i-t)),g:i,b:i}):i?(t=1,127<(i=Math.max.apply(null,[i.r,i.g,i.b]))&&(t=-1),i={r:i=Math.round(i+96*t),g:i,b:i}):i={r:191,g:191,b:191},{color:r,"background-color":a?e(a):n,"decor-color":e(i)}}(i)),e&&$.extend(s,e),this.settings=s,n)n.hasOwnProperty(l)&&n[l].call(this,l);return this.events.publish("jSignature.initializing"),this.$controlbarUpper=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(i),this.isCanvasEmulator=!1,e=this.canvas=this.initializeCanvas(s),n=$(e),this.$controlbarLower=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important; position: relative;"></div>').appendTo(i),this.canvasContext=e.getContext("2d"),n.data("jSignature.this",this),s.lineWidth=(a=s.lineWidth,r=e.width,a||Math.max(Math.round(r/400),2)),this.lineCurveThreshold=3*s.lineWidth,s.cssclass&&""!=$.trim(s.cssclass)&&n.addClass(s.cssclass),this.fatFingerCompensation=0,i=function(n){var i,a,r=function(t){return t=t.changedTouches&&0<t.changedTouches.length?t.changedTouches[0]:t,new f(Math.round(t.pageX+i),Math.round(t.pageY+a)+n.fatFingerCompensation)},o=new d(750,function(){n.dataEngine.endStroke()});return this.drawEndHandler=function(t){if(!n.settings.readOnly){try{t.preventDefault()}catch(t){}o.clear(),n.dataEngine.endStroke()}},this.drawStartHandler=function(t){if(!n.settings.readOnly){t.preventDefault();var e=$(n.canvas).offset();i=-1*e.left,a=-1*e.top,n.dataEngine.startStroke(r(t)),o.kick()}},this.drawMoveHandler=function(t){n.settings.readOnly||(t.preventDefault(),n.dataEngine.inStroke&&(n.dataEngine.addToStroke(r(t)),o.kick()))},this}.call({},this),function(e,n,i){var a=this.canvas,t=$(a);this.isCanvasEmulator?(t.bind("mousemove.jSignature",i),t.bind("mouseup.jSignature",e),t.bind("mousedown.jSignature",n)):(a.ontouchstart=function(t){a.onmousedown=a.onmouseup=a.onmousemove=void 0,this.fatFingerCompensation=s.minFatFingerCompensation&&-3*s.lineWidth>s.minFatFingerCompensation?-3*s.lineWidth:s.minFatFingerCompensation,n(t),a.ontouchend=e,a.ontouchstart=n,a.ontouchmove=i},a.onmousedown=function(t){a.ontouchstart=a.ontouchend=a.ontouchmove=void 0,n(t),a.onmousedown=n,a.onmouseup=e,a.onmousemove=i},window.navigator.msPointerEnabled&&(a.onmspointerdown=n,a.onmspointerup=e,a.onmspointermove=i))}.call(this,i.drawEndHandler,i.drawStartHandler,i.drawMoveHandler),t["jSignature.windowmouseup"]=o.subscribe("jSignature.windowmouseup",i.drawEndHandler),this.events.publish("jSignature.attachingEventHandlers"),function(u,t,c,h){var p,g,f;"ratio"!==t&&"%"!==t.split("")[t.length-1]||(this.eventTokens[c+".parentresized"]=h.subscribe(c+".parentresized",(p=this.eventTokens,g=this.$parent,f=this.$parent.width(),this.canvas.width,this.canvas.height,function(){if((l=g.width())!==f){for(var t in p)p.hasOwnProperty(t)&&(h.unsubscribe(p[t]),delete p[t]);var e=u.settings;for(t in u.$parent.children().remove(),u)u.hasOwnProperty(t)&&delete u[t];t=e.data;var n,i,a,r,o,s,l=1*l/f,d=[];for(i=0,a=t.length;i<a;i++){for(n={x:[],y:[]},r=0,o=(s=t[i]).x.length;r<o;r++)n.x.push(s.x[r]*l),n.y.push(s.y[r]*l);d.push(n)}e.data=d,g[c](e)}})))}.call(this,this,s.width.toString(10),"jSignature",o),this.resetCanvas(s.data),this.events.publish("jSignature.initialized"),this}var d=function(t,e){var n;return this.kick=function(){clearTimeout(n),n=setTimeout(e,t)},this.clear=function(){clearTimeout(n)},this},m=function(t){this.topics={},this.context=t||this,this.publish=function(t,e,n,i){if(this.topics[t]){var a,r,o,s,l=this.topics[t],d=Array.prototype.slice.call(arguments,1),u=[],c=[];for(r=0,o=l.length;r<o;r++)a=(s=l[r])[0],s[1]&&(s[0]=function(){},u.push(r)),c.push(a);for(r=0,o=u.length;r<o;r++)l.splice(u[r],1);for(r=0,o=c.length;r<o;r++)c[r].apply(this.context,d)}},this.subscribe=function(t,e,n){return this.topics[t]?this.topics[t].push([e,n]):this.topics[t]=[[e,n]],{topic:t,callback:e}},this.unsubscribe=function(t){if(this.topics[t.topic])for(var e=this.topics[t.topic],n=0,i=e.length;n<i;n++)e[n]&&e[n][0]===t.callback&&e.splice(n,1)}},v=function(t,e,n,i,a){t.beginPath(),t.moveTo(e,n),t.lineTo(i,a),t.closePath(),t.stroke()},h=function(t){var e=this.canvasContext,n=t.x[0];t=t.y[0];var i=this.settings.lineWidth,a=e.fillStyle;e.fillStyle=e.strokeStyle,e.fillRect(n+i/-2,t+i/-2,i,i),e.fillStyle=a},p=function(t,e){var n,i=new f(t.x[e-1],t.y[e-1]),a=new f(t.x[e],t.y[e]),r=i.getVectorToPoint(a);if(1<e&&(u=(p=new f(t.x[e-2],t.y[e-2])).getVectorToPoint(i)).getLength()>this.lineCurveThreshold){n=2<e?new f(t.x[e-3],t.y[e-3]).getVectorToPoint(p):new g(0,0);var o=.35*u.getLength(),s=u.angleTo(n.reverse()),l=r.angleTo(u.reverse());n=new g(n.x+u.x,n.y+u.y).resizeTo(Math.max(.05,s)*o);var d=new g(u.x+r.x,u.y+r.y).reverse().resizeTo(Math.max(.05,l)*o),u=this.canvasContext,c=(o=p.x,l=p.y,s=i.x,i.y),h=p.x+n.x,p=p.y+n.y;n=i.x+d.x,d=i.y+d.y,u.beginPath(),u.moveTo(o,l),u.bezierCurveTo(h,p,n,d,s,c),u.closePath(),u.stroke()}r.getLength()<=this.lineCurveThreshold&&v(this.canvasContext,i.x,i.y,a.x,a.y)},x=function(t){if(0<(a=t.x.length-1)){var e=new f(t.x[a],t.y[a]);if((i=(l=new f(t.x[a-1],t.y[a-1])).getVectorToPoint(e)).getLength()>this.lineCurveThreshold)if(1<a){var n=new g((t=new f(t.x[a-2],t.y[a-2]).getVectorToPoint(l)).x+i.x,t.y+i.y).resizeTo(i.getLength()/2),i=this.canvasContext;t=l.x;var a=l.y,r=e.x,o=e.y,s=l.x+n.x,l=l.y+n.y;n=e.x,e=e.y;i.beginPath(),i.moveTo(t,a),i.bezierCurveTo(s,l,n,e,r,o),i.closePath(),i.stroke()}else v(this.canvasContext,l.x,l.y,e.x,e.y)}};b.prototype.resetCanvas=function(t,e){var n,i,a=this.canvas,r=this.settings,o=this.canvasContext,s=this.isCanvasEmulator,l=a.width,d=a.height;if(e||o.clearRect(0,0,l+30,d+30),o.shadowColor=o.fillStyle=r["background-color"],s&&o.fillRect(0,0,l+30,d+30),o.lineWidth=Math.ceil(parseInt(r.lineWidth,10)),o.lineCap=o.lineJoin="round",r.signatureLine){if(null!=r["decor-color"]){o.strokeStyle=r["decor-color"],o.shadowOffsetX=0,o.shadowOffsetY=0;var u=Math.round(d/5);v(o,1.5*u,d-u,l-1.5*u,d-u)}s||(o.shadowColor=o.strokeStyle,o.shadowOffsetX=.5*o.lineWidth,o.shadowOffsetY=-.6*o.lineWidth,o.shadowBlur=0)}return o.strokeStyle=r.color,t||(t=[]),o=this.dataEngine=new c(t,this,h,p,x),r.data=t,$(a).data("jSignature.data",t).data("jSignature.settings",r),o.changed=(n=this.$parent,i=this.events,function(){i.publish("jSignature.change"),n.trigger("change")}),o.changed(),!0},b.prototype.initializeCanvas=function(t){var e=document.createElement("canvas"),n=$(e);return t.width===t.height&&"ratio"===t.height&&(t.width="100%"),n.css({margin:0,padding:0,border:"none",height:"ratio"!==t.height&&t.height?t.height.toString(10):1,width:"ratio"!==t.width&&t.width?t.width.toString(10):1,"-ms-touch-action":"none","touch-action":"none","background-color":t["background-color"]}),n.appendTo(this.$parent),"ratio"===t.height?n.css("height",Math.round(n.width()/t.sizeRatio)):"ratio"===t.width&&n.css("width",Math.round(n.height()*t.sizeRatio)),n.addClass("jSignature"),e.width=n.width(),e.height=n.height(),this.isCanvasEmulator=function(t){if(t.getContext)return!1;var e=t.ownerDocument.parentWindow,n=e.FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(n){if(t=n.initElement(t),n=1,e&&e.screen&&e.screen.deviceXDPI&&e.screen.logicalXDPI&&(n=1*e.screen.deviceXDPI/e.screen.logicalXDPI),1!==n)try{$(t).children("object").get(0).resize(Math.ceil(t.width*n),Math.ceil(t.height*n)),t.getContext("2d").scale(n,n)}catch(t){}return!0}throw Error("Canvas element does not support 2d context. jSignature cannot proceed.")}(e),e.onselectstart=function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1},e},function(t){function e(t,e,n){var i=new Image,a=this;i.onload=function(){var t=a.getContext("2d"),e=t.shadowColor;t.shadowColor="transparent",t.drawImage(i,0,0,i.width<a.width?i.width:a.width,i.height<a.height?i.height:a.height),t.shadowColor=e},i.src="data:"+e+","+t}function n(t,e){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").resetCanvas(t,e),this}function i(t,e){if(void 0!==e||"string"!=typeof t||"data:"!==t.substr(0,5)||(e=t.slice(5).split(",")[0])!==(t=t.slice(6+e.length))){var n,i=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(!h.hasOwnProperty(e))throw Error("jSignature is unable to find import plugin with for format '"+String(e)+"'");return 0!==i.length&&h[e].call(i[0],t,e,(n=i.data("jSignature.this"),function(){return n.resetCanvas.apply(n,arguments)})),this}}var a,r,o,s,l,d=new m;a=d,r="jSignature",o=$,l=function(){a.publish(r+".parentresized")},o(t).bind("resize."+r,function(){s&&clearTimeout(s),s=setTimeout(l,500)}).bind("mouseup."+r,function(t){a.publish(r+".windowmouseup")});var u={},c={default:function(t){return this.toDataURL()},native:function(t){return t},image:function(t){if("string"==typeof(t=this.toDataURL())&&4<t.length&&"data:"===t.slice(0,5)&&-1!==t.indexOf(",")){var e=t.indexOf(",");return[t.slice(5,e),t.substr(e+1)]}return[]}},h={native:function(t,e,n){n(t)},image:e,"image/png;base64":e,"image/jpeg;base64":e,"image/jpg;base64":e},p=function(t){var e=!1;for(t=t.parentNode;t&&!e;)e=t.body,t=t.parentNode;return!e},g={export:c,import:h,instance:u},f={init:function(t){return this.each(function(){p(this)||new b(this,t,u)})},destroy:function(){return this.each(function(){if(!p(this)){var t=$(this).find("canvas").data("jSignature.this");t&&(t.$controlbarLower.remove(),t.$controlbarUpper.remove(),$(t.canvas).remove())}})},getSettings:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").settings},isModified:function(){return null!==this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").dataEngine._stroke},updateSetting:function(t,e,n){var i=this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this");return i.settings[t]=e,i.resetCanvas(n?null:i.settings.data,!0),i.settings[t]},clear:n,reset:n,addPlugin:function(t,e,n){return g.hasOwnProperty(t)&&(g[t][e]=n),this},listPlugins:function(t){var e=[];if(g.hasOwnProperty(t))for(var n in t=g[t])t.hasOwnProperty(n)&&e.push(n);return e},getData:function(t){var e=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(void 0===t&&(t="default"),0!==e.length&&c.hasOwnProperty(t))return c[t].call(e.get(0),e.data("jSignature.data"),e.data("jSignature.settings"))},importData:i,setData:i,globalEvents:function(){return d},disable:function(){this.find("input").attr("disabled",1),this.find("canvas.jSignature").addClass("disabled").data("jSignature.this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled"),this.find("canvas.jSignature").removeClass("disabled").data("jSignature.this").settings.readOnly=!1},events:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").events}};$.fn.jSignature=function(t){return t&&"object"!=typeof t?"string"==typeof t&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):void $.error("Method "+String(t)+" does not exist on jQuery.jSignature"):f.init.apply(this,arguments)}}(window)}(),$.fn.jSignature("addPlugin","instance","UndoButton",function(e){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[e]){var t=this.settings[e];"function"!=typeof t&&(t=function(){var t=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),e=t.width();return t.css("left",Math.round((this.canvas.width-e)/2)),e!==t.width()&&t.width(e),t}),function(t,e,n){var i,a,r,o,s,l,d;t=t.call(this),a=t,r=e,(i=this).events.subscribe(r+".change",function(){i.dataEngine.data.length?a.show():a.hide()}),s=t,l=(o=this).events.topics.hasOwnProperty(e+".undo")?n:e,d=l+".undo",s.bind("click",function(){o.events.publish(d)}),o.events.subscribe(d,function(){var t=o.dataEngine.data;t.length&&(t.pop(),o.resetCanvas(t))})}.call(this,t,"jSignature",e)}})}),function(){for(var l={},d={},t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),u=t.length/2,e=u-1;-1<e;e--)l[t[e]]=t[e+u],d[t[e+u]]=t[e];var n,c=function(t){for(var e=(t=t.split("")).length,n=1;n<e;n++)t[n]=l[t[n]];return t.join("")},r=function(t){for(var e,n,i=[],a=0,r=1,o=t.length,s=0;s<o;s++)n=(e=Math.round(t[s]))-a,a=e,n<0&&0<r?(r=-1,i.push("Z")):0<n&&r<0&&(r=1,i.push("Y")),e=Math.abs(n),u<=e?i.push(c(e.toString(u))):i.push(e.toString(u));return i.join("")},a=function(t){for(var e,n=[],i=(t=t.split("")).length,a=1,r=[],o=0,s=0;s<i;s++)(e=t[s])in l||"Z"===e||"Y"===e?(0!==r.length&&(r=parseInt(r.join(""),u)*a+o,n.push(r),o=r),"Z"===e?(a=-1,r=[]):"Y"===e?(a=1,r=[]):r=[e]):r.push(d[e]);return n.push(parseInt(r.join(""),u)*a+o),n},i=function(t){for(var e,n=[],i=t.length,a=0;a<i;a++)e=t[a],n.push(r(e.x)),n.push(r(e.y));return n.join("_")},o=function(t){for(var e=[],n=(t=t.split("_")).length/2,i=0;i<n;i++)e.push({x:a(t[2*i]),y:a(t[2*i+1])});return e},s=function(t){return["image/jsignature;base30",i(t)]},h=function(t,e,n){"string"==typeof t&&("image/jsignature;base30"===t.substring(0,23).toLowerCase()&&(t=t.substring(24)),n(o(t)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(n=(n=this.jQuery).fn.jSignature)("addPlugin","export","base30",s),n("addPlugin","export","image/jsignature;base30",s),n("addPlugin","import","base30",h),n("addPlugin","import","image/jsignature;base30",h),this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:c,compressstrokeleg:r,uncompressstrokeleg:a,compressstrokes:i,uncompressstrokes:o,charmap:l})}.call("undefined"!=typeof window?window:this),function(){function o(t,e){this.x=t,this.y=e,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var i=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*i(this.y);else if(0===this.y)this._length=t,this.x=t*i(this.x);else{var e=Math.abs(this.y/this.x),n=Math.sqrt(Math.pow(t,2)/(1+Math.pow(e,2)));e=e*n;this._length=t,this.x=n*i(this.x),this.y=e*i(this.y)}return this},this.angleTo=function(t){var e=this.getLength()*t.getLength();return 0===e?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/e,-1),1))/Math.PI}}function s(t,e){this.x=t,this.y=e,this.getVectorToCoordinates=function(t,e){return new o(t-this.x,e-this.y)},this.getVectorFromCoordinates=function(t,e){return this.getVectorToCoordinates(t,e).reverse()},this.getVectorToPoint=function(t){return new o(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function l(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}function a(t,e,n){e+=1;var i=new s(t.x[e-1],t.y[e-1]),a=new s(t.x[e],t.y[e]),r=(a=i.getVectorToPoint(a),new s(t.x[e-2],t.y[e-2]));return(i=r.getVectorToPoint(i)).getLength()>n?(n=2<e?new s(t.x[e-3],t.y[e-3]).getVectorToPoint(r):new o(0,0),t=.35*i.getLength(),r=i.angleTo(n.reverse()),e=a.angleTo(i.reverse()),n=new o(n.x+i.x,n.y+i.y).resizeTo(Math.max(.05,r)*t),a=new o(i.x+a.x,i.y+a.y).reverse().resizeTo(Math.max(.05,e)*t),a=new o(i.x+a.x,i.y+a.y),["c",l(n.x,2),l(n.y,2),l(a.x,2),l(a.y,2),l(i.x,2),l(i.y,2)]):["l",l(i.x,2),l(i.y,2)]}function p(t,e,n){e=["M",l(t.x[0]-e,2),l(t.y[0]-n,2)],n=1;for(var i=t.x.length-1;n<i;n++)e.push.apply(e,a(t,n,1));return 0<i?e.push.apply(e,function(t,e){var n=t.x.length-1,i=new s(t.x[n],t.y[n]);if(i=(a=new s(t.x[n-1],t.y[n-1])).getVectorToPoint(i),1<n&&i.getLength()>e){n=new s(t.x[n-2],t.y[n-2]).getVectorToPoint(a);var a=i.angleTo(n.reverse()),r=.35*i.getLength();return["c",l((n=new o(n.x+i.x,n.y+i.y).resizeTo(Math.max(.05,a)*r)).x,2),l(n.y,2),l(i.x,2),l(i.y,2),l(i.x,2),l(i.y,2)]}return["l",l(i.x,2),l(i.y,2)]}(t,n)):0===i&&e.push.apply(e,["l",1,1]),e.join(" ")}function g(t){for(var e=[],n=[["fill",void 0,"none"],["stroke","color","#000000"],["stroke-width","lineWidth",2],["stroke-linecap",void 0,"round"],["stroke-linejoin",void 0,"round"]],i=n.length-1;0<=i;i--){var a=n[i][1],r=n[i][2];e.push(n[i][0]+'="'+(a in t&&t[a]?t[a]:r)+'"')}return e.join(" ")}function n(t,e){var n,i,a=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],r=t.length,o=[],s=[],l=i=n=0,d=0,u=[];if(0!==r){for(n=0;n<r;n++){var c,h;for(d=[],i={x:[],y:[]},c=0,h=(l=t[n]).x.length;c<h;c++)d.push({x:l.x[c],y:l.y[c]});for(c=0,h=(d=simplify(d,.7,!0)).length;c<h;c++)i.x.push(d[c].x),i.y.push(d[c].y);u.push(i),o=o.concat(i.x),s=s.concat(i.y)}r=Math.min.apply(null,o)-1,n=Math.max.apply(null,o)+1,l=r<0?0:r,d=(o=Math.min.apply(null,s)-1)<0?0:o,n-=r,i=(s=Math.max.apply(null,s)+1)-o}for(a.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+n.toString()+'" height="'+i.toString()+'">'),n=0,r=u.length;n<r;n++)i=u[n],a.push("<path "+g(e)+' d="'+p(i,l,d)+'"/>');return a.push("</svg>"),a.join("")}function t(t,e){return["image/svg+xml",n(t,e)]}function e(t,e){return["image/svg+xml;base64",i(n(t,e))]}if(function(t,y){"use strict";(typeof exports!=y+""?exports:t).simplify=function(t,e,n){if(e=e!==y?e*e:1,!n){var i,a=t.length,r=[l=t[0]];for(n=1;n<a;n++){var o=(i=t[n]).x-l.x,s=i.y-l.y;e<o*o+s*s&&(r.push(i),l=i)}l!==i&&r.push(i),t=r}r=(n=(i=t).length)-1;var l,d,u,c=[],h=[],p=[];for((a=new(typeof Uint8Array!=y+""?Uint8Array:Array)(n))[l=0]=a[r]=1;r;){for(s=0,o=l+1;o<r;o++){d=i[o];var g,f=i[l],b=i[r],m=f.x,v=f.y,x=(f=b.x-m,b.y-v);0===f&&0===x||(1<(g=((d.x-m)*f+(d.y-v)*x)/(f*f+x*x))?(m=b.x,v=b.y):0<g&&(m+=f*g,v+=x*g)),s<(d=(f=d.x-m)*f+(x=d.y-v)*x)&&(u=o,s=d)}e<s&&(a[u]=1,c.push(l),h.push(u),c.push(u),h.push(r)),l=c.pop(),r=h.pop()}for(o=0;o<n;o++)a[o]&&p.push(i[o]);return t=p}}(window),"function"!=typeof i)var i=function(t){for(var e,n,i,a,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),o=0,s=0,l=[];e=(a=(e=t.charCodeAt(o++))<<16|(n=t.charCodeAt(o++))<<8|(i=t.charCodeAt(o++)))>>18&63,n=a>>12&63,i=a>>6&63,a&=63,l[s++]=r[e]+r[n]+r[i]+r[a],o<t.length;);return r=l.join(""),((t=t.length%3)?r.slice(0,t-3):r)+"===".slice(t||3)};if("undefined"==typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var r;(r=(r=$).fn.jSignature)("addPlugin","export","svg",t),r("addPlugin","export","image/svg+xml",t),r("addPlugin","export","svgbase64",e),r("addPlugin","export","image/svg+xml;base64",e)}(),function(s){var l,d=s(document),u=s("head"),h=null,c={},a=0,p="px",g="JColResizer",i="JCLRFlex",r=parseInt,f=Math,o=0<navigator.userAgent.indexOf("Trident/4.0");try{l=sessionStorage}catch(t){}u.append("<style type='text/css'>  .JColResizer{table-layout:fixed;} .JColResizer > tbody > tr > td, .JColResizer > tbody > tr > th{overflow:hidden;padding-left:0!important; padding-right:0!important;}  .JCLRgrips{ height:0px; position:relative;} .JCLRgrip{margin-left:-5px; position:absolute; z-index:5; } .JCLRgrip .JColResizer{position:absolute;background-color:red;filter:alpha(opacity=1);opacity:0;width:10px;height:100%;cursor: e-resize;top:0px} .JCLRLastGrip{position:absolute; width:1px; } .JCLRgripDrag{ border-left:1px dotted black;\t} .JCLRFlex{width:auto!important;} .JCLRgrip.JCLRdisabledGrip .JColResizer{cursor:default; display:none;}</style>");var b=function(t){var e=t.attr("id");(t=c[e])&&t.is("table")&&(t.removeClass(g+" "+i).gc.remove(),delete c[e])},m=function(a){var t=a.find(">thead>tr:first>th,>thead>tr:first>td");t.length||(t=a.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td")),t=t.filter(":visible"),a.cg=a.find("col"),a.ln=t.length,a.p&&l&&l[a.id]&&v(a,t),t.each(function(t){var e=s(this),n=-1!=a.dc.indexOf(t),i=s(a.gc.append('<div class="JCLRgrip"></div>')[0].lastChild);i.append(n?"":a.opt.gripInnerHtml).append('<div class="'+g+'"></div>'),t==a.ln-1&&(i.addClass("JCLRLastGrip"),a.f&&i.html("")),i.bind("touchstart mousedown",S),n?i.addClass("JCLRdisabledGrip"):i.removeClass("JCLRdisabledGrip").bind("touchstart mousedown",S),i.t=a,i.i=t,(i.c=e).w=e.width(),a.g.push(i),a.c.push(e),e.width(e.w).removeAttr("width"),i.data(g,{i:t,t:a.attr("id"),last:t==a.ln-1})}),a.cg.removeAttr("width"),a.find("td, th").not(t).not("table th, table td").each(function(){s(this).removeAttr("width")}),a.f||a.removeAttr("width").addClass(i),x(a)},v=function(t,e){var n,i,a=0,r=0,o=[];if(e){if(t.cg.removeAttr("width"),t.opt.flush)return void(l[t.id]="");for(i=(n=l[t.id].split(";"))[t.ln+1],!t.f&&i&&(t.width(i*=1),t.opt.overflow&&(t.css("min-width",i+p),t.w=i));r<t.ln;r++)o.push(100*n[r]/n[t.ln]+"%"),e.eq(r).css("width",o[r]);for(r=0;r<t.ln;r++)t.cg.eq(r).css("width",o[r])}else{for(l[t.id]="";r<t.c.length;r++)n=t.c[r].width(),l[t.id]+=n+";",a+=n;l[t.id]+=a,t.f||(l[t.id]+=";"+t.width())}},x=function(t){t.gc.width(t.w);for(var e=0;e<t.ln;e++){var n=t.c[e];t.g[e].css({left:n.offset().left-t.offset().left+n.outerWidth(!1)+t.cs/2+p,height:t.opt.headerOnly?t.c[0].outerHeight(!1):t.outerHeight(!1)})}},y=function(t,e,n){var i=h.x-h.l,a=t.c[e],r=t.c[e+1],o=a.w+i,s=r.w-i;a.width(o+p),t.cg.eq(e).width(o+p),t.f?(r.width(s+p),t.cg.eq(e+1).width(s+p)):t.opt.overflow&&t.css("min-width",t.w+i),n&&(a.w=o,r.w=t.f?s:r.w)},_=function(t){var n=s.map(t.c,function(t){return t.width()});t.width(t.w=t.width()).removeClass(i),s.each(t.c,function(t,e){e.width(n[t]).w=n[t]}),t.addClass(i)},w=function(t){if(h){var e=h.t,n=t.originalEvent.touches,i=(n?n[0].pageX:t.pageX)-h.ox+h.l,a=e.opt.minWidth,r=h.i,o=1.5*e.cs+a+e.b,s=r==e.ln-1,l=r?e.g[r-1].position().left+e.cs+a:o,d=e.f?r==e.ln-1?e.w-o:e.g[r+1].position().left-e.cs-a:1/0;if(i=f.max(l,f.min(d,i)),h.x=i,h.css("left",i+p),s){var u=e.c[h.i];h.w=u.w+i-h.l}if(e.opt.liveDrag){s?(u.width(h.w),!e.f&&e.opt.overflow?e.css("min-width",e.w+i-h.l):e.w=e.width()):y(e,r),x(e);var c=e.opt.onDrag;c&&(t.currentTarget=e[0],c(t))}return!1}},$=function(t){if(d.unbind("touchend."+g+" mouseup."+g).unbind("touchmove."+g+" mousemove."+g),s("head :last-child").remove(),h){if(h.removeClass(h.t.opt.draggingClass),h.x-h.l!=0){var e=h.t,n=e.opt.onResize,i=h.i,a=i==e.ln-1,r=e.g[i].c;a?(r.width(h.w),r.w=h.w):y(e,i,!0),e.f||_(e),x(e),n&&(t.currentTarget=e[0],n(t)),e.p&&l&&v(e)}h=null}},S=function(t){var e=s(this).data(g),n=c[e.t],i=n.g[e.i],a=t.originalEvent.touches;if(i.ox=a?a[0].pageX:t.pageX,i.l=i.position().left,i.x=i.l,d.bind("touchmove."+g+" mousemove."+g,w).bind("touchend."+g+" mouseup."+g,$),u.append("<style type='text/css'>*{cursor:"+n.opt.dragCursor+"!important}</style>"),i.addClass(n.opt.draggingClass),h=i,n.c[e.i].l)for(var r,o=0;o<n.ln;o++)(r=n.c[o]).l=!1,r.w=r.width();return!1};s(window).bind("resize."+g,function(){for(var t in c)if(c.hasOwnProperty(t)){var e,n=0;if((t=c[t]).removeClass(g),t.f){for(t.w=t.width(),e=0;e<t.ln;e++)n+=t.c[e].w;for(e=0;e<t.ln;e++)t.c[e].css("width",f.round(1e3*t.c[e].w/n)/10+"%").l=!0}else _(t),"flex"==t.mode&&t.p&&l&&v(t);x(t.addClass(g))}}),s.fn.extend({colResizable:function(t){switch((t=s.extend({resizeMode:"fit",draggingClass:"JCLRgripDrag",gripInnerHtml:"",liveDrag:!1,minWidth:15,headerOnly:!1,hoverCursor:"e-resize",dragCursor:"e-resize",postbackSafe:!1,flush:!1,marginLeft:null,marginRight:null,disable:!1,partialRefresh:!1,disabledColumns:[],onDrag:null,onResize:null},t)).fixed=!0,t.overflow=!1,t.resizeMode){case"flex":t.fixed=!1;break;case"overflow":t.fixed=!1,t.overflow=!0}return this.each(function(){!function(t,e){var n=s(t);if(n.opt=e,n.mode=e.resizeMode,n.dc=n.opt.disabledColumns,n.opt.disable)return b(n);var i=n.id=n.attr("id")||g+a++;n.p=n.opt.postbackSafe,!n.is("table")||c[i]&&!n.opt.partialRefresh||("e-resize"!==n.opt.hoverCursor&&u.append("<style type='text/css'>.JCLRgrip .JColResizer:hover{cursor:"+n.opt.hoverCursor+"!important}</style>"),n.addClass(g).attr("id",i).before('<div class="JCLRgrips"/>'),n.g=[],n.c=[],n.w=n.width(),n.gc=n.prev(),n.f=n.opt.fixed,e.marginLeft&&n.gc.css("marginLeft",e.marginLeft),e.marginRight&&n.gc.css("marginRight",e.marginRight),n.cs=r(o?t.cellSpacing||t.currentStyle.borderSpacing:n.css("border-spacing"))||2,n.b=r(o?t.border||t.currentStyle.borderLeftWidth:n.css("border-left-width"))||1,c[i]=n,m(n))}(this,t)})}})}(jQuery);var addSubmitObj=new Object;addSubmitObj.Type=null,addSubmitObj.Number=null,addSubmitObj.Project=null,addSubmitObj.CustomerTitle=null,addSubmitObj.CustomerName=null,addSubmitObj.LinkInfo=null,addSubmitObj.StaffName=null,addSubmitObj.ContractNo=null,addSubmitObj.ProductVersion=null,addSubmitObj.FileName=null;var updateSubmitObj=new Object;updateSubmitObj.ID=null,updateSubmitObj.Type=null,updateSubmitObj.Number=null,updateSubmitObj.Project=null,updateSubmitObj.CustomerTitle=null,updateSubmitObj.CustomerName=null,updateSubmitObj.LinkInfo=null,updateSubmitObj.StaffName=null,updateSubmitObj.ContractNo=null,updateSubmitObj.ProductVersion=null,updateSubmitObj.FileName=null;var downloadObj=new Object;downloadObj.Number=null,downloadObj.Project=null,downloadObj.CustomerTitle=null,downloadObj.CustomerName=null,downloadObj.LinkInfo=null,downloadObj.StaffName=null,downloadObj.ContractNo=null,downloadObj.ProductVersion=null,downloadObj.Type=null,downloadObj.FileName=null,downloadObj.PreviewJson=null;var ReportID,ReportNumber,hasSearch=0,signatureObj={},curFileName="",down_FileName="",delete_email_curPage=1,delete_ID=null,delete_res_flag=null,serviceReportStr='<tr><td class="item-No"><span class="glyphicon glyphicon-remove-circle delete_item"></span>&nbsp;<span class="NoService"></span></td><td class="service_ServiceItem"></td><td class="service_Isfinished"><select class="isFinish_sel"><option value="0">请选择</option><option value="是">是</option><option value="否">否</option></select></td><td class="service_Remarks"></td><td class="service_ConfirmedSignature"><span class="glyphicon glyphicon-pencil iSignature"></span></td><td class="service_ConfirmDate"><span class="glyphicon glyphicon-pencil iSignature"></span></td></tr>';function pageStyle(t,e){1==e?($("#fistPage").attr("disabled","disabled"),$("#upPage").attr("disabled","disabled"),$("#nextPage").attr("disabled","disabled"),$("#lastPage").attr("disabled","disabled"),buttonDisabled("#fistPage, #upPage, #nextPage, #lastPage")):1==t?($("#fistPage").attr("disabled","disabled"),$("#upPage").attr("disabled","disabled"),$("#lastPage").attr("disabled",!1),$("#nextPage").attr("disabled",!1),buttonDisabled("#fistPage, #upPage"),buttonAbled("#nextPage, #lastPage")):t==e?($("#lastPage").attr("disabled","disabled"),$("#nextPage").attr("disabled","disabled"),$("#fistPage").attr("disabled",!1),$("#upPage").attr("disabled",!1),buttonDisabled("#nextPage, #lastPage"),buttonAbled("#fistPage, #upPage")):($("#lastPage, #nextPage, #fistPage, #upPage").attr("disabled",!1),buttonAbled("#lastPage, #nextPage, #fistPage, #upPage"))}function buttonDisabled(t){return $(t).removeClass("buttonDisabled buttonAbled").addClass("buttonDisabled")}function buttonAbled(t){return $(t).removeClass("buttonDisabled buttonAbled").addClass("buttonAbled")}function tableRender(t,e,n){for(var i="",a=1;a<n.length;a++)i+='<tr><td class="update_td" data-iid="'+n[a].ID+'">'+parseInt(10*(t-1)+a)+'</td><td class="hastd_Number" title="'+n[a].Number+'">'+n[a].Number+'</td><td class="hastd_Project" title="'+n[a].Project+'">'+n[a].Project+'</td><td class="hastd_CustomerTitle" title="'+n[a].CustomerTitle+'">'+n[a].CustomerTitle+'</td><td class="hastd_CustomerName" title="'+n[a].CustomerName+'">'+n[a].CustomerName+'</td><td class="hastd_LinkInfo" title="'+n[a].LinkInfo+'">'+n[a].LinkInfo+'</td><td class="hastd_StaffName" title="'+n[a].StaffName+'">'+n[a].StaffName+'</td><td class="reportView" title="报告预览"><button type="button" class="btn btn-default" aria-label="Left Align"><span class="glyphicon glyphicon-eye-open"></span></button></td><td class="hastd_ContractNo" title="'+n[a].ContractNo+'" style="display:none">'+n[a].ContractNo+'</td><td class="hastd_ProductVersion" title="'+n[a].ProductVersion+'" style="display:none">'+n[a].ProductVersion+'</td><td class="hastd_FileName" title="'+n[a].FileName+'" style="display:none">'+n[a].FileName+'</td><td class="delete_report_td" title="删除" style="display:none"><input type="button" value="删除"></td></tr>';$(".m_table table tbody").empty().append(i),$(".m_page #currentPage").text(t),$(".m_page #allPage").text(e),deleteServiceReport(),setTimeout(tableCanDrag,50)}function tableRenderAjax(i){$.ajax({type:"GET",url:"ServiceReport",data:{LoadType:"data",CurrentPage:i},dataType:"json",success:function(t){console.log(typeof t);var e=t.pageCount,n=t.data;tableRender(i,e,n),pageStyle(i,e)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){}})}function searchTABRenderAjax(i,t,e,n,a,r){null==a&&null==r?$.ajax({type:"GET",url:"ServiceReport",data:{LoadType:"data",QueryType:t,Column1:e,Content1:n,CurrentPage:i},dataType:"json",success:function(t){console.log(typeof t);var e=t.pageCount,n=t.data;tableRender(i,e,n),pageStyle(i,e)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&(hasSearch=1)}}):$.ajax({type:"GET",url:"ServiceReport",data:{LoadType:"data",QueryType:t,Column1:e,Content1:n,Column2:a,Content2:r,CurrentPage:i},dataType:"json",success:function(t){console.log(typeof t);var e=t.pageCount,n=t.data;tableRender(i,e,n),pageStyle(i,e)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&(hasSearch=1)}})}function searchGetParam(t){var e=$(".m_button_r_top input[name='querytype']:checked").val(),n=$(".m_button_r_m .input-group-btn button").attr("title"),i=$(".m_button_r_m input").val().trim();if(null==e||""==e||null==e||"on"==e)return $.MsgBox_Unload.Alert("提示","请选择搜索类别"),!1;if("singleSelect"==e){if(null==n||""==n||null==n||"选择"==n)return $.MsgBox_Unload.Alert("提示","请选择搜索字段"),!1;if(""==i||null==i||null==i)return $.MsgBox_Unload.Alert("提示","搜索内容为空"),!1;searchTABRenderAjax(t,e,n,i)}else if("mixSelect"==e){var a,r,o,s,l=$(".m_button_r_l .input-group-btn button").attr("title"),d=$(".m_button_r_l input").val().trim();if(null!=n&&""!=n&&null!=n&&"选择"!=n||(a=1),null!=l&&""!=l&&null!=l&&"选择"!=l||(r=1),""!=i&&null!=i&&null!=i||(o=1),""!=d&&null!=d&&null!=d||(s=1),1==a||1==r)return $.MsgBox_Unload.Alert("提示","请选择搜索字段"),!1;if(1==o||1==s)return $.MsgBox_Unload.Alert("提示","搜索内容为空"),!1;searchTABRenderAjax(t,e,n,i,l,d)}}function sosuoInit(){$("input[name='querytype'][value='singleSelect']").prop("checked","checked"),$("input[name='querytype'][value='singleSelect']").parent().addClass("active").css("color","#333"),$("input[name='querytype'][value='mixSelect']").prop("checked",!1),$("input[name='querytype'][value='mixSelect']").parent().removeClass("active").css("color","#fff"),$(".m_button_r_l .input-group").fadeOut(100),$(".m_button_r_l .input-group-btn button").html("选择<span class='caret'></span>"),$(".m_button_r_l .input-group-btn button").attr("title",""),$(".m_button_r_l .input-group input").val(""),$(".m_button_r_m .input-group-btn button").html("选择<span class='caret'></span>"),$(".m_button_r_m .input-group-btn button").attr("title",""),$(".m_button_r_m .input-group input").val("")}function calcServiceNo(){$(".serviceReport_table tbody tr").each(function(){var t=$(this).index()+1;$(this).find(".NoService").text(t)})}function canFillItem(){$(".service_ServiceItem, .service_Remarks").prop("contenteditable","true")}function deleteServiceReport(){$("#DeleteServiceReport_span").length&&"是"==$("#DeleteServiceReport_span").text()&&($(".t2, .t3, .t4, .t5, .t6, .t7, .t8, .t12").css({"min-width":"118.125px",width:"11.8125%"}),$(".delete_report_td").css("border-right","0px solid #999"),$(".t12, .delete_report_td").show())}function tableCanDrag(){if(ecDo.browserInfo("android")||ecDo.browserInfo("iphone"))return!1;$(".m_table .JCLRgrips").remove(),$(".m_table table").colResizable({gripInnerHtml:'<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>',partialRefresh:!0,minWidth:53})}$(function(){sosuoInit(),tableRenderAjax(1),$("#exampleModal").modal({keyboard:!0,show:!1})}),$(".m_button_l input[value='添加']").on("click",function(){var n,i=$(this);$.ajax({type:"GET",url:"ServiceReport",data:{LoadType:"staffCode"},dataType:"text",beforeSend:function(t){eouluGlobal.C_btnDisabled(i,!1)},success:function(t){n=t},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&($(".add_NonStandard_body_in [class^='info_']").each(function(){if($(this).is(".info_Number"))return $(this).val(n),!0;$(this).val("")}),$(".bg_cover, .add_NonStandard").slideDown(150)),eouluGlobal.C_btnAbled(i,!1)}})}),$(document).on("click",".update_td",function(){updateSubmitObj.ID=Number($(this).data("iid")).toString();var i=$(this);$(".update_NonStandard_body_in [class^='info_']").each(function(){var t=$(this).attr("class").split(" ")[0].replace("info_","hastd_"),e=i.siblings("."+t).text(),n=globalDataHandle(e,"");$(this).val(n)}),$(".bg_cover").slideDown(350),$(".update_NonStandard").slideDown(350)}),$("#NonStandard_addclose, .add_NonStandard_tit_r").on("click",function(){for(var t in addSubmitObj)addSubmitObj[t]=null;$(".bg_cover").slideUp(350),$(".add_NonStandard").slideUp(350)}),$("#NonStandard_updateclose, .update_NonStandard_tit_r").on("click",function(){for(var t in updateSubmitObj)updateSubmitObj[t]=null;$(".bg_cover").slideUp(350),$(".update_NonStandard").slideUp(350)}),$("#jumpNumber").on("input propertychange",function(){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}),$("#fistPage").click(function(){0==hasSearch?tableRenderAjax(1):1==hasSearch&&searchGetParam(1)}),$("#lastPage").click(function(){var t=Number($("#allPage").text());0==hasSearch?tableRenderAjax(t):1==hasSearch&&searchGetParam(t)}),$("#upPage").click(function(){var t=Number($("#currentPage").text());1!=t&&(t--,0==hasSearch?tableRenderAjax(t):1==hasSearch&&searchGetParam(t))}),$("#nextPage").click(function(){var t=Number($("#currentPage").text());t!=Number($("#allPage").text())&&(t++,0==hasSearch?tableRenderAjax(t):1==hasSearch&&searchGetParam(t))}),$("#Gotojump").click(function(){var t=$("#jumpNumber").val().trim(),e=Number($("#allPage").text());t==Number($("#currentPage").text())||t<=0||e<t?$("#jumpNumber").val(""):0==hasSearch?tableRenderAjax(t):1==hasSearch&&searchGetParam(t)}),$("#NonStandard_addsubmit").on("click",function(){var t=$(".add_NonStandard .info_Number").val().trim().split("-");if(3!=t.length)return $.MsgBox_Unload.Alert("报告编号格式提示","格式错误！示例：SRV-T023-001"),!1;if(-1<$.inArray("",t)||-1<$.inArray(void 0,t))return $.MsgBox_Unload.Alert("报告编号格式提示","格式错误！示例：SRV-T023-002"),!1;for(var e in addSubmitObj)addSubmitObj[e]="Type"!=e?$(".add_NonStandard").find(".info_"+e).val():"add";for(var n in addSubmitObj){if(addSubmitObj[n]=globalDataHandle(addSubmitObj[n],"").trim(),"Number"==n&&""==addSubmitObj[n])return $.MsgBox_Unload.Alert("提示","未填写报告编号！"),!1;if("Project"==n&&""==addSubmitObj[n])return $.MsgBox_Unload.Alert("提示","未选择项目！"),!1;if("FileName"==n&&-1<addSubmitObj[n].indexOf("."))return $.MsgBox_Unload.Alert("提示","文件名不能含有“.”！"),!1}var i=$(this);$.ajax({type:"POST",url:"ServiceReport",dataType:"text",data:addSubmitObj,beforeSend:function(t){eouluGlobal.C_btnDisabled(i,!0,"send...")},success:function(t){"true"==t?($.MsgBox_Unload.Alert("提示","添加成功！"),$("#NonStandard_addclose").trigger("click")):"false"==t&&$.MsgBox_Unload.Alert("提示","添加失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){"success"==e&&(tableRenderAjax(1),hasSearch=0,sosuoInit()),eouluGlobal.C_btnAbled(i,!0,"提交")}})}),$("#NonStandard_updatesubmit").on("click",function(){var t=$(".update_NonStandard .info_Number").val().trim().split("-");if(3!=t.length)return $.MsgBox_Unload.Alert("报告编号格式提示","格式错误！示例：SRV-T023-001"),!1;if(-1<$.inArray("",t)||-1<$.inArray(void 0,t))return $.MsgBox_Unload.Alert("报告编号格式提示","格式错误！示例：SRV-T023-002"),!1;for(var e in updateSubmitObj)"Type"!=e?"ID"!=e&&(updateSubmitObj[e]=$(".update_NonStandard").find(".info_"+e).val()):updateSubmitObj[e]="update";for(var n in updateSubmitObj){if(updateSubmitObj[n]=globalDataHandle(updateSubmitObj[n],"").trim(),"Number"==n&&""==updateSubmitObj[n])return $.MsgBox_Unload.Alert("提示","未填写报告编号！"),!1;if("Project"==n&&""==updateSubmitObj[n])return $.MsgBox_Unload.Alert("提示","未选择项目！"),!1;if("FileName"==n&&-1<updateSubmitObj[n].indexOf("."))return $.MsgBox_Unload.Alert("提示","文件名不能含有“.”！"),!1}console.log("update我执行了吗"),console.log(updateSubmitObj),$.ajax({type:"POST",url:"ServiceReport",dataType:"text",data:updateSubmitObj,success:function(t){console.log(typeof t),"true"==t?($.MsgBox_Unload.Alert("提示","修改成功！"),$("#NonStandard_updateclose").trigger("click")):"false"==t&&$.MsgBox_Unload.Alert("提示","修改失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){"success"==e&&(tableRenderAjax(1),hasSearch=0,sosuoInit())}})}),$(".m_button_r_top label").on("click",function(){"singleSelect"==$(this).children().val()?($(this).css("color","#333"),$(this).siblings("label").css("color","#fff"),$(".m_button_r_l div.input-group").fadeOut(100)):($(this).css("color","#333"),$(this).siblings("label").css("color","#fff"),$(".m_button_r_l div.input-group").fadeIn(100))}),$(".m_button_r_l .dropdown-menu li").on("click",function(){var t=$(this).text(),e=$(this).attr("title");$(this).parent().siblings("button").text(e),$(this).parent().siblings("button").attr("title",t)}),$(".m_button_r_m .dropdown-menu li").on("click",function(){var t=$(this).text(),e=$(this).attr("title");$(this).parent().siblings("button").text(e),$(this).parent().siblings("button").attr("title",t)}),$("#NonStandard_cancel").on("click",function(){for(var t in hasSearch=0,sosuoInit(),tableRenderAjax(1),addSubmitObj)addSubmitObj[t]=null;for(var e in updateSubmitObj)updateSubmitObj[e]=null;$("#jumpNumber").val("")}),$("#NonStandard_search").on("click",function(){searchGetParam(1)}),$(document).on("mouseenter",".m_table tbody td",function(){$(this).parent().css({border:"2px solid red"})}),$(document).on("mouseleave",".m_table tbody td",function(){$(this).parent().css({border:"1px solid transparent"})}),$(document).on("click",".reportView>button",function(){var a=$(this);ReportID=a.parent().siblings(".update_td").data("iid"),eouluGlobal.C_btnDisabled(a,!1),$.ajax({type:"GET",url:"ServiceReportPreview",data:{ReportID:ReportID},dataType:"json"}).then(function(t){$(".serviceReport_div, .bg_cover").slideDown(100);var i="";t.map(function(t,e,n){0<e&&(i+='<tr><td class="item-No" data-id="'+t.ID+'"><span class="glyphicon glyphicon-remove-circle delete_item"></span>&nbsp;<span class="NoService"></span></td><td class="service_ServiceItem">'+t.ServiceItem+'</td><td class="service_Isfinished">'+t.Isfinished+'</td><td class="service_Remarks">'+t.Remarks+'</td><td class="service_ConfirmedSignature"><span class="glyphicon glyphicon-pencil iSignature"></span><img src="data:image/png;base64,'+t.ConfirmedSignature+'" style="max-height: 60px; max-width: 110px;"></td><td class="service_ConfirmDate"><span class="glyphicon glyphicon-pencil iSignature"></span><img src="data:image/png;base64,'+t.ConfirmDate+'" style="max-height: 60px; max-width: 110px;"></td></tr>')}),$(".serviceReport_table tbody").empty().append(i),calcServiceNo(),canFillItem(),ReportNumber=a.parent().siblings(".hastd_Number").text(),curFileName=a.parent().siblings(".hastd_FileName").text();var e=ReportNumber.replace("SRV-","").replace("-","");for(var n in down_FileName=""==curFileName||"--"==curFileName?e:curFileName,downloadObj)"Type"!=n?"FileName"!=n&&"PreviewJson"!=n&&(downloadObj[n]=a.parent().siblings(".hastd_"+n).text()):downloadObj[n]="download"},function(){$.MsgBox_Unload.Alert("提示","网络繁忙！")}).always(function(){eouluGlobal.C_btnAbled(a,!1)})}),$(".serviceReport_top_r").click(function(){for(var t in downloadObj)downloadObj[t]=null;$(".serviceReport_div").slideUp(300),$(".bg_cover").slideUp(300),ReportNumber=down_FileName=curFileName=""}),$("#add_serviceReport").on("click",function(){$(".serviceReport_table tbody").append(serviceReportStr),calcServiceNo(),canFillItem()}),$(document).on("click",".delete_item",function(){$(this).parent().parent().remove(),calcServiceNo()}),$(document).on("click",".iSignature",function(){if($(this).parent().siblings(".item-No").data("id")&&""!==(-1<$(this).siblings("img").attr("src").indexOf(";base64,")?$(this).siblings("img").attr("src").split(";base64,")[1]:""))return!1;$(".wrapper_sign, .cover_bg2").slideDown(250),$("#signature").empty(),$("#signature").jSignature();var t=$(this).parent().parent().index(),e=$(this).parent().attr("class");signatureObj.index=t,signatureObj.classify=e}),$(".wrapper_sign_tit_r").click(function(){$(".wrapper_sign").slideUp(300),$(".cover_bg2").slideUp(300)});var $sigdiv=$("#signature");$("#signature_reset").on("click",function(){$sigdiv.jSignature("reset")}),$("#signature_OK").on("click",function(){$sigdiv.jSignature("getData","svgbase64");var t=$sigdiv.jSignature("getData","image"),e=new Image;e.src="data:"+t[0]+","+t[1],e.style="max-height:60px;max-width:110px;";var n=signatureObj.index,i=signatureObj.classify,a=$(".serviceReport_table tbody tr").eq(n).find("."+i);a.find("img").remove(),a.append(e),$(".wrapper_sign").slideUp(300),$(".cover_bg2").slideUp(300)}),$(".serviceReport_top_save").click(function(){var s=[];if(0==$(".serviceReport_table tbody tr").length)return $.MsgBox_Unload.Alert("提示","请先添加一条再保存！"),!1;var l=1,d=1;if($(".serviceReport_table tbody tr").each(function(){var t={},e=$(this).children(".service_ServiceItem").text().trim();if(""==e||"--"==e)return l=0,!1;var n,i,a=$(this).children(".service_Isfinished").text();if("是"!=a&&"否"!=a)return d=0,!1;if($(this).children(".service_ConfirmedSignature").find("img").length){var r=$(this).children(".service_ConfirmedSignature").find("img").attr("src");n="data:image/png;base64,"==r?"":r}else n="";if($(this).children(".service_ConfirmDate").find("img").length){var o=$(this).children(".service_ConfirmDate").find("img").attr("src");i="data:image/png;base64,"==o?"":o}else i="";t.ServiceItem=e,t.Isfinished=a,t.Remarks=$(this).children(".service_Remarks").text().trim(),t.ConfirmedSignature=n,t.ConfirmDate=i,s.push(t)}),0==l)return $.MsgBox_Unload.Alert("提示","有完成内容项未填！"),!1;if(0==d)return $.MsgBox_Unload.Alert("提示","有是否达标项未填！"),!1;var t=$.fn.stringifyArr(s),e=ReportNumber;$.ajax({type:"POST",url:"ServiceReportPreview",data:{Type:"save",PreviewJson:t,ReportID:ReportID,Number:e},dataType:"text"}).then(function(t){console.log(typeof t),"true"==t?$.MsgBox_Unload.Alert("提示","保存成功！"):"false"==t&&$.MsgBox_Unload.Alert("提示","保存失败！")},function(){$.MsgBox_Unload.Alert("提示","服务器繁忙，保存有误！")})}),$(document).on("click",".service_Isfinished",function(t){if(t.stopPropagation(),"是"==$(this).text()||"否"==$(this).text()){$(this).text("");$(this).html('<select class="isFinish_sel"><option value="0">请选择</option><option value="是">是</option><option value="否">否</option></select>')}}),$(document).on("change",".isFinish_sel",function(){var t=$(this).val();if(0!=t){var e=$(this).parent();$(this).detach(),e.html("").text(t)}}),$(".serviceReport_top_down").click(function(){var s=[];if(0==$(".serviceReport_table tbody tr").length)return $.MsgBox_Unload.Alert("提示","请先添加一条再下载！"),!1;var l=1,d=1;if($(".serviceReport_table tbody tr").each(function(){var t={},e=$(this).children(".service_ServiceItem").text().trim();if(""==e||"--"==e)return l=0,!1;var n,i,a=$(this).children(".service_Isfinished").text();if("是"!=a&&"否"!=a)return d=0,!1;if($(this).children(".service_ConfirmedSignature").find("img").length){var r=$(this).children(".service_ConfirmedSignature").find("img").attr("src");n="data:image/png;base64,"==r?"":r}else n="";if($(this).children(".service_ConfirmDate").find("img").length){var o=$(this).children(".service_ConfirmDate").find("img").attr("src");i="data:image/png;base64,"==o?"":o}else i="";t.ServiceItem=e,t.Isfinished=a,t.Remarks=$(this).children(".service_Remarks").text().trim(),t.ConfirmedSignature=n,t.ConfirmDate=i,s.push(t)}),0==l)return $.MsgBox_Unload.Alert("提示","有完成内容项未填！"),!1;if(0==d)return $.MsgBox_Unload.Alert("提示","有是否达标项未填！"),!1;var t=$.fn.stringifyArr(s);downloadObj.PreviewJson=t,downloadObj.FileName=down_FileName+".doc",$.ajax({type:"POST",url:"ServiceReportPreview",data:downloadObj,dataType:"text",beforeSend:function(t){$(".serviceReport_top_down").attr("disabled","disabled"),$(".serviceReport_top_down").css({cursor:"not-allowed"})},success:function(t){var e=window.location.href.split("cfChicken8")[0]+"cfChicken8/";window.location.href=e+t},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙！")},complete:function(t,e){$(".serviceReport_top_down").attr("disabled",!1),$(".serviceReport_top_down").css({cursor:"pointer"})}})}),$(document).on("click",".delete_report_td input",function(){delete_email_curPage=Number($(".pageInfo #currentPage").text()),delete_ID=$(this).parent().siblings(".update_td").data("iid"),delete_res_flag=null,$(".cover_bg3").slideDown(200),$("#exampleModal").modal("show")}),$("#exampleModal").on("hide.bs.modal",function(t){$(".cover_bg3").slideUp(200,function(){delete_email_curPage=1,delete_ID=null})}),$("#exampleModal").on("hidden.bs.modal",function(t){1==delete_res_flag?$.MsgBox_Unload.Alert("提示","没有权限！"):2==delete_res_flag?$.MsgBox_Unload.Alert("提示","删除失败！"):3==delete_res_flag?($.MsgBox_Unload.Alert("提示","删除成功！"),0==hasSearch?tableRenderAjax(delete_email_curPage):1==hasSearch&&searchGetParam(delete_email_curPage)):4==delete_res_flag&&$.MsgBox_Unload.Alert("提示","网络繁忙！")}),$(document).on("click","#delete_service_yes",function(){if(delete_ID){var t=$("#delete_service_yes");globalBtnNotAllow(t),$.ajax({type:"POST",url:"ServiceReport",data:{Type:"delete",ID:delete_ID},dataType:"text"}).then(function(t){-1<t.indexOf("没有权限")?delete_res_flag=1:"false"==t?delete_res_flag=2:"true"==t&&(delete_res_flag=3)},function(){delete_res_flag=4}).always(function(){globalBtnAllow(t),$("#exampleModal").modal("hide")})}}),$(".info_FileName").on("blur",function(t){var e=$(this).val().trim();if(""==e)return $(this).val(""),!1;if(fileIllegalChar.test(e)){$.MsgBox_Unload.Alert("文件名提示","有非法字符！");var n=e.replace(fileReplaceIllegalChar,"");$(this).val(n)}else console.log("无")});