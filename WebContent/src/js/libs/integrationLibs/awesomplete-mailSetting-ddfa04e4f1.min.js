!function(){function e(t){var e=Array.isArray(t)?{label:t[0],value:t[1]}:"object"==typeof t&&"label"in t&&"value"in t?t:{label:t,value:t};this.label=e.label||e.value,this.value=e.value}function s(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function t(t,e){return l.call((e||document).querySelectorAll(t))}function i(){t("input.awesomplete").forEach(function(t){new n(t)})}var n=function(t,e){var i=this;Awesomplete.count=(Awesomplete.count||0)+1,this.count=Awesomplete.count,this.isOpened=!1,this.input=s(t),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),e=e||{},function(t,e,i){for(var n in e){var a=e[n],l=t.input.getAttribute("data-"+n.toLowerCase());"number"==typeof a?t[n]=parseInt(l):!1===a?t[n]=null!==l:a instanceof Function?t[n]=null:t[n]=l,t[n]||0===t[n]||(t[n]=n in i?i[n]:a)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:n.DATA,filter:n.FILTER_CONTAINS,sort:!1!==e.sort&&n.SORT_BYLENGTH,item:n.ITEM,replace:n.REPLACE},e),this.index=-1,this.container=s.create("div",{className:"awesomplete",around:t}),this.ul=s.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container}),this.status=s.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:0!=this.minChars?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(t){var e=t.keyCode;i.opened&&(13===e&&i.selected?(t.preventDefault(),i.select()):27===e?i.close({reason:"esc"}):38!==e&&40!==e||(t.preventDefault(),i[38===e?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(t){t.preventDefault()},click:function(t){var e=t.target;if(e!==this){for(;e&&!/li/i.test(e.nodeName);)e=e.parentNode;e&&0===t.button&&(t.preventDefault(),i.select(e,t.target))}}}},s.bind(this.input,this._events.input),s.bind(this.input.form,this._events.form),s.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||e.list||[],n.all.push(this)};n.prototype={set list(t){if(Array.isArray(t))this._list=t;else if("string"==typeof t&&-1<t.indexOf(","))this._list=t.split(/\s*,\s*/);else if((t=s(t))&&t.children){var a=[];l.apply(t.children).forEach(function(t){if(!t.disabled){var e=t.textContent.trim(),i=t.value||e,n=t.label||e;""!==i&&a.push({label:n,value:i})}}),this._list=a}document.activeElement===this.input&&this.evaluate()},get selected(){return-1<this.index},get opened(){return this.isOpened},close:function(t){this.opened&&(this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),s.fire(this.input,"awesomplete-close",t||{}))},open:function(){this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this.goto(0),s.fire(this.input,"awesomplete-open")},destroy:function(){s.unbind(this.input,this._events.input),s.unbind(this.input.form,this._events.form);var t=this.container.parentNode;t.insertBefore(this.input,this.container),t.removeChild(this.container),this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var e=n.all.indexOf(this);-1!==e&&n.all.splice(e,1)},next:function(){var t=this.ul.children.length;this.goto(this.index<t-1?this.index+1:t?0:-1)},previous:function(){var t=this.ul.children.length,e=this.index-1;this.goto(this.selected&&-1!==e?e:t-1)},goto:function(t){var e=this.ul.children;this.selected&&e[this.index].setAttribute("aria-selected","false"),-1<(this.index=t)&&0<e.length&&(e[t].setAttribute("aria-selected","true"),this.status.textContent=e[t].textContent+", list item "+(t+1)+" of "+e.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=e[t].offsetTop-this.ul.clientHeight+e[t].clientHeight,s.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(t,e){if(t?this.index=s.siblingIndex(t):t=this.ul.children[this.index],t){var i=this.suggestions[this.index];s.fire(this.input,"awesomplete-select",{text:i,origin:e||t})&&(this.replace(i),this.close({reason:"select"}),s.fire(this.input,"awesomplete-selectcomplete",{text:i}))}},evaluate:function(){var i=this,n=this.input.value;n.length>=this.minChars&&this._list&&0<this._list.length?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(t){return new e(i.data(t,n))}).filter(function(t){return i.filter(t,n)}),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(t,e){i.ul.appendChild(i.item(t,n,e))}),0===this.ul.children.length?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},n.all=[],n.FILTER_CONTAINS=function(t,e){return RegExp(s.regExpEscape(e.trim()),"i").test(t)},n.FILTER_STARTSWITH=function(t,e){return RegExp("^"+s.regExpEscape(e.trim()),"i").test(t)},n.SORT_BYLENGTH=function(t,e){return t.length!==e.length?t.length-e.length:t<e?-1:1},n.ITEM=function(t,e,i){return s.create("li",{innerHTML:""===e.trim()?t:t.replace(RegExp(s.regExpEscape(e.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+i})},n.REPLACE=function(t){this.input.value=t.value},n.DATA=function(t){return t},Object.defineProperty(e.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),e.prototype.toString=e.prototype.valueOf=function(){return""+this.label};var l=Array.prototype.slice;s.create=function(t,e){var i=document.createElement(t);for(var n in e){var a=e[n];if("inside"===n)s(a).appendChild(i);else if("around"===n){var l=s(a);l.parentNode.insertBefore(i,l),i.appendChild(l)}else n in i?i[n]=a:i.setAttribute(n,a)}return i},s.bind=function(e,t){if(e)for(var i in t){var n=t[i];i.split(/\s+/).forEach(function(t){e.addEventListener(t,n)})}},s.unbind=function(e,t){if(e)for(var i in t){var n=t[i];i.split(/\s+/).forEach(function(t){e.removeEventListener(t,n)})}},s.fire=function(t,e,i){var n=document.createEvent("HTMLEvents");for(var a in n.initEvent(e,!0,!0),i)n[a]=i[a];return t.dispatchEvent(n)},s.regExpEscape=function(t){return t.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},s.siblingIndex=function(t){for(var e=0;t=t.previousElementSibling;e++);return e},"undefined"!=typeof Document&&("loading"!==document.readyState?i():document.addEventListener("DOMContentLoaded",i)),n.$=s,n.$$=t,"undefined"!=typeof self&&(self.Awesomplete=n),"object"==typeof module&&module.exports&&(module.exports=n)}();var mailSettingState=new Object;function toccListRender(){var t=mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify];if(null==t.ToList&&null==t.CopyList)return console.warn("mailSettingState.hasRequestDefaultMailToList或mailSettingState.hasRequestDefaultMailCopyList为空！"),!1;var n="",a="";t.ToList.map(function(t,e,i){n+='<li title="'+t+'">'+t+"</li>"}),$(".to_list_cont ul").empty().append(n),t.CopyList.map(function(t,e,i){a+='<li title="'+t+'">'+t+"</li>"}),$(".cc_list_cont ul").empty().append(a)}mailSettingState.insertFlag=!1,mailSettingState.allMailList=[],mailSettingState.insertDepartFlag=!1,mailSettingState.hasRequestDepartObj={},mailSettingState.curSingleDepartMailStr=null,mailSettingState.hasRequestDefaultMailObj=new Object,mailSettingState.getClassify=null,mailSettingState.setClassify=null,$(function(){$("h5#GAdmin_flag").length?($("input.mailSetting_open").show(),$(".VersionManagement_div_tit_l").addClass("hasAdmin")):($("input.mailSetting_open").hide(),$(".VersionManagement_div_tit_l").removeClass("hasAdmin"))}),$(document).on("click","input.mailSetting_open, .mailSet_open",function(){var n;$(".mailSetting_div_cover, .mailSetting_div").slideDown(250),$(this).is(".mailSet_open")?(mailSettingState.getClassify=$("select#projectname_select").val(),mailSettingState.setClassify=$("select#projectname_select").val(),n="设置邮件收件人/抄送人--"+$("select#projectname_select>option:checked").text()):(mailSettingState.getClassify=$("#mailSetting_classify").data("iiclassify").toString(),mailSettingState.setClassify=$("#mailSetting_classify").data("iiclassify").toString(),n="设置邮件收件人/抄送人"),mailSettingState.insertFlag?($("div.select_btn_grop>button:eq(0)").addClass("active").siblings().removeClass("active"),$(".singlemate_row").show(),$(".multiplemate_row").hide(),$("#singlemate_row_to, #singlemate_row_cc").val(""),$(".change_title_legend").text(n),void 0===mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]?$.ajax({type:"GET",url:"MailConfig",data:{Page:mailSettingState.getClassify},dataType:"json",success:function(t){mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]={};var e=mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify];e.flag=!0;var i=t[1].ToList,n=t[1].CopyList;null!=i&&"--"!=i||(i=""),null!=n&&"--"!=n||(n="");var a=i.split(";");a=$.grep(a,function(t,e){return""!=t});var l=n.split(";");l=$.grep(l,function(t,e){return""!=t}),e.ToList=a,e.CopyList=l,toccListRender()},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙，读取已设置邮箱失败！")}}):toccListRender()):$("div.mailSetting_div").empty().load("html/modules/software/mailSetting.html #mailSetting_con_id",function(t,e,i){"success"==e?($(".change_title_legend").text(n),mailSettingState.insertFlag=!0,$("div.select_btn_grop>button:eq(0)").addClass("active").siblings().removeClass("active"),globalGetAllEmail(function(t){t.map(function(t,e,i){0<e&&mailSettingState.allMailList.push(t.Email)}),$("#singlemate_row_to, #singlemate_row_cc").each(function(t,e){new Awesomplete(e,{list:mailSettingState.allMailList,minChars:1,maxItems:15,autoFirst:!0,filter:function(t,e){return Awesomplete.FILTER_CONTAINS(t,e.match(/[^;]*$/)[0])},item:function(t,e){return Awesomplete.ITEM(t,e.match(/[^;]*$/)[0])},replace:function(t){var e=this.input.value.match(/^.+;\s*|/)[0];this.input.value=e+t+"; "}})})},null),void 0===mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]?$.ajax({type:"GET",url:"MailConfig",data:{Page:mailSettingState.getClassify},dataType:"json",success:function(t){mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]={};var e=mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify];e.flag=!0;var i=t[1].ToList,n=t[1].CopyList;null!=i&&"--"!=i||(i=""),null!=n&&"--"!=n||(n="");var a=i.split(";");a=$.grep(a,function(t,e){return""!=t});var l=n.split(";");l=$.grep(l,function(t,e){return""!=t}),e.ToList=a,e.CopyList=l,toccListRender()},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙，读取已设置邮箱失败！")}}):toccListRender()):$.MsgBox_Unload.Alert("加载提示","服务器繁忙！")})}),$(document).on("click","#mailSetting_cancel, .mailSetting_con_tit>span",function(){$(".mailSetting_div_cover, .mailSetting_div").slideUp(250,function(){mailSettingState.getClassify=null,mailSettingState.setClassify=null})}),$(document).on("click","div.select_btn_grop>button",function(){$(this).addClass("active").siblings().removeClass("active");var t=$(this).data("iselect").toString()+"_row";$(".mailSetting_con_body_in div.toggle_row:not(."+t+")").slideUp(200,function(){if($(".mailSetting_con_body_in ."+t).slideDown(200),"multiplemate_row"==t){if(!mailSettingState.insertDepartFlag){var n='<option value="" disabled>请选择</option><option value="所有">所有</option>';globalEouluAllDepart.map(function(t,e,i){n+='<option value="'+t+'">'+t+"</option>"}),$("#multiplemate_row_depart").append(n),mailSettingState.insertDepartFlag=!0}$("#multiplemate_row_depart").val("")}})}),$(document).on("click","div.singlemate_row .to_add_in, div.singlemate_row .cc_add_in",function(){var t,e;$(this).is(".to_add_in")?(t=$("#singlemate_row_to"),e=$(".to_list_cont ul")):$(this).is(".cc_add_in")&&(t=$("#singlemate_row_cc"),e=$(".cc_list_cont ul"));var i=t.val().trim().replace(/;\s*/g,";;").split(";;");i=$.grep(i,function(t,e){return""!=t});var n=globalArrStrUnique(i),a="";n.map(function(t,e,i){a+='<li title="'+t+'">'+t+"</li>"}),e.append(a),t.val("")}),$(document).on("click",".to_list_cont ul>li, .cc_list_cont ul>li",function(){$(this).toggleClass("hasSelect")}),$(document).on("click",".to_list_tit button, .cc_list_tit button",function(){var t;$(this).is(".to_list_tit button")?t=$(".to_list_cont ul"):$(this).is(".cc_list_tit button")&&(t=$(".cc_list_cont ul"));var e=t.children("li.hasSelect");if(0==e.length)return $.MsgBox_Unload.Alert("删除提示","未选中！"),!1;e.remove()}),$(document).on("change","#multiplemate_row_depart",function(){var e=$(this).val();if(e)if("所有"==e){if(0==mailSettingState.allMailList.length)return $.MsgBox_Unload.Alert("选择所有提示","所有邮箱初始化失败！请刷新"),!1;var n="";mailSettingState.allMailList.map(function(t,e,i){n+='<li title="'+t+'">'+t+"</li>"}),mailSettingState.curSingleDepartMailStr=n}else if(-1<Object.getOwnPropertyNames(mailSettingState.hasRequestDepartObj).indexOf(e)){var a="";mailSettingState.hasRequestDepartObj[e].map(function(t,e,i){a+='<li title="'+t+'">'+t+"</li>"}),mailSettingState.curSingleDepartMailStr=a}else globalGetStaffAllInfoByDepart(e,function(t){var n=[],a="";t.map(function(t,e,i){0<e&&(n.push(t.StaffMail),a+='<li title="'+t.StaffMail+'">'+t.StaffMail+"</li>")}),mailSettingState.hasRequestDepartObj[e]=n,mailSettingState.curSingleDepartMailStr=a},null);else console.log("部门未选中！")}),$(document).on("click",".add_to_cc_list>input",function(){if(!mailSettingState.curSingleDepartMailStr)return $.MsgBox_Unload.Alert("添加提示","未选中部门！"),!1;var t;"添加到收件人"==$(this).val()?t=$(".to_list_cont ul"):"添加到抄送人"==$(this).val()&&(t=$(".cc_list_cont ul")),t.append(mailSettingState.curSingleDepartMailStr),mailSettingState.curSingleDepartMailStr=null,$("#multiplemate_row_depart").val("")}),$(document).on("click","#mailSetting_submit",function(){var t=$(".to_list_cont ul>li"),e=$(".cc_list_cont ul>li");if(0==t.length&&0==e.length)return $.MsgBox_Unload.Alert("提交提示","收件人抄送人都未选！"),!1;var n="",a="",i=[],l=[];t.each(function(){i.push($(this).attr("title"))}),e.each(function(){l.push($(this).attr("title"))}),i=$.grep(i,function(t,e){return""!=t}),l=$.grep(l,function(t,e){return""!=t}),i.map(function(t,e,i){n+=t,n+=";"}),l.map(function(t,e,i){a+=t,a+=";"});var s=$(this);$.ajax({type:"POST",url:"MailConfig",data:{Page:mailSettingState.setClassify,ToList:n,CopyList:a},dataType:"text",beforeSend:function(t){s.css("cursor","not-allowed").prop("disabled","disabled")},complete:function(t,e){s.css("cursor","pointer").prop("disabled",!1)},success:function(t){if($.MsgBox_Unload.Alert("提示",t),-1<t.indexOf("设置成功")){void 0===mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]&&(mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify]={});var e=mailSettingState.hasRequestDefaultMailObj[mailSettingState.getClassify];e.ToList=i,e.CopyList=l,$("#mailSetting_cancel").trigger("click")}},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙，请稍后重试！")}})});