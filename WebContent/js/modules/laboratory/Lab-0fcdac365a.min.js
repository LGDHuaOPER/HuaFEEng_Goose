!function(r){var d,s=r(document),p=r("head"),u=null,c={},o=0,l="id",b="px",f="JColResizer",i="JCLRFlex",n=parseInt,g=Math,_=0<navigator.userAgent.indexOf("Trident/4.0");try{d=sessionStorage}catch(t){}p.append("<style type='text/css'>  .JColResizer{table-layout:fixed;} .JColResizer > tbody > tr > td, .JColResizer > tbody > tr > th{overflow:hidden;padding-left:0!important; padding-right:0!important;}  .JCLRgrips{ height:0px; position:relative;} .JCLRgrip{margin-left:-5px; position:absolute; z-index:5; } .JCLRgrip .JColResizer{position:absolute;background-color:red;filter:alpha(opacity=1);opacity:0;width:10px;height:100%;cursor: e-resize;top:0px} .JCLRLastGrip{position:absolute; width:1px; } .JCLRgripDrag{ border-left:1px dotted black;\t} .JCLRFlex{width:auto!important;} .JCLRgrip.JCLRdisabledGrip .JColResizer{cursor:default; display:none;}</style>");var h=function(t){var e=t.attr(l);(t=c[e])&&t.is("table")&&(t.removeClass(f+" "+i).gc.remove(),delete c[e])},m=function(o){var t=o.find(">thead>tr:first>th,>thead>tr:first>td");t.length||(t=o.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td")),t=t.filter(":visible"),o.cg=o.find("col"),o.ln=t.length,o.p&&d&&d[o.id]&&v(o,t),t.each(function(t){var e=r(this),a=-1!=o.dc.indexOf(t),i=r(o.gc.append('<div class="JCLRgrip"></div>')[0].lastChild);i.append(a?"":o.opt.gripInnerHtml).append('<div class="'+f+'"></div>'),t==o.ln-1&&(i.addClass("JCLRLastGrip"),o.f&&i.html("")),i.bind("touchstart mousedown",S),a?i.addClass("JCLRdisabledGrip"):i.removeClass("JCLRdisabledGrip").bind("touchstart mousedown",S),i.t=o,i.i=t,(i.c=e).w=e.width(),o.g.push(i),o.c.push(e),e.width(e.w).removeAttr("width"),i.data(f,{i:t,t:o.attr(l),last:t==o.ln-1})}),o.cg.removeAttr("width"),o.find("td, th").not(t).not("table th, table td").each(function(){r(this).removeAttr("width")}),o.f||o.removeAttr("width").addClass(i),$(o)},v=function(t,e){var a,i,o=0,l=0,n=[];if(e){if(t.cg.removeAttr("width"),t.opt.flush)return void(d[t.id]="");for(i=(a=d[t.id].split(";"))[t.ln+1],!t.f&&i&&(t.width(i*=1),t.opt.overflow&&(t.css("min-width",i+b),t.w=i));l<t.ln;l++)n.push(100*a[l]/a[t.ln]+"%"),e.eq(l).css("width",n[l]);for(l=0;l<t.ln;l++)t.cg.eq(l).css("width",n[l])}else{for(d[t.id]="";l<t.c.length;l++)a=t.c[l].width(),d[t.id]+=a+";",o+=a;d[t.id]+=o,t.f||(d[t.id]+=";"+t.width())}},$=function(t){t.gc.width(t.w);for(var e=0;e<t.ln;e++){var a=t.c[e];t.g[e].css({left:a.offset().left-t.offset().left+a.outerWidth(!1)+t.cs/2+b,height:t.opt.headerOnly?t.c[0].outerHeight(!1):t.outerHeight(!1)})}},x=function(t,e,a){var i=u.x-u.l,o=t.c[e],l=t.c[e+1],n=o.w+i,r=l.w-i;o.width(n+b),t.cg.eq(e).width(n+b),t.f?(l.width(r+b),t.cg.eq(e+1).width(r+b)):t.opt.overflow&&t.css("min-width",t.w+i),a&&(o.w=n,l.w=t.f?r:l.w)},y=function(t){var a=r.map(t.c,function(t){return t.width()});t.width(t.w=t.width()).removeClass(i),r.each(t.c,function(t,e){e.width(a[t]).w=a[t]}),t.addClass(i)},w=function(t){if(u){var e=u.t,a=t.originalEvent.touches,i=(a?a[0].pageX:t.pageX)-u.ox+u.l,o=e.opt.minWidth,l=u.i,n=1.5*e.cs+o+e.b,r=l==e.ln-1,d=l?e.g[l-1].position().left+e.cs+o:n,s=e.f?l==e.ln-1?e.w-n:e.g[l+1].position().left-e.cs-o:1/0;if(i=g.max(d,g.min(s,i)),u.x=i,u.css("left",i+b),r){var p=e.c[u.i];u.w=p.w+i-u.l}if(e.opt.liveDrag){r?(p.width(u.w),!e.f&&e.opt.overflow?e.css("min-width",e.w+i-u.l):e.w=e.width()):x(e,l),$(e);var c=e.opt.onDrag;c&&(t.currentTarget=e[0],c(t))}return!1}},L=function(t){if(s.unbind("touchend."+f+" mouseup."+f).unbind("touchmove."+f+" mousemove."+f),r("head :last-child").remove(),u){if(u.removeClass(u.t.opt.draggingClass),u.x-u.l!=0){var e=u.t,a=e.opt.onResize,i=u.i,o=i==e.ln-1,l=e.g[i].c;o?(l.width(u.w),l.w=u.w):x(e,i,!0),e.f||y(e),$(e),a&&(t.currentTarget=e[0],a(t)),e.p&&d&&v(e)}u=null}},S=function(t){var e=r(this).data(f),a=c[e.t],i=a.g[e.i],o=t.originalEvent.touches;if(i.ox=o?o[0].pageX:t.pageX,i.l=i.position().left,i.x=i.l,s.bind("touchmove."+f+" mousemove."+f,w).bind("touchend."+f+" mouseup."+f,L),p.append("<style type='text/css'>*{cursor:"+a.opt.dragCursor+"!important}</style>"),i.addClass(a.opt.draggingClass),u=i,a.c[e.i].l)for(var l,n=0;n<a.ln;n++)(l=a.c[n]).l=!1,l.w=l.width();return!1};r(window).bind("resize."+f,function(){for(var t in c)if(c.hasOwnProperty(t)){var e,a=0;if((t=c[t]).removeClass(f),t.f){for(t.w=t.width(),e=0;e<t.ln;e++)a+=t.c[e].w;for(e=0;e<t.ln;e++)t.c[e].css("width",g.round(1e3*t.c[e].w/a)/10+"%").l=!0}else y(t),"flex"==t.mode&&t.p&&d&&v(t);$(t.addClass(f))}}),r.fn.extend({colResizable:function(t){switch((t=r.extend({resizeMode:"fit",draggingClass:"JCLRgripDrag",gripInnerHtml:"",liveDrag:!1,minWidth:15,headerOnly:!1,hoverCursor:"e-resize",dragCursor:"e-resize",postbackSafe:!1,flush:!1,marginLeft:null,marginRight:null,disable:!1,partialRefresh:!1,disabledColumns:[],onDrag:null,onResize:null},t)).fixed=!0,t.overflow=!1,t.resizeMode){case"flex":t.fixed=!1;break;case"overflow":t.fixed=!1,t.overflow=!0}return this.each(function(){!function(t,e){var a=r(t);if(a.opt=e,a.mode=e.resizeMode,a.dc=a.opt.disabledColumns,a.opt.disable)return h(a);var i=a.id=a.attr(l)||f+o++;a.p=a.opt.postbackSafe,!a.is("table")||c[i]&&!a.opt.partialRefresh||("e-resize"!==a.opt.hoverCursor&&p.append("<style type='text/css'>.JCLRgrip .JColResizer:hover{cursor:"+a.opt.hoverCursor+"!important}</style>"),a.addClass(f).attr(l,i).before('<div class="JCLRgrips"/>'),a.g=[],a.c=[],a.w=a.width(),a.gc=a.prev(),a.f=a.opt.fixed,e.marginLeft&&a.gc.css("marginLeft",e.marginLeft),e.marginRight&&a.gc.css("marginRight",e.marginRight),a.cs=n(_?t.cellSpacing||t.currentStyle.borderSpacing:a.css("border-spacing"))||2,a.b=n(_?t.border||t.currentStyle.borderLeftWidth:a.css("border-left-width"))||1,c[i]=a,m(a))}(this,t)})}})}(jQuery);var LabPageMainDataObj={},addSubmitObj=new Object;addSubmitObj.Type=null,addSubmitObj.Model=null,addSubmitObj.Description=null,addSubmitObj.Number=null,addSubmitObj.Laboratory=null,addSubmitObj.Picture=null,addSubmitObj.Document=null;var updateSubmitObj=new Object;updateSubmitObj.ID=null,updateSubmitObj.Type=null,updateSubmitObj.Model=null,updateSubmitObj.Description=null,updateSubmitObj.Number=null,updateSubmitObj.Laboratory=null,updateSubmitObj.Picture=null,updateSubmitObj.Document=null;var LabID,downloadObj=new Object;downloadObj.Number=null,downloadObj.Project=null,downloadObj.CustomerTitle=null,downloadObj.CustomerName=null,downloadObj.LinkInfo=null,downloadObj.StaffName=null,downloadObj.ContractNo=null,downloadObj.ProductVersion=null,downloadObj.Type=null,downloadObj.FileName=null,downloadObj.PreviewJson=null;var curFileupload,curModel,searchPartModelIndex=-1,LaboratoryArr=["北京","石家庄","苏州","厦门","深圳","成都"],serviceReportStr='<tr><td class="item-No" data-id=""><span class="glyphicon glyphicon-remove-circle delete_item"></span>&nbsp;<span class="NoService"></span></td><td class="service_Model"></td><td class="service_Description"></td><td class="service_Qty">1</td></tr>',LabState=new Object;LabState.uploadFileNo=0,LabState.uploadFileList={};var thisPageHref=eouluGlobal.S_getCurPageHref();function pageStyle(t,e,a){a=a||"",1==e?$("#fistPage"+a+", #upPage"+a+", #nextPage"+a+", #lastPage"+a+", #Gotojump"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"):1==t?($("#fistPage"+a+", #upPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#lastPage"+a+", #nextPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):t==e?($("#lastPage"+a+", #nextPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):$("#lastPage"+a+", #nextPage"+a+", #fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")}function insertThumbnails(t){$(".m_table table[data-itable='"+t+"'] td.hastd_Picture").each(function(){var t=$(this).attr("title");if(""==t||"--"==t)return $(this).empty().text("未上传图片"),!0;var e=$(this),a="GetLabPicture?FileName="+t,i=new XMLHttpRequest;i.open("GET",a,!0),i.responseType="blob",i.onload=function(){if(200==this.status){var t=this.response;globalGetImageDataurl(t,.4,e,null,50)}},i.send()})}function tableRender(t,e,a,i){for(var o="",l=1;l<i.length;l++){var n=parseInt(10*(e-1)+l),r="",d=globalDataHandle(i[l].Document,"").split("::");if(0==(d=$.grep(d,function(t,e){return""!=t})).length)r+="未上传";else if(d.length<3)d.map(function(t,e,a){e!=d.length?r+="<span class='td_download_file' title='"+t+"'>"+t+"</span><br>":r+="<span class='td_download_file' title='"+t+"'>"+t+"</span>"});else{var s='<div class="container-fluid" style="padding-left: 1px;padding-right: 1px;padding-bottom:5px;">';s+="<ol>",d.map(function(t,e,a){s+='<li title="'+t+'">'+t+"</li>"}),s+="</ol>",s+="</div>",r+="<span class='td_download_file' title='"+d[0]+"'>"+d[0]+"</span><br>",r+="<span class='td_download_file' title='"+d[1]+"'>"+d[1]+"</span><br>",r+="<a tabindex='0' class='btn btn-info' role='button' data-container='body' data-toggle='popover' data-trigger='focus' data-placement='left' title='第"+n+"条记录--应用文档' data-content='"+s+"'>显示更多...</a>"}o+='<tr><td class="update_td" data-iid="'+i[l].ID+'" data-commodityid="'+i[l].CommodityID+'">'+parseInt(10*(e-1)+l)+'</td><td class="hastd_Model" title="'+i[l].Model+'">'+i[l].Model+'</td><td class="hastd_Description" title="'+i[l].Description+'">'+i[l].Description+'</td><td class="hastd_Number" title="'+i[l].Number+'">'+i[l].Number+'</td><td class="hastd_Laboratory" title="'+i[l].Laboratory+'">'+i[l].Laboratory+'</td><td class="hastd_Picture" title="'+i[l].Picture+'"><img src="image/loading/Spinner-1s-50px.gif" alt="产品图片"></td><td class="detailed_part" title="详细配置"><span class="glyphicon glyphicon-eye-open"></span></td><td class="Document_part" data-ivalue="'+i[l].Document+'">'+r+'</td><td class="UpdateTime_part">'+i[l].UpdateTime+"</td></tr>"}$(".m_table table[data-itable='"+t+"'] tbody").empty().append(o),$(".m_page #currentPage").text(e),$(".m_page #allPage").text(a),$("td.Document_part>a").popover({title:"请预览",html:!0}),resizeTableCol(t),pageStyle(e,a,""),insertThumbnails(t)}function tableRenderAjax(i,o,l){$.ajax({type:"GET",url:"Lab",data:{Laboratory:i,LoadType:"data",CurrentPage:o},dataType:"json",success:function(t){var e=t.pageCount,a=t.data;tableRender(i,o,e,a),l&&l(t)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){}})}function getPageMainData(t,i,o){var l={Laboratory:i,icurPage:o},n=$.param(l);globalInertLoadNoSearch(t,function(a){tableRenderAjax(i,o,function(t){LabPageMainDataObj[n]={};var e=LabPageMainDataObj[n];e[o]={},e[o].searchObj=$.extend(!0,{},l),e[o].expire=a+12e4,e[o].resp=$.extend(!0,{},t)})},LabPageMainDataObj,n,o,function(t){var e=(t=t||{}).pageCount,a=t.data;tableRender(i,o,e,a)},function(a){tableRenderAjax(i,o,function(t){var e=LabPageMainDataObj[n];e[o].expire=a+12e4,e[o].resp=$.extend(!0,{},t)})},function(a){tableRenderAjax(i,o,function(t){var e=LabPageMainDataObj[n];e[o]={},e[o].searchObj=$.extend(!0,{},l),e[o].expire=a+12e4,e[o].resp=$.extend(!0,{},t)})},function(a){tableRenderAjax(i,o,function(t){LabPageMainDataObj[n]={};var e=LabPageMainDataObj[n];e[o]={},e[o].searchObj=$.extend(!0,{},l),e[o].expire=a+12e4,e[o].resp=$.extend(!0,{},t)})})}function calcServiceNo(){$(".serviceReport_table tbody tr").each(function(){var t=$(this).index()+1;$(this).find(".NoService").text(t)})}function canFillItem(){$(".service_Qty").prop("contenteditable","true")}function uploadFiles(){var t=new FormData;t.enctype="multipart/form-data",t.append("Category","labPicture"),t.append("file",$("#serFinRepUpload")[0].files[0]),$.ajax({type:"POST",async:!0,accept:"text/html;charset=UTF-8",data:t,url:"UploadLabPicture",processData:!1,contentType:!1,cache:!1,dataType:"text",xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(t){var e=t.loaded,a=t.total,i=Math.floor(100*e/a)+"%";console.log("已经上传了："+i);var o=400*globalToPoint(i);$(".progressIn").css("width",o+"px").text(i)},!1),myXhr},success:function(t){if(-1<t.indexOf("上传成功")){$("span.isUpload").text("上传成功！");var e=$("input.serFinRepUploadName").val();$(curFileupload).val(e).attr("title",e),$(".dropFileTit span").trigger("click")}else $("span.isUpload").text("上传失败！"),$(".progressIn").css("width","30px").text("0%");$.MsgBox_Unload.Alert("提示",t)},error:function(){$("span.isUpload").text(""),$(".progressIn").css("width","30px").text("0%"),$.MsgBox_Unload.Alert("上传提示","网络繁忙！上传失败！")}})}function uploadFiles2(n,t,a){var i=new FormData;i.enctype="multipart/form-data",i.append("Folder",t);var e=LabState.uploadFileList;$.each(e,function(t,e){i.append("file",e)}),$.ajax({type:"POST",async:!0,accept:"application/json; charset=utf-8",data:i,url:"BatchUpload",processData:!1,contentType:!1,cache:!1,dataType:"json",xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(t){var e=t.loaded,a=t.total,i=Math.floor(1e3*e/a)/10+"%";console.log("已经上传了："+i);var o=(100*globalToPoint(i)).toFixed(0);$("div."+n+"_fileList_info>div:nth-child(1)>div.progress-bar").attr("aria-valuenow",o).css("width",i).text(i)},!1),myXhr},success:function(t){if(0<t.length){var i="",o=0;t.map(function(t,e,a){-1<t.Message.indexOf("成功")?(i+='<li class="list-group-item list-group-item-success" title="'+t.FileName+'"><span class="badge">成功</span>'+t.FileName+"</li>",o++):-1<t.Message.indexOf("失败")?i+='<li class="list-group-item list-group-item-danger" title="'+t.FileName+'"><span class="badge">失败</span>'+t.FileName+"</li>":i+='<li class="list-group-item list-group-item-warning" title="'+t.FileName+'"><span class="badge">文件已存在</span>'+t.FileName+"</li>"}),$("#"+n+"_fileList_ul>li>span:contains('删除')").parent().remove(),$("#"+n+"_fileList_ul").append(i);var e=100*(o/t.length).toFixed(3),a=e+"%";for(var l in $("div."+n+"_fileList_info>div:nth-child(2)>div.progress-bar").attr("aria-valuenow",e).css("width",a).text(a),LabState.uploadFileNo=0,LabState.uploadFileList)delete LabState.uploadFileList[l];$("#"+n+"_file_Upload").val("")}else 0==t.length&&$.MsgBox_Unload.Alert("上传提示","文件读取至服务器失败！")},error:function(){$("div."+n+"_fileList_info>div>div.progress-bar").prop("aria-valuenow","0").css("width","0%").text("0%"),$.MsgBox_Unload.Alert("上传提示","网络繁忙！上传失败！")},beforeSend:function(t){eouluGlobal.C_btnDisabled(a,!1)},complete:function(t,e){eouluGlobal.C_btnAbled(a,!1)}})}function resizeTableCol(t){setTimeout(function(){$(".m_table .JCLRgrips").remove(),$(".m_table table[data-itable='"+t+"']").colResizable({gripInnerHtml:'<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>',partialRefresh:!0,minWidth:62})},50)}function addSearchModelHandle(){var t=$(".add_NonStandard #add_info_Model").val().trim();""==t?$(".add_NonStandard #add_info_Model").val(""):"--"==t?$.MsgBox_Unload.Alert("提示","搜索值格式错误！"):globalGetCommoditySectionInfo(t,"#add_Commodity")}$(function(){"Lab"==thisPageHref?getPageMainData(!0,"苏州",1):"AllLab"==thisPageHref&&getPageMainData(!0,"all",1);var i='<option value="" disabled="disabled">请选择</option>';LaboratoryArr.map(function(t,e,a){i+='<option value="'+t+'">'+t+"</option>"}),$("select[name='Laboratory_sel']").empty().append(i)}),$(".m_button_l input[value='添加']").on("click",function(){$(".bg_cover, .add_NonStandard").slideDown(300),$(".add_NonStandard_body_in [id^='add_info_']").each(function(){$(this).is("#add_info_Laboratory")?"Lab"==thisPageHref?$(this).val($("div.tab_wrapper>ul>li.active").data("laboratory")):"AllLab"==thisPageHref&&$(this).val(""):$(this).val(""),$(this).is("#add_info_Picture")&&$(this).attr("title","")})}),$(document).on("click",".update_td",function(){$(".bg_cover, .update_NonStandard").slideDown(300),updateSubmitObj.ID=Number($(this).data("iid")).toString();var i=$(this);$(".update_NonStandard_body_in [id^='update_info_']").each(function(){var t,e=$(this).attr("id").replace("update_info_","hastd_");t=$(this).is("#update_info_Picture")?i.siblings("."+e).attr("title"):i.siblings("."+e).text();var a=globalDataHandle(t,"");$(this).val(a),$(this).is("#update_info_Picture")&&$(this).attr("title",a)});var t=$(this).siblings(".Document_part").data("ivalue").toString().split("::");t=$.grep(t,function(t,e){return""!=t});var o="";t.map(function(t,e,a){o+='<li class="list-group-item list-group-item-info" title="'+t+'"><span class="badge">已上传</span>'+t+"</li>"}),$("#update_fileList_ul").empty().append(o)}),$("#NonStandard_addclose, .add_NonStandard_tit_r").on("click",function(){for(var t in $(".bg_cover, .add_NonStandard").slideUp(300),$("div.add_fileList_info").is(":visible")&&$("div.add_fileList_info").slideUp(150,function(){$("div.add_fileList_info>div>div.progress-bar").attr("aria-valuenow","0").css("width","0%").text("0%")}),$("#add_fileList_ul").empty(),addSubmitObj)addSubmitObj[t]=null;for(var e in LabState.uploadFileNo=0,LabState.uploadFileList)delete LabState.uploadFileList[e];$("#add_file_Upload").val("")}),$("#NonStandard_updateclose, .update_NonStandard_tit_r").on("click",function(){for(var t in $(".bg_cover, .update_NonStandard").slideUp(300),$("div.update_fileList_info").is(":visible")&&$("div.update_fileList_info").slideUp(150,function(){$("div.update_fileList_info>div>div.progress-bar").attr("aria-valuenow","0").css("width","0%").text("0%")}),$("#update_fileList_ul").empty(),updateSubmitObj)updateSubmitObj[t]=null;for(var e in LabState.uploadFileNo=0,LabState.uploadFileList)delete LabState.uploadFileList[e];$("#update_file_Upload").val("")}),$("#jumpNumber").on("input propertychange",function(){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}),$("#fistPage").click(function(){getPageMainData(!1,$("div.tab_wrapper>ul>li.active").data("laboratory"),1)}),$("#lastPage").click(function(){var t=Number($("#allPage").text());getPageMainData(!1,$("div.tab_wrapper>ul>li.active").data("laboratory"),t)}),$("#upPage").click(function(){var t=Number($("#currentPage").text());1!=t&&(t--,getPageMainData(!1,$("div.tab_wrapper>ul>li.active").data("laboratory"),t))}),$("#nextPage").click(function(){var t=Number($("#currentPage").text());t!=Number($("#allPage").text())&&(t++,getPageMainData(!1,$("div.tab_wrapper>ul>li.active").data("laboratory"),t))}),$("#Gotojump").click(function(){var t=$("#jumpNumber").val().trim(),e=Number($("#allPage").text());t==Number($("#currentPage").text())||t<=0||e<t?$("#jumpNumber").val(""):getPageMainData(!1,$("div.tab_wrapper>ul>li.active").data("laboratory"),t)}),$("#NonStandard_addsubmit").on("click",function(){for(var t in addSubmitObj)"Type"!=t?"Document"!=t&&(addSubmitObj[t]=$("#add_info_"+t).val()):addSubmitObj[t]="add";for(var e in addSubmitObj){if(addSubmitObj[e]=globalDataHandle(addSubmitObj[e],"").trim(),"Model"==e&&""==addSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择系统名称！"),!1;if("Laboratory"==e&&""==addSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择实验室！"),!1}var a=[];$("#add_fileList_ul>li.list-group-item-success").each(function(){a.push($(this).attr("title"))});var i=globalArrStrUnique(a),o=0==i.length?"":i.join("::")+"::";addSubmitObj.Document=o,console.log("add我执行了吗"),console.log(addSubmitObj);var l=addSubmitObj.Laboratory,n=$(this);$.ajax({type:"POST",url:"Lab",dataType:"text",data:addSubmitObj,beforeSend:function(t){eouluGlobal.C_btnDisabled(n,!0,"正在提交...")},success:function(t){"true"==t?($.MsgBox_Unload.Alert("提示","添加成功！"),$("#NonStandard_addclose").trigger("click"),$("div.tab_wrapper>ul>li.active").data("laboratory")==l?getPageMainData(!0,l,1):"Lab"==thisPageHref?$("div.tab_wrapper>ul>li[data-laboratory='"+l+"']>a").trigger("click"):"AllLab"==thisPageHref&&getPageMainData(!0,"all",1)):"false"==t&&$.MsgBox_Unload.Alert("提示","添加失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){eouluGlobal.C_btnAbled(n,!0,"提交")}})}),$("#NonStandard_updatesubmit").on("click",function(){for(var t in updateSubmitObj)"Type"!=t?"ID"!=t&&"Document"!=t&&(updateSubmitObj[t]=$("#update_info_"+t).val()):updateSubmitObj[t]="update";for(var e in updateSubmitObj){if(updateSubmitObj[e]=globalDataHandle(updateSubmitObj[e],"").trim(),"Model"==e&&""==updateSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择系统名称！"),!1;if("Laboratory"==e&&""==updateSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择实验室！"),!1}var a=[];$("#update_fileList_ul>li.list-group-item-success, #update_fileList_ul>li.list-group-item-info").each(function(){a.push($(this).attr("title"))});var i=globalArrStrUnique(a),o=0==i.length?"":i.join("::")+"::";updateSubmitObj.Document=o,console.log("update我执行了吗"),console.log(updateSubmitObj);var l=updateSubmitObj.Laboratory;$.ajax({type:"POST",url:"Lab",dataType:"text",data:updateSubmitObj,success:function(t){"true"==t?($.MsgBox_Unload.Alert("提示","修改成功！"),$("#NonStandard_updateclose").trigger("click"),$("div.tab_wrapper>ul>li.active").data("laboratory")==l?getPageMainData(!0,l,1):"Lab"==thisPageHref?$("div.tab_wrapper>ul>li[data-laboratory='"+l+"']>a").trigger("click"):"AllLab"==thisPageHref&&getPageMainData(!0,"all",1)):"false"==t&&$.MsgBox_Unload.Alert("提示","修改失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){}})});var addThrottle=ecDo.delayFn(addSearchModelHandle,700,1e3);function updateSearchModelHandle(){var t=$(".update_NonStandard #update_info_Model").val().trim();""==t?$(".update_NonStandard #update_info_Model").val(""):"--"==t?$.MsgBox_Unload.Alert("提示","搜索值格式错误！"):globalGetCommoditySectionInfo(t,"#update_Commodity")}$(".add_NonStandard #add_info_Model").on("input propertychange",addThrottle);var updateThrottle=ecDo.delayFn(updateSearchModelHandle,700,1e3);function partSearchModelHandle(){var t=$("#part_search_input").val().trim();""==t?$("#part_search_input").val(""):"--"==t?$.MsgBox_Unload.Alert("提示","搜索值格式错误！"):globalGetCommoditySectionInfo(t,"#part_search_select")}$(".update_NonStandard #update_info_Model").on("input propertychange",updateThrottle),$(document).on("click","#add_Commodity option, #update_Commodity option",function(t){t.stopPropagation(),$(this).parents("#add_Commodity").length?($(".add_NonStandard #add_info_Model").val($("#add_Commodity").val()),$(".add_NonStandard #add_info_Description").val($(this).attr("commodityname")),$("#add_Commodity").fadeOut(200)):$(this).parents("#update_Commodity").length&&($(".update_NonStandard #update_info_Model").val($("#update_Commodity").val()),$(".update_NonStandard #update_info_Description").val($(this).attr("commodityname")),$("#update_Commodity").fadeOut(200))}),$(document).on("click",function(){$("#add_Commodity, #update_Commodity, #part_search_select").fadeOut(200)}),$(document).on("mouseenter",".m_table tbody td",function(){$(this).parent().css({"-webkit-filter":"brightness(0.8)",filter:"brightness(0.8)"})}),$(document).on("mouseleave",".m_table tbody td",function(){$(this).parent().css({"-webkit-filter":"brightness(1)",filter:"brightness(1)"})}),$(document).on("click",".detailed_part span",function(){LabID=$(this).parent().siblings(".update_td").data("iid"),curModel=$(this).parent().siblings(".hastd_Model").text(),$.ajax({type:"GET",url:"LabConfig",data:{LabID:LabID},dataType:"json"}).then(function(t){var i="";t.map(function(t,e,a){0<e&&(i+='<tr><td class="item-No" data-id="'+t.PartID+'"><span class="glyphicon glyphicon-remove-circle delete_item"></span>&nbsp;<span class="NoService"></span></td><td class="service_Model">'+t.Model+'</td><td class="service_Description">'+t.Description+'</td><td class="service_Qty">'+t.Qty+"</td></tr>")}),$(".serviceReport_table tbody").empty().append(i),calcServiceNo(),canFillItem(),$(".serviceReport_div, .cover_bg2").slideDown(200)},function(){$.MsgBox_Unload.Alert("提示","网络繁忙！")}).always(function(){})}),$(".serviceReport_top_r").click(function(){for(var t in curModel=LabID="",downloadObj)downloadObj[t]=null;$(".serviceReport_div, .cover_bg2").slideUp(300)}),$("#add_serviceReport").on("click",function(){$(".serviceReport_table tbody").append(serviceReportStr),calcServiceNo(),canFillItem()}),$(document).on("click",".delete_item",function(){$(this).parent().parent().remove(),calcServiceNo()}),$(document).on("click",".service_Model",function(){searchPartModelIndex=$(this).parent().index(),$("#part_search_input").val(""),$(this).siblings(".item-No").data("id")?$(".part_search_top_l").text("修改详细配置--"+$(this).text()):$(".part_search_top_l").text("添加详细配置item"),$(".cover_bg3, .part_search_div").slideDown(300)}),$(".part_search_top_r").click(function(){$(".cover_bg3, .part_search_div").slideUp(300),searchPartModelIndex=-1});var partThrottle=ecDo.delayFn(partSearchModelHandle,700,1e3);$("#part_search_input").on("input propertychange",partThrottle),$(document).on("click","#part_search_select option",function(t){if(t.stopPropagation(),-1<searchPartModelIndex){var e=$(".serviceReport_table tbody tr").eq(searchPartModelIndex);e.find(".item-No").data("id",$(this).attr("text")),e.find(".service_Model").text($("#part_search_select").val()),e.find(".service_Description").text($(this).attr("commodityname")),e.find(".service_Description").attr("title",$(this).attr("commodityname"))}$("#part_search_select").fadeOut(200),$(".part_search_top_r").trigger("click")}),$(".serviceReport_top_save").click(function(){var i=[];if(0==$(".serviceReport_table tbody tr").length)return $.MsgBox_Unload.Alert("提示","请先添加一条再保存！"),!1;var o=1;if($(".serviceReport_table tbody tr").each(function(){var t={},e=$(this).children(".item-No").data("id");e||(o=0);var a=$(this).children(".service_Qty").text();t.PartID=e,t.Qty=a,i.push(t)}),0==o)return $.MsgBox_Unload.Alert("提示","有型号（Part Number）未选择！"),!1;var t=$.fn.stringifyArr(i);$.ajax({type:"POST",url:"LabConfig",data:{ConfigJson:t,LabID:LabID},dataType:"text"}).then(function(t){console.log(typeof t),"true"==t?$.MsgBox_Unload.Alert("提示","保存成功！"):"false"==t&&$.MsgBox_Unload.Alert("提示","保存失败！")},function(){$.MsgBox_Unload.Alert("提示","服务器繁忙，保存有误！")})}),$(document).on("blur",".service_Qty",function(){var t=$(this).text().replace(/[^\d]+/g,"");""==t?$(this).text("0"):$(this).text(t)}),$(".serviceReport_top_down").click(function(){globalUrlDownloadFile("GET","UploadLabPicture?Model="+curModel+"&LabID="+LabID,null,null)}),$(document).on("click",".hastd_Picture img",function(){var t=$(this).parent().attr("title");if(""==t||"--"==t)return $.MsgBox_Unload.Alert("提示","没有图片！"),!1;var e=t.replace(imgSuffix,"");$(".showPic_top_l").text(e);var a="GetLabPicture?FileName="+t,i=new XMLHttpRequest;i.open("GET",a,!0),i.responseType="blob",i.onload=function(){if(200==this.status){var t=this.response;imageResizeTool.filetoDataURL(t,function(t){var e=document.createElement("img");e.onload=function(t){window.URL.revokeObjectURL(e.src),760<e.width&&(e.width=760),1e3<e.height&&(e.height=1e3)},e.src=t,$(".showPic_body_in").empty().append(e)}),$(".showPic_bgcover, .showPic").slideDown(200)}},i.send()}),$(".showPic_top_r span").click(function(){$(".showPic_bgcover, .showPic").slideUp(200)}),$(".showPic_top_m span").click(function(){var t=$(".showPic_body_in img");if(!t.length)return $.MsgBox_Unload.Alert("下载提示","文件已被删除"),!1;var e=$(".showPic_top_l").text()+".png";globalAutoDownloadImg(t,e)}),$(".add_upload_Picture, .update_upload_Picture").on("click",function(){$(this).parents(".add_NonStandard").length?curFileupload="#add_info_Picture":$(this).parents(".update_NonStandard").length&&(curFileupload="#update_info_Picture"),$(".upload_bgcover, .dropFileBox").slideDown(300)}),$("input.dropUp2").on("click",function(){var t=$("input.serFinRepUploadName").val(),e=$("#serFinRepUpload").val(),a=t.replace(/.*(\/|\\)/,""),i=e.replace(/.*(\/|\\)/,""),o=/[.]/.exec(a)?/[^.]+$/.exec(a.toLowerCase()):"",l=/[.]/.exec(i)?/[^.]+$/.exec(i.toLowerCase()):"";return""==o||""==l?($.MsgBox_Unload.Alert("上传提示","文件没有后缀名，请重新上传"),!1):imgSuffix.test(t)&&imgSuffix.test(e)?void globalGetImgWHSize($("#serFinRepUpload")[0].files[0],function(t,e,a){1048576<a?$.MsgBox_Unload.Alert("上传提示","请上传大小小于1M的图片！"):1e3<t?$.MsgBox_Unload.Alert("上传提示","请上传宽度小于1000像素的图片！"):1e3<e?$.MsgBox_Unload.Alert("上传提示","请上传高度小于1000像素的图片！"):uploadFiles()}):($.MsgBox_Unload.Alert("上传提示","文件不是图片类型，请重新上传"),!1)}),$("#serFinRepUpload").on("change",function(){$("span.isUpload").text(""),$(".progressIn").css("width","30px").text("0%"),console.log("文件上传改变值"+$(this).val());var t=-1<$(this).val().indexOf("\\fakepath\\")?$(this).val().split("\\fakepath\\")[1]:$(this).val().split("\\").pop();console.log("赋给input的值"+t),$("input.serFinRepUploadName").val(t).attr("title",t)}),$(".dropFileTit span").on("click",function(){$(".upload_bgcover, .dropFileBox").slideUp(300),$("span.isUpload").text(""),$(".progressIn").css("width","30px").text("0%"),$("input.serFinRepUploadName").val("").attr("title",""),$("#serFinRepUpload").val("")}),$(".trigger_click").click(function(t){t.preventDefault(),$(this).next().trigger("click")}),$("#add_file_Upload, #update_file_Upload").on("change",function(){var t,e,a;$(this).is("#add_file_Upload")?($("#add_file_Upload"),t=$(".add_fileList_info"),e=$("#add_fileList_ul"),a="add"):$(this).is("#update_file_Upload")&&($("#update_file_Upload"),t=$(".update_fileList_info"),e=$("#update_fileList_ul"),a="update"),t.is(":visible")||t.slideDown(150),console.log($(this)),console.log($(this)[0]),console.log($(this)[0].files);var i=$(this)[0].files,o="";$.each(i,function(t,e){LabState.uploadFileNo++,o+='<li class="list-group-item" title="'+e.name+'" value="'+LabState.uploadFileNo+'"><span class="badge">删除</span>'+e.name+"</li>",LabState.uploadFileList[LabState.uploadFileNo]=e}),e.append(o),$("div."+a+"_fileList_info>div>div.progress-bar").prop("aria-valuenow","0").css("width","0%").text("0%")}),$(document).on("click","[id$='_fileList_ul']>li>span:contains('删除')",function(){var t,e=$(this).parent().attr("value");delete LabState.uploadFileList[e],$(this).parents("#add_fileList_ul").length?t=$("#add_file_Upload"):$(this).parents("#update_fileList_ul").length&&(t=$("#update_file_Upload")),t.val(""),$(this).parent().remove()}),$(".add_label_upload>button, .update_label_upload>button").click(function(){if(0==Object.keys(LabState.uploadFileList).length)return $.MsgBox_Unload.Alert("上传提示","请选择文件！"),!1;var t;$(this).parent().is(".add_label_upload")?t="add":$(this).parent().is(".update_label_upload")&&(t="update");uploadFiles2(t,"LabDocument",$(this))}),$(document).on("click","li.list-group-item-success, li.list-group-item-info, ol>li, span.td_download_file",function(){var t=$(this).attr("title");if(!t)return $.MsgBox_Unload.Alert("下载提示","无数据或文件已被删除！"),!1;var e=globalHostName+"/LogisticsFile/File/LabDocument/"+t;window.open(e)}),$(".tab_wrapper>ul>li>a").click(function(t){t.preventDefault(),$(this).tab("show")}),$(".tab_wrapper>ul>li>a").on("shown.bs.tab",function(t){getPageMainData(!0,$(t.target).parent().data("laboratory").toString(),1)});