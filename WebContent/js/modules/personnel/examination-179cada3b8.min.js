!function(t,e){"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("knockout")?define(["jquery","knockout"],e):e(t.jQuery,t.ko)}(this,function(h,b){"use strict";function s(t,e){this.$select=h(t),this.options=this.mergeOptions(h.extend({},e,this.$select.data())),this.$select.attr("data-placeholder")&&(this.options.nonSelectedText=this.$select.data("placeholder")),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.lastToggledInput=null,this.options.multiple="multiple"===this.$select.attr("multiple"),this.options.onChange=h.proxy(this.options.onChange,this),this.options.onSelectAll=h.proxy(this.options.onSelectAll,this),this.options.onDeselectAll=h.proxy(this.options.onDeselectAll,this),this.options.onDropdownShow=h.proxy(this.options.onDropdownShow,this),this.options.onDropdownHide=h.proxy(this.options.onDropdownHide,this),this.options.onDropdownShown=h.proxy(this.options.onDropdownShown,this),this.options.onDropdownHidden=h.proxy(this.options.onDropdownHidden,this),this.options.onInitialized=h.proxy(this.options.onInitialized,this),this.options.onFiltering=h.proxy(this.options.onFiltering,this),this.buildContainer(),this.buildButton(),this.buildDropdown(),this.buildReset(),this.buildSelectAll(),this.buildDropdownOptions(),this.buildFilter(),this.updateButtonText(),this.updateSelectAll(!0),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups(),this.options.wasDisabled=this.$select.prop("disabled"),this.options.disableIfEmpty&&h("option",this.$select).length<=0&&this.disable(),this.$select.wrap('<span class="multiselect-native-select" />').after(this.$container),this.options.onInitialized(this.$select,this.$container)}void 0!==b&&b.bindingHandlers&&!b.bindingHandlers.multiselect&&(b.bindingHandlers.multiselect={after:["options","value","selectedOptions","enable","disable"],init:function(t,e,i,l,s){var o=h(t),a=b.toJS(e());if(o.multiselect(a),i.has("options")){var n=i.get("options");b.isObservable(n)&&b.computed({read:function(){n(),setTimeout(function(){var t=o.data("multiselect");t&&t.updateOriginalOptions(),o.multiselect("rebuild")},1)},disposeWhenNodeIsRemoved:t})}if(i.has("value")){var r=i.get("value");b.isObservable(r)&&b.computed({read:function(){r(),setTimeout(function(){o.multiselect("refresh")},1)},disposeWhenNodeIsRemoved:t}).extend({rateLimit:100,notifyWhenChangesStop:!0})}if(i.has("selectedOptions")){var c=i.get("selectedOptions");b.isObservable(c)&&b.computed({read:function(){c(),setTimeout(function(){o.multiselect("refresh")},1)},disposeWhenNodeIsRemoved:t}).extend({rateLimit:100,notifyWhenChangesStop:!0})}var d=function(t){setTimeout(function(){t?o.multiselect("enable"):o.multiselect("disable")})};if(i.has("enable")){var p=i.get("enable");b.isObservable(p)?b.computed({read:function(){d(p())},disposeWhenNodeIsRemoved:t}).extend({rateLimit:100,notifyWhenChangesStop:!0}):d(p)}if(i.has("disable")){var u=i.get("disable");b.isObservable(u)?b.computed({read:function(){d(!u())},disposeWhenNodeIsRemoved:t}).extend({rateLimit:100,notifyWhenChangesStop:!0}):d(!u)}b.utils.domNodeDisposal.addDisposeCallback(t,function(){o.multiselect("destroy")})},update:function(t,e,i,l,s){var o=h(t),a=b.toJS(e());o.multiselect("setOptions",a),o.multiselect("rebuild")}}),s.prototype={defaults:{buttonText:function(t,e){if(0<this.disabledText.length&&(e.prop("disabled")||0==t.length&&this.disableIfEmpty))return this.disabledText;if(0===t.length)return this.nonSelectedText;if(this.allSelectedText&&t.length===h("option",h(e)).length&&1!==h("option",h(e)).length&&this.multiple)return this.selectAllNumber?this.allSelectedText+" ("+t.length+")":this.allSelectedText;if(0!=this.numberDisplayed&&t.length>this.numberDisplayed)return t.length+" "+this.nSelectedText;var i="",l=this.delimiterText;return t.each(function(){var t=void 0!==h(this).attr("label")?h(this).attr("label"):h(this).text();i+=t+l}),i.substr(0,i.length-this.delimiterText.length)},buttonTitle:function(t,e){if(0===t.length)return this.nonSelectedText;var i="",l=this.delimiterText;return t.each(function(){var t=void 0!==h(this).attr("label")?h(this).attr("label"):h(this).text();i+=t+l}),i.substr(0,i.length-this.delimiterText.length)},checkboxName:function(t){return!1},optionLabel:function(t){return h(t).attr("label")||h(t).text()},optionClass:function(t){return h(t).attr("class")||""},onChange:function(t,e){},onDropdownShow:function(t){},onDropdownHide:function(t){},onDropdownShown:function(t){},onDropdownHidden:function(t){},onSelectAll:function(){},onDeselectAll:function(){},onInitialized:function(t,e){},onFiltering:function(t){},enableHTML:!1,buttonClass:"btn btn-default",inheritClass:!1,buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',dropRight:!1,dropUp:!1,selectedClass:"active",maxHeight:!1,includeSelectAllOption:!1,includeSelectAllIfMoreThan:0,selectAllText:" Select all",selectAllValue:"multiselect-all",selectAllName:!1,selectAllNumber:!0,selectAllJustVisible:!0,enableFiltering:!1,enableCaseInsensitiveFiltering:!1,enableFullValueFiltering:!1,enableClickableOptGroups:!1,enableCollapsibleOptGroups:!1,collapseOptGroupsByDefault:!1,filterPlaceholder:"Search",filterBehavior:"text",includeFilterClearBtn:!0,preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected",allSelectedText:"All selected",numberDisplayed:3,disableIfEmpty:!1,disabledText:"",delimiterText:", ",includeResetOption:!1,includeResetDivider:!1,resetText:"Reset",templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret"></b></button>',ul:'<ul class="multiselect-container dropdown-menu"></ul>',filter:'<li class="multiselect-item multiselect-filter"><div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text" /></div></li>',filterClearBtn:'<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"></i></button></span>',li:'<li><a tabindex="0"><label></label></a></li>',divider:'<li class="multiselect-item divider"></li>',liGroup:'<li class="multiselect-item multiselect-group"><label></label></li>',resetButton:'<li class="multiselect-reset text-center"><div class="input-group"><a class="btn btn-default btn-block"></a></div></li>'}},constructor:s,buildContainer:function(){this.$container=h(this.options.buttonContainer),this.$container.on("show.bs.dropdown",this.options.onDropdownShow),this.$container.on("hide.bs.dropdown",this.options.onDropdownHide),this.$container.on("shown.bs.dropdown",this.options.onDropdownShown),this.$container.on("hidden.bs.dropdown",this.options.onDropdownHidden)},buildButton:function(){this.$button=h(this.options.templates.button).addClass(this.options.buttonClass),this.$select.attr("class")&&this.options.inheritClass&&this.$button.addClass(this.$select.attr("class")),this.$select.prop("disabled")?this.disable():this.enable(),this.options.buttonWidth&&"auto"!==this.options.buttonWidth&&(this.$button.css({width:"100%",overflow:"hidden","text-overflow":"ellipsis"}),this.$container.css({width:this.options.buttonWidth}));var t=this.$select.attr("tabindex");t&&this.$button.attr("tabindex",t),this.$container.prepend(this.$button)},buildDropdown:function(){if(this.$ul=h(this.options.templates.ul),this.options.dropRight&&this.$ul.addClass("pull-right"),this.options.maxHeight&&this.$ul.css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),this.options.dropUp){var t=Math.min(this.options.maxHeight,26*h('option[data-role!="divider"]',this.$select).length+19*h('option[data-role="divider"]',this.$select).length+(this.options.includeSelectAllOption?26:0)+(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering?44:0)),e=t+34;this.$ul.css({"max-height":t+"px","overflow-y":"auto","overflow-x":"hidden","margin-top":"-"+e+"px"})}this.$container.append(this.$ul)},buildDropdownOptions:function(){this.$select.children().each(h.proxy(function(t,e){var i=h(e),l=i.prop("tagName").toLowerCase();i.prop("value")!==this.options.selectAllValue&&("optgroup"===l?this.createOptgroup(e):"option"===l&&("divider"===i.data("role")?this.createDivider():this.createOptionValue(e)))},this)),h(this.$ul).off("change",'li:not(.multiselect-group) input[type="checkbox"], li:not(.multiselect-group) input[type="radio"]'),h(this.$ul).on("change",'li:not(.multiselect-group) input[type="checkbox"], li:not(.multiselect-group) input[type="radio"]',h.proxy(function(t){var e=h(t.target),i=e.prop("checked")||!1,l=e.val()===this.options.selectAllValue;this.options.selectedClass&&(i?e.closest("li").addClass(this.options.selectedClass):e.closest("li").removeClass(this.options.selectedClass));var s=e.val(),o=this.getOptionByValue(s),a=h("option",this.$select).not(o),n=h("input",this.$container).not(e);if(l?i?this.selectAll(this.options.selectAllJustVisible,!0):this.deselectAll(this.options.selectAllJustVisible,!0):(i?(o.prop("selected",!0),this.options.multiple?o.prop("selected",!0):(this.options.selectedClass&&h(n).closest("li").removeClass(this.options.selectedClass),h(n).prop("checked",!1),a.prop("selected",!1),this.$button.click()),"active"===this.options.selectedClass&&a.closest("a").css("outline","")):o.prop("selected",!1),this.options.onChange(o,i),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()),this.$select.change(),this.updateButtonText(),this.options.preventInputChangeEvent)return!1},this)),h("li a",this.$ul).on("mousedown",function(t){if(t.shiftKey)return!1}),h(this.$ul).on("touchstart click","li a",h.proxy(function(t){t.stopPropagation();var e=h(t.target);if(t.shiftKey&&this.options.multiple){e.is("label")&&(t.preventDefault(),(e=e.find("input")).prop("checked",!e.prop("checked")));var i=e.prop("checked")||!1;if(null!==this.lastToggledInput&&this.lastToggledInput!==e){var l=this.$ul.find("li:visible").index(e.parents("li")),s=this.$ul.find("li:visible").index(this.lastToggledInput.parents("li"));if(s<l){var o=s;s=l,l=o}++s;var a=this.$ul.find("li").not(".multiselect-filter-hidden").slice(l,s).find("input");a.prop("checked",i),this.options.selectedClass&&a.closest("li").toggleClass(this.options.selectedClass,i);for(var n=0,r=a.length;n<r;n++){var c=h(a[n]);this.getOptionByValue(c.val()).prop("selected",i)}}e.trigger("change")}e.is("input")&&!e.closest("li").is(".multiselect-item")&&(this.lastToggledInput=e),e.blur()},this)),this.$container.off("keydown.multiselect").on("keydown.multiselect",h.proxy(function(t){if(!h('input[type="text"]',this.$container).is(":focus"))if(9===t.keyCode&&this.$container.hasClass("open"))this.$button.click();else{var e=h(this.$container).find("li:not(.divider):not(.disabled) a").filter(":visible");if(!e.length)return;var i=e.index(e.filter(":focus"));38===t.keyCode&&0<i?i--:40===t.keyCode&&i<e.length-1?i++:~i||(i=0);var l=e.eq(i);if(l.focus(),32===t.keyCode||13===t.keyCode){var s=l.find("input");s.prop("checked",!s.prop("checked")),s.change()}t.stopPropagation(),t.preventDefault()}},this)),this.options.enableClickableOptGroups&&this.options.multiple&&h("li.multiselect-group input",this.$ul).on("change",h.proxy(function(t){t.stopPropagation();var s=h(t.target).prop("checked")||!1,e=h(t.target).closest("li"),i=e.nextUntil("li.multiselect-group").not(".multiselect-filter-hidden").not(".disabled").find("input"),o=[];this.options.selectedClass&&(s?e.addClass(this.options.selectedClass):e.removeClass(this.options.selectedClass)),h.each(i,h.proxy(function(t,e){var i=h(e).val(),l=this.getOptionByValue(i);s?(h(e).prop("checked",!0),h(e).closest("li").addClass(this.options.selectedClass),l.prop("selected",!0)):(h(e).prop("checked",!1),h(e).closest("li").removeClass(this.options.selectedClass),l.prop("selected",!1)),o.push(this.getOptionByValue(i))},this)),this.options.onChange(o,s),this.$select.change(),this.updateButtonText(),this.updateSelectAll()},this)),this.options.enableCollapsibleOptGroups&&this.options.multiple&&(h("li.multiselect-group .caret-container",this.$ul).on("click",h.proxy(function(t){var e=h(t.target).closest("li").nextUntil("li.multiselect-group").not(".multiselect-filter-hidden"),i=!0;e.each(function(){i=i&&!h(this).hasClass("multiselect-collapsible-hidden")}),i?e.hide().addClass("multiselect-collapsible-hidden"):e.show().removeClass("multiselect-collapsible-hidden")},this)),h("li.multiselect-all",this.$ul).css("background","#f3f3f3").css("border-bottom","1px solid #eaeaea"),h("li.multiselect-all > a > label.checkbox",this.$ul).css("padding","3px 20px 3px 35px"),h("li.multiselect-group > a > input",this.$ul).css("margin","4px 0px 5px -20px"))},createOptionValue:function(t){var e=h(t);e.is(":selected")&&e.prop("selected",!0);var i=this.options.optionLabel(t),l=this.options.optionClass(t),s=e.val(),o=this.options.multiple?"checkbox":"radio",a=h(this.options.templates.li),n=h("label",a);n.addClass(o),n.attr("title",i),a.addClass(l),this.options.collapseOptGroupsByDefault&&"optgroup"===h(t).parent().prop("tagName").toLowerCase()&&(a.addClass("multiselect-collapsible-hidden"),a.hide()),this.options.enableHTML?n.html(" "+i):n.text(" "+i);var r=h("<input/>").attr("type",o),c=this.options.checkboxName(e);c&&r.attr("name",c),n.prepend(r);var d=e.prop("selected")||!1;r.val(s),s===this.options.selectAllValue&&(a.addClass("multiselect-item multiselect-all"),r.parent().parent().addClass("multiselect-all")),n.attr("title",e.attr("title")),this.$ul.append(a),e.is(":disabled")&&r.attr("disabled","disabled").prop("disabled",!0).closest("a").attr("tabindex","-1").closest("li").addClass("disabled"),r.prop("checked",d),d&&this.options.selectedClass&&r.closest("li").addClass(this.options.selectedClass)},createDivider:function(t){var e=h(this.options.templates.divider);this.$ul.append(e)},createOptgroup:function(t){var e=h(t).attr("label"),i=h(t).attr("value"),l=h('<li class="multiselect-item multiselect-group"><a href="javascript:void(0);"><label><b></b></label></a></li>'),s=this.options.optionClass(t);l.addClass(s),this.options.enableHTML?h("label b",l).html(" "+e):h("label b",l).text(" "+e),this.options.enableCollapsibleOptGroups&&this.options.multiple&&h("a",l).append('<span class="caret-container"><b class="caret"></b></span>'),this.options.enableClickableOptGroups&&this.options.multiple&&h("a label",l).prepend('<input type="checkbox" value="'+i+'"/>'),h(t).is(":disabled")&&l.addClass("disabled"),this.$ul.append(l),h("option",t).each(h.proxy(function(t,e){this.createOptionValue(e)},this))},buildReset:function(){if(this.options.includeResetOption){this.options.includeResetDivider&&this.$ul.prepend(h(this.options.templates.divider));var t=h(this.options.templates.resetButton);this.options.enableHTML?h("a",t).html(this.options.resetText):h("a",t).text(this.options.resetText),h("a",t).click(h.proxy(function(){this.clearSelection()},this)),this.$ul.prepend(t)}},buildSelectAll:function(){if("number"==typeof this.options.selectAllValue&&(this.options.selectAllValue=this.options.selectAllValue.toString()),!this.hasSelectAll()&&this.options.includeSelectAllOption&&this.options.multiple&&h("option",this.$select).length>this.options.includeSelectAllIfMoreThan){this.options.includeSelectAllDivider&&this.$ul.prepend(h(this.options.templates.divider));var t=h(this.options.templates.li);h("label",t).addClass("checkbox"),this.options.enableHTML?h("label",t).html(" "+this.options.selectAllText):h("label",t).text(" "+this.options.selectAllText),this.options.selectAllName?h("label",t).prepend('<input type="checkbox" name="'+this.options.selectAllName+'" />'):h("label",t).prepend('<input type="checkbox" />');var e=h("input",t);e.val(this.options.selectAllValue),t.addClass("multiselect-item multiselect-all"),e.parent().parent().addClass("multiselect-all"),this.$ul.prepend(t),e.prop("checked",!1)}},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var t=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find("option").length>=t){if(this.$filter=h(this.options.templates.filter),h("input",this.$filter).attr("placeholder",this.options.filterPlaceholder),this.options.includeFilterClearBtn){var e=h(this.options.templates.filterClearBtn);e.on("click",h.proxy(function(t){clearTimeout(this.searchTimeout),this.query="",this.$filter.find(".multiselect-search").val(""),h("li",this.$ul).show().removeClass("multiselect-filter-hidden"),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()},this)),this.$filter.find(".input-group").append(e)}this.$ul.prepend(this.$filter),this.$filter.val(this.query).on("click",function(t){t.stopPropagation()}).on("input keydown",h.proxy(function(t){13===t.which&&t.preventDefault(),clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(h.proxy(function(){var n,r;this.query!==t.target.value&&(this.query=t.target.value,h.each(h("li",this.$ul),h.proxy(function(t,e){var i=0<h("input",e).length?h("input",e).val():"",l=h("label",e).text(),s="";if("text"===this.options.filterBehavior?s=l:"value"===this.options.filterBehavior?s=i:"both"===this.options.filterBehavior&&(s=l+"\n"+i),i!==this.options.selectAllValue&&l){var o=!1;if(this.options.enableCaseInsensitiveFiltering&&(s=s.toLowerCase(),this.query=this.query.toLowerCase()),this.options.enableFullValueFiltering&&"both"!==this.options.filterBehavior){var a=s.trim().substring(0,this.query.length);-1<this.query.indexOf(a)&&(o=!0)}else-1<s.indexOf(this.query)&&(o=!0);o||(h(e).css("display","none"),h(e).addClass("multiselect-filter-hidden")),o&&(h(e).css("display","block"),h(e).removeClass("multiselect-filter-hidden")),h(e).hasClass("multiselect-group")?(n=e,r=o):(o&&h(n).show().removeClass("multiselect-filter-hidden"),!o&&r&&h(e).show().removeClass("multiselect-filter-hidden"))}},this)));this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups(),this.options.onFiltering(t.target)},this),300,this)},this))}}},destroy:function(){this.$container.remove(),this.$select.show(),this.$select.prop("disabled",this.options.wasDisabled),this.$select.data("multiselect",null)},refresh:function(){var s={};h("li input",this.$ul).each(function(){s[h(this).val()]=h(this)}),h("option",this.$select).each(h.proxy(function(t,e){var i=h(e),l=s[h(e).val()];i.is(":selected")?(l.prop("checked",!0),this.options.selectedClass&&l.closest("li").addClass(this.options.selectedClass)):(l.prop("checked",!1),this.options.selectedClass&&l.closest("li").removeClass(this.options.selectedClass)),i.is(":disabled")?l.attr("disabled","disabled").prop("disabled",!0).closest("li").addClass("disabled"):l.prop("disabled",!1).closest("li").removeClass("disabled")},this)),this.updateButtonText(),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()},select:function(t,e){h.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var l=t[i];if(null!=l){var s=this.getOptionByValue(l),o=this.getInputByValue(l);void 0!==s&&void 0!==o&&(this.options.multiple||this.deselectAll(!1),this.options.selectedClass&&o.closest("li").addClass(this.options.selectedClass),o.prop("checked",!0),s.prop("selected",!0),e&&this.options.onChange(s,!0))}}this.updateButtonText(),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()},clearSelection:function(){this.deselectAll(!1),this.updateButtonText(),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()},deselect:function(t,e){h.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var l=t[i];if(null!=l){var s=this.getOptionByValue(l),o=this.getInputByValue(l);void 0!==s&&void 0!==o&&(this.options.selectedClass&&o.closest("li").removeClass(this.options.selectedClass),o.prop("checked",!1),s.prop("selected",!1),e&&this.options.onChange(s,!1))}}this.updateButtonText(),this.updateSelectAll(),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups()},selectAll:function(t,e){t=void 0===t||t;var i=h("li:not(.divider):not(.disabled):not(.multiselect-group)",this.$ul),l=h("li:not(.divider):not(.disabled):not(.multiselect-group):not(.multiselect-filter-hidden):not(.multiselect-collapisble-hidden)",this.$ul).filter(":visible");t?(h("input:enabled",l).prop("checked",!0),l.addClass(this.options.selectedClass),h("input:enabled",l).each(h.proxy(function(t,e){var i=h(e).val(),l=this.getOptionByValue(i);h(l).prop("selected",!0)},this))):(h("input:enabled",i).prop("checked",!0),i.addClass(this.options.selectedClass),h("input:enabled",i).each(h.proxy(function(t,e){var i=h(e).val(),l=this.getOptionByValue(i);h(l).prop("selected",!0)},this))),h('li input[value="'+this.options.selectAllValue+'"]',this.$ul).prop("checked",!0),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups(),e&&this.options.onSelectAll()},deselectAll:function(t,e){t=void 0===t||t;var i=h("li:not(.divider):not(.disabled):not(.multiselect-group)",this.$ul),l=h("li:not(.divider):not(.disabled):not(.multiselect-group):not(.multiselect-filter-hidden):not(.multiselect-collapisble-hidden)",this.$ul).filter(":visible");t?(h('input[type="checkbox"]:enabled',l).prop("checked",!1),l.removeClass(this.options.selectedClass),h('input[type="checkbox"]:enabled',l).each(h.proxy(function(t,e){var i=h(e).val(),l=this.getOptionByValue(i);h(l).prop("selected",!1)},this))):(h('input[type="checkbox"]:enabled',i).prop("checked",!1),i.removeClass(this.options.selectedClass),h('input[type="checkbox"]:enabled',i).each(h.proxy(function(t,e){var i=h(e).val(),l=this.getOptionByValue(i);h(l).prop("selected",!1)},this))),h('li input[value="'+this.options.selectAllValue+'"]',this.$ul).prop("checked",!1),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups(),e&&this.options.onDeselectAll()},rebuild:function(){this.$ul.html(""),this.options.multiple="multiple"===this.$select.attr("multiple"),this.buildSelectAll(),this.buildDropdownOptions(),this.buildFilter(),this.updateButtonText(),this.updateSelectAll(!0),this.options.enableClickableOptGroups&&this.options.multiple&&this.updateOptGroups(),this.options.disableIfEmpty&&h("option",this.$select).length<=0?this.disable():this.enable(),this.options.dropRight&&this.$ul.addClass("pull-right")},dataprovider:function(t){var o=0,a=this.$select.empty();h.each(t,function(t,e){var l;if(h.isArray(e.children))o++,l=h("<optgroup/>").attr({label:e.label||"Group "+o,disabled:!!e.disabled,value:e.value}),function(t,e){for(var i=0;i<t.length;++i)e(t[i],i)}(e.children,function(t){var e={value:t.value,label:t.label||t.value,title:t.title,selected:!!t.selected,disabled:!!t.disabled};for(var i in t.attributes)e["data-"+i]=t.attributes[i];l.append(h("<option/>").attr(e))});else{var i={value:e.value,label:e.label||e.value,title:e.title,class:e.class,selected:!!e.selected,disabled:!!e.disabled};for(var s in e.attributes)i["data-"+s]=e.attributes[s];(l=h("<option/>").attr(i)).text(e.label||e.value)}a.append(l)}),this.rebuild()},enable:function(){this.$select.prop("disabled",!1),this.$button.prop("disabled",!1).removeClass("disabled")},disable:function(){this.$select.prop("disabled",!0),this.$button.prop("disabled",!0).addClass("disabled")},setOptions:function(t){this.options=this.mergeOptions(t)},mergeOptions:function(t){return h.extend(!0,{},this.defaults,this.options,t)},hasSelectAll:function(){return 0<h("li.multiselect-all",this.$ul).length},updateOptGroups:function(){var t=h("li.multiselect-group",this.$ul),i=this.options.selectedClass;t.each(function(){var t=h(this).nextUntil("li.multiselect-group").not(".multiselect-filter-hidden").not(".disabled"),e=!0;t.each(function(){h("input",this).prop("checked")||(e=!1)}),i&&(e?h(this).addClass(i):h(this).removeClass(i)),h("input",this).prop("checked",e)})},updateSelectAll:function(t){if(this.hasSelectAll()){var e=h("li:not(.multiselect-item):not(.multiselect-filter-hidden):not(.multiselect-group):not(.disabled) input:enabled",this.$ul),i=e.length,l=e.filter(":checked").length,s=h("li.multiselect-all",this.$ul),o=s.find("input");0<l&&l===i?(o.prop("checked",!0),s.addClass(this.options.selectedClass)):(o.prop("checked",!1),s.removeClass(this.options.selectedClass))}},updateButtonText:function(){var t=this.getSelected();this.options.enableHTML?h(".multiselect .multiselect-selected-text",this.$container).html(this.options.buttonText(t,this.$select)):h(".multiselect .multiselect-selected-text",this.$container).text(this.options.buttonText(t,this.$select)),h(".multiselect",this.$container).attr("title",this.options.buttonTitle(t,this.$select))},getSelected:function(){return h("option",this.$select).filter(":selected")},getOptionByValue:function(t){for(var e=h("option",this.$select),i=t.toString(),l=0;l<e.length;l+=1){var s=e[l];if(s.value===i)return h(s)}},getInputByValue:function(t){for(var e=h("li input:not(.multiselect-search)",this.$ul),i=t.toString(),l=0;l<e.length;l+=1){var s=e[l];if(s.value===i)return h(s)}},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(t,e,i){var l=Array.prototype.slice.call(arguments,3);return setTimeout(function(){t.apply(i||window,l)},e)},setAllSelectedText:function(t){this.options.allSelectedText=t,this.updateButtonText()}},h.fn.multiselect=function(e,i,l){return this.each(function(){var t=h(this).data("multiselect");t||(t=new s(this,"object"==typeof e&&e),h(this).data("multiselect",t)),"string"==typeof e&&(t[e](i,l),"destroy"===e&&h(this).data("multiselect",!1))})},h.fn.multiselect.Constructor=s,h(function(){h("select[data-role=multiselect]").multiselect()})}),function(t,e){"function"==typeof define&&define.amd?define(["exports","echarts"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("echarts")):e({},t.echarts)}(this,function(t,e){var i;if(!e)return i="ECharts is not Loaded",void("undefined"!=typeof console&&console&&console.error&&console.error(i));e.registerTheme("eoulu_chart_1",{color:["#3fb1e3","#6be6c1","#626c91","#a0a7e6","#c4ebad","#96dee8"],backgroundColor:"#fcfcfc",textStyle:{},title:{textStyle:{color:"#666666"},subtextStyle:{color:"#999999"}},line:{itemStyle:{normal:{borderWidth:"2"}},lineStyle:{normal:{width:"3"}},symbolSize:"8",symbol:"emptyCircle",smooth:!1},radar:{itemStyle:{normal:{borderWidth:"2"}},lineStyle:{normal:{width:"3"}},symbolSize:"8",symbol:"emptyCircle",smooth:!1},bar:{itemStyle:{normal:{barBorderWidth:0,barBorderColor:"#ccc"},emphasis:{barBorderWidth:0,barBorderColor:"#ccc"}}},pie:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},scatter:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},boxplot:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},parallel:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},sankey:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},funnel:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},gauge:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},candlestick:{itemStyle:{normal:{color:"#e6a0d2",color0:"transparent",borderColor:"#e6a0d2",borderColor0:"#3fb1e3",borderWidth:"2"}}},graph:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"}},lineStyle:{normal:{width:"1",color:"#cccccc"}},symbolSize:"8",symbol:"emptyCircle",smooth:!1,color:["#3fb1e3","#6be6c1","#626c91","#a0a7e6","#c4ebad","#96dee8"],label:{normal:{textStyle:{color:"#ffffff"}}}},map:{itemStyle:{normal:{areaColor:"#eeeeee",borderColor:"#aaaaaa",borderWidth:.5},emphasis:{areaColor:"rgba(63,177,227,0.25)",borderColor:"#3fb1e3",borderWidth:1}},label:{normal:{textStyle:{color:"#ffffff"}},emphasis:{textStyle:{color:"rgb(63,177,227)"}}}},geo:{itemStyle:{normal:{areaColor:"#eeeeee",borderColor:"#aaaaaa",borderWidth:.5},emphasis:{areaColor:"rgba(63,177,227,0.25)",borderColor:"#3fb1e3",borderWidth:1}},label:{normal:{textStyle:{color:"#ffffff"}},emphasis:{textStyle:{color:"rgb(63,177,227)"}}}},categoryAxis:{axisLine:{show:!0,lineStyle:{color:"#cccccc"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,textStyle:{color:"#999999"}},splitLine:{show:!0,lineStyle:{color:["#eeeeee"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},valueAxis:{axisLine:{show:!0,lineStyle:{color:"#cccccc"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,textStyle:{color:"#999999"}},splitLine:{show:!0,lineStyle:{color:["#eeeeee"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},logAxis:{axisLine:{show:!0,lineStyle:{color:"#cccccc"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,textStyle:{color:"#999999"}},splitLine:{show:!0,lineStyle:{color:["#eeeeee"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},timeAxis:{axisLine:{show:!0,lineStyle:{color:"#cccccc"}},axisTick:{show:!1,lineStyle:{color:"#333"}},axisLabel:{show:!0,textStyle:{color:"#999999"}},splitLine:{show:!0,lineStyle:{color:["#eeeeee"]}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.05)","rgba(200,200,200,0.02)"]}}},toolbox:{iconStyle:{normal:{borderColor:"#999999"},emphasis:{borderColor:"#666666"}}},legend:{textStyle:{color:"#999999"}},tooltip:{axisPointer:{lineStyle:{color:"#cccccc",width:1},crossStyle:{color:"#cccccc",width:1}}},timeline:{lineStyle:{color:"#626c91",width:1},itemStyle:{normal:{color:"#626c91",borderWidth:1},emphasis:{color:"#626c91"}},controlStyle:{normal:{color:"#626c91",borderColor:"#626c91",borderWidth:.5},emphasis:{color:"#626c91",borderColor:"#626c91",borderWidth:.5}},checkpointStyle:{color:"#3fb1e3",borderColor:"rgba(63,177,227,0.15)"},label:{normal:{textStyle:{color:"#626c91"}},emphasis:{textStyle:{color:"#626c91"}}}},visualMap:{color:["#2a99c9","#afe8ff"]},dataZoom:{backgroundColor:"rgba(255,255,255,0)",dataBackgroundColor:"rgba(222,222,222,1)",fillerColor:"rgba(114,230,212,0.25)",handleColor:"#cccccc",handleSize:"100%",textStyle:{color:"#999999"}},markPoint:{label:{normal:{textStyle:{color:"#ffffff"}},emphasis:{textStyle:{color:"#ffffff"}}}}})});var multiSelectOption={disableIfEmpty:!0,disabledText:"未选择",delimiterText:"; ",enableFiltering:!0,filterPlaceholder:"搜索",includeResetOption:!0,includeResetDivider:!0,includeSelectAllOption:!0,enableClickableOptGroups:!0,enableCollapsibleOptGroups:!0,collapseOptGroupsByDefault:!0,resetText:"重置",maxHeight:250,buttonWidth:"360px",numberDisplayed:4,onChange:function(t,e,i){},onDropdownHide:function(t){},optionClass:function(t){return $(t).index()%2==0?"even":"odd"}},seriesLabel={normal:{show:!0,textBorderColor:"#333",textBorderWidth:2}},examChartOption={title:{text:"",textStyle:{color:"#888",fontSize:15},subtext:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["已完成","未完成"]},grid:{left:100},toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},xAxis:{type:"value",name:"人数",minInterval:1,axisLabel:{textStyle:{color:"rgba(0,0,0,0.9)",fontSize:16},formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:[],axisLabel:{textStyle:{color:"rgba(0,0,0,0.9)",fontSize:13},formatter:function(t){var e="",i=t.length,l=Math.ceil(i/3);if(1<l){for(var s=0;s<l;s++){var o=3*s,a=o+3;e+=t.substring(o,a)+"\n"}return e}return t},margin:5}},series:[{name:"已完成",type:"bar",data:[],label:seriesLabel,itemStyle:{normal:{color:function(t){return"汇总"==t.name?"#C93F64":"#3fb1e3"},barBorderRadius:3}}},{name:"未完成",type:"bar",label:seriesLabel,data:[],itemStyle:{normal:{color:function(t){return"汇总"==t.name?"#4B7BC5":"#6be6c1"},barBorderRadius:3}}}]},addSubmitObj=new Object;addSubmitObj.Item=null,addSubmitObj.Type=null,addSubmitObj.ID=null,addSubmitObj.SerialNumber=null,addSubmitObj.Subject=null,addSubmitObj.Number=null,addSubmitObj.Time=null;var updateSubmitObj=new Object;updateSubmitObj.Item=null,updateSubmitObj.Type=null,updateSubmitObj.ID=null,updateSubmitObj.SerialNumber=null,updateSubmitObj.Subject=null,updateSubmitObj.Number=null,updateSubmitObj.Time=null;var ichart,presentSwitchClassify,curNoticeIndex,initEchartsHook=0,subjectArr=[],changeState=0,department2ExamierObj={};function setCoverWH(){var t=$("#NonStandard_sticker").width(),e=$("#NonStandard_sticker").height();$(".bg_cover, .cover_bg2").css({width:t+"px",height:e+"px"})}function scoreContenteditable(t){$(".exam_detail_more_detable .hastd_details_Score").prop("contenteditable",t)}function pageStyle(t,e){1==e?($("#fistPage").attr("disabled","disabled"),$("#upPage").attr("disabled","disabled"),$("#nextPage").attr("disabled","disabled"),$("#lastPage").attr("disabled","disabled"),buttonDisabled("#fistPage, #upPage, #nextPage, #lastPage")):1==t?($("#fistPage").attr("disabled","disabled"),$("#upPage").attr("disabled","disabled"),$("#lastPage").attr("disabled",!1),$("#nextPage").attr("disabled",!1),buttonDisabled("#fistPage, #upPage"),buttonAbled("#nextPage, #lastPage")):t==e?($("#lastPage").attr("disabled","disabled"),$("#nextPage").attr("disabled","disabled"),$("#fistPage").attr("disabled",!1),$("#upPage").attr("disabled",!1),buttonDisabled("#nextPage, #lastPage"),buttonAbled("#fistPage, #upPage")):($("#lastPage, #nextPage, #fistPage, #upPage").attr("disabled",!1),buttonAbled("#lastPage, #nextPage, #fistPage, #upPage"))}function buttonDisabled(t){return $(t).removeClass("buttonDisabled buttonAbled").addClass("buttonDisabled")}function buttonAbled(t){return $(t).removeClass("buttonDisabled buttonAbled").addClass("buttonAbled")}function getQuesBySubject(t,l,e){$.ajax({type:"GET",url:"ExaminationDetails",data:{Type:"number",Subject:t},dataType:"json"}).then(function(t,e,i){l&&l(t)},function(t,e,i){$.MsgBox_Unload.Alert("提示","该科目无相应试题数据！")}).always(function(){e&&e()})}function setChartsContH(t){var e=65*t.length+60;$("#exam_statis_chart").css("height",e+"px");var i=e+50;$(".exam_statistics_chart").css("height",i+"px")}function initEcharts(t){setChartsContH(t),$(window).trigger("resize"),ichart=echarts.init(document.getElementById("exam_statis_chart"),"eoulu_chart_1"),initEchartsHook=1}function renderEcharts(t,e,i,l,s){setChartsContH(t),ichart.resize(),examChartOption.yAxis.data=t,examChartOption.series[0].data=e,examChartOption.series[1].data=i,examChartOption.title.text=l,examChartOption.title.subtext=s,examChartOption&&"object"==typeof examChartOption&&ichart.setOption(examChartOption,!0),ichart.off("click"),ichart.on("click",function(t){if(console.log(t.name),console.log(l),console.log(s),"汇总"==t.name)return!1;$("#exam_detail_department").val(t.name),$(".g_container_info_l li:nth-child(2)").trigger("click")}),setTimeout(function(){window.onresize=function(){ichart.resize()}},150),$(".exam_statistics_chart_tit").text(l+" "+s+" 数据统计图表")}function chartGetData(t,e,i){$.ajax({type:"GET",url:"AssessmentStatistics",data:{LoadType:"data",Number:t},dataType:"json"}).then(function(t){if(1==t.length)$.MsgBox_Unload.Alert("提示","无相应数据！");else{var l=["汇总"],s=[],o=[];t.map(function(t,e,i){0<e&&(l.push(t.Department),s.push(t.Finished),o.push(t.NotFinished))});var a=0,n=0;s.map(function(t,e,i){a+=Number(t)}),o.map(function(t,e,i){n+=Number(t)}),s.unshift(a),o.unshift(n),0==initEchartsHook&&initEcharts(l),renderEcharts(l,s,o,e,i)}},function(){$.MsgBox_Unload.Alert("统计图提示","网络繁忙！请求数据失败")}).always(function(){})}function examStatisInit(){$.ajax({type:"GET",url:"ExaminationDetails",data:{Type:"subject"},dataType:"json",success:function(t){var l=[];if(t.map(function(t,e,i){0<e&&l.push(t.Subject)}),0<(subjectArr=globalArrStrUnique(l)).length){var s="";subjectArr.map(function(t,e,i){s+='<option value="'+t+'">'+t.replace(/^《/,"").replace(/》$/,"")+"</option>"}),$("select[name='subject_select']").empty().append(s)}else $.MsgBox_Unload.Alert("提示","科目列表长度为0！")},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！获取科目列表有误")},complete:function(t,e){if("success"==e)getQuesBySubject($("#exam_detail_subject").val(),function(t){var l="";t.map(function(t,e,i){0<e&&(l+='<option value="'+t.Number+'">'+t.Number+"</option>")}),$("#exam_detail_paper").empty().append(l),$("#exam_detail_freshen").trigger("click")},function(){});else if("error"==e);else if("timeout"==e){(window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHttp")).abort()}}})}function getDetailBySearch(l){var t=$("#exam_detail_paper").val(),s=$("#exam_detail_department").val();$.ajax({type:"GET",url:"ExaminationDetails",data:{Type:"details",CurrentPage:l,Number:t,Department:s},dataType:"json",success:function(t){var e=t.data,i=t.pageCount;renderDetailBySearch(e,l,i,s),pageStyle(l,i),tdDateHandle("td.hastd_details_Time","","#000")},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&setCoverWH()}})}function renderDetailBySearch(t,s,e,o){var a;if(1==t.length){var i=$(".exam_detail_more_detable thead tr:nth-child(1) th:visible").length;a='<tr><td colspan="'+i+'" style="text-align:center;">无数据......</td></tr>'}else 1<t.length&&t.map(function(t,e,i){if(0<e){a+='<tr><td data-id="'+t.ScoreID+'" data-classify="'+t.Classify+'" data-serialnumber="'+t.SerialNumber+'">'+parseInt(10*(parseInt(s)-1)+e)+'</td><td class="hastd_details_department">'+o+'</td><td class="hastd_details_Examiner">'+t.Examiner+"</td>";var l=t.Score;a+="P"==l?'<td class="hastd_details_Score" title="P"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></td>':""===l||"--"==l?'<td class="hastd_details_Score">待批阅</td>':'<td class="hastd_details_Score" title="'+l+'">'+l+"</td>",a+='<td class="hastd_details_Time">'+t.Time+"</td></tr>"}});$(".exam_detail_more_detable tbody").empty().append(a),$(".m_page #currentPage").text(s),$(".m_page #allPage").text(e)}function getAssessNotice(l){$.ajax({type:"GET",url:"AssessmentNotice",data:{CurrentPage:l},dataType:"json",success:function(t){var e=t.data,i=t.pageCount;renderAssessNotice(e,l,i),pageStyle(l,i),tdDateHandle("td.notice_Time","","#000")},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&setCoverWH()}})}function renderAssessNotice(t,e,i){for(var l="",s=1;s<t.length;s++){var o,a=t[s].ExaminersID;o=0==a.length?"":a.join(","),l+='<tr><td class="update_td_notice" data-id="'+t[s].ID+'" data-classify="'+t[s].Classify+'" data-serialnumber="'+t[s].SerialNumber+'">'+parseInt(10*(parseInt(e)-1)+s)+'</td><td class="notice_Subject" title="'+t[s].Subject+'">'+t[s].Subject+'</td><td class="notice_Number" title="'+t[s].Number+'">'+t[s].Number+'</td><td class="notice_Time">'+t[s].Time+'</td><td class="notice_departments" title="'+t[s].Department+'">'+t[s].Department+'</td><td class="notice_Examiners" title="'+t[s].Examiners+'" data-examineridstr="'+o+'">'+t[s].Examiners+'</td><td class="notice_PublishDate">'+t[s].PublishDate+'</td><td class="notice_Status"><input type="button" class="examiner_publish_save" value="保存"><input type="button" value="'+t[s].Status+'"></td></tr>'}$(".m_table4 tbody").empty().append(l),$(".m_page #currentPage").text(e),$(".m_page #allPage").text(i)}function getGoPage(t){"detail"==presentSwitchClassify?($(".exam_btn_div .InScore").val("录入分数"),getDetailBySearch(t)):"notice"==presentSwitchClassify&&getAssessNotice(t)}function departmentInit(){var l="",s="";globalAllDepartArr.map(function(t,e,i){l+='<option value="'+t+'">'+t+"</option>",s+='<option value="'+t+'">'+t+"</option>"}),$("#exam_detail_department").empty().append(l),$("#department_select").empty().append(s)}$(function(){examStatisInit(),setCoverWH(),departmentInit(),multiSelectOption.selectAllText="选择所有部门！",$("#department_select").multiselect(multiSelectOption),multiSelectOption.selectAllText="选择所有人员！",$("#examiner_select").multiselect(multiSelectOption);var e=[],a=0,i=function(t){if(1<t.length){department2ExamierObj[globalAllDepartArr[a]]=[];var o={};o.label=globalAllDepartArr[a],o.value=globalAllDepartArr[a],o.children=[],t.map(function(t,e,i){if(0<e){var l={};l.label=t.StaffName,l.value=t.ID,l.select=!1,l.disabled=!0,l.attributes={examiner:t.StaffName},o.children.push(l);var s={};s.ID=t.ID,s.StaffName=t.StaffName,department2ExamierObj[globalAllDepartArr[a]].push(s)}}),e.push(o)}++a<globalAllDepartArr.length?$.when($.ajax({type:"GET",url:"GetStaffInfo",data:{Type:"common",Department:globalAllDepartArr[a]},dataType:"json"})).done(i):a==globalAllDepartArr.length&&$("#examiner_select").multiselect("dataprovider",e)};$.when($.ajax({type:"GET",url:"GetStaffInfo",data:{Type:"common",Department:globalAllDepartArr[a]},dataType:"json"})).then(i,function(){$.MsgBox_Unload.Alert("获取员工姓名提示","初始化失败！")})}),$(".exam_btn_div input[value='添加']").on("click",function(){$(".add_NonStandard_body_in [class^='info_']").each(function(){$(this).val("")}),$(".bg_cover, .add_NonStandard").slideDown(350)}),$(document).on("click",".update_td_notice",function(){updateSubmitObj.ID=Number($(this).data("id")).toString();var l=$(this).data("serialnumber"),s=$(this);$(".update_NonStandard_body_in [class^='info_']").each(function(){var t,e=$(this).attr("class").split(" ")[0].replace("info_","notice_");switch(e){case"notice_SerialNumber":t=l;break;default:t=s.siblings("."+e).text()}var i=globalDataHandle(t,"");$(this).val(i)}),$(".bg_cover, .update_NonStandard").slideDown(350)}),$(".exam_btn_div .InScore").on("click",function(){if(1==$(".exam_detail_more_detable tbody tr").length&&1==$(".exam_detail_more_detable tbody>tr>td").length)return!1;if("录入分数"==$(this).val())scoreContenteditable("true"),$(this).val("提交分数");else if("提交分数"==$(this).val()){var i,l=$(this),e=[],s=Number($("span#currentPage").text());$(".exam_detail_more_detable .hastd_details_Score").each(function(){if("待批阅"==$(this).text().trim())return!0;var t={};t.Score=$(this).attr("title"),t.ScoreID=$(this).siblings("td:nth-child(1)").data("id"),e.push(t)}),e=JSON.stringify(e),$.ajax({type:"POST",url:"ExaminationDetails",data:{Item:"score",ScoreJson:e},dataType:"text",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){"保存成功"==t?($.MsgBox_Unload.Alert("提示","修改分数成功！"),i=1):("部分分数保存失败"==t?$.MsgBox_Unload.Alert("提示","部分分数保存失败！"):$.MsgBox_Unload.Alert("提示","修改分数失败！"),i=0)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&1==i&&(getDetailBySearch(s),scoreContenteditable("false"),l.val("录入分数"))}})}}),$("#NonStandard_addclose, .add_NonStandard_tit_r").on("click",function(){for(var t in addSubmitObj)addSubmitObj[t]=null;$(".bg_cover, .add_NonStandard").slideUp(350)}),$("#NonStandard_updateclose, .update_NonStandard_tit_r").on("click",function(){for(var t in updateSubmitObj)updateSubmitObj[t]=null;$(".bg_cover, .update_NonStandard").slideUp(350)}),$("#jumpNumber").on("input propertychange",function(){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}),$("#fistPage").click(function(){getGoPage(1)}),$("#lastPage").click(function(){getGoPage(Number($("#allPage").text()))}),$("#upPage").click(function(){var t=Number($("#currentPage").text());1!=t&&getGoPage(--t)}),$("#nextPage").click(function(){var t=Number($("#currentPage").text());t!=Number($("#allPage").text())&&getGoPage(++t)}),$("#Gotojump").click(function(){var t=$("#jumpNumber").val().trim(),e=Number($("#allPage").text());t==Number($("#currentPage").text())||t<=0||e<t?$("#jumpNumber").val(""):getGoPage(t)}),$("#NonStandard_addsubmit").on("click",function(){var t=$(".add_NonStandard .info_SerialNumber").val().trim(),e=$(".add_NonStandard .info_Number").val().trim();if(""==t||""==e)return $.MsgBox_Unload.Alert("提示","序号与编号不能为空"),!1;if(0!=e.indexOf(t))return $.MsgBox_Unload.Alert("提示","序号与编号不匹配"),!1;for(var i in addSubmitObj)addSubmitObj[i]="Item"!=i?"Type"!=i?"ID"!=i?$(".add_NonStandard").find(".info_"+i).val():"0":"add":"examination";for(var l in addSubmitObj)addSubmitObj[l]=globalDataHandle(addSubmitObj[l],"").trim();console.log("add我执行了吗"),console.log(addSubmitObj),$.ajax({type:"POST",url:"ExaminationDetails",dataType:"text",data:addSubmitObj,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){"true"==t?($.MsgBox_Unload.Alert("提示","添加成功！"),$("#NonStandard_addclose").trigger("click")):"false"==t&&$.MsgBox_Unload.Alert("提示","添加失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){"success"==e&&getAssessNotice(1)}})}),$("#NonStandard_updatesubmit").on("click",function(){var t=$(".update_NonStandard .info_SerialNumber").val().trim(),e=$(".update_NonStandard .info_Number").val().trim();if(""==t||""==e)return $.MsgBox_Unload.Alert("提示","序号与编号不能为空"),!1;if(0!=e.indexOf(t))return $.MsgBox_Unload.Alert("提示","序号与编号不匹配"),!1;for(var i in updateSubmitObj)"Item"!=i?"Type"!=i?"ID"!=i&&(updateSubmitObj[i]=$(".update_NonStandard").find(".info_"+i).val()):updateSubmitObj[i]="update":updateSubmitObj[i]="examination";for(var l in updateSubmitObj)updateSubmitObj[l]=globalDataHandle(updateSubmitObj[l],"").trim();var s=Number($("span#currentPage").text());console.log("update我执行了吗"),console.log(updateSubmitObj),$.ajax({type:"POST",url:"ExaminationDetails",dataType:"text",data:updateSubmitObj,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){console.log(typeof t),"true"==t?($.MsgBox_Unload.Alert("提示","修改成功！"),$("#NonStandard_updateclose").trigger("click")):"false"==t&&$.MsgBox_Unload.Alert("提示","修改失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},complete:function(t,e){"success"==e&&getAssessNotice(s)}})}),$(document).on("click",".notice_Status input",function(){if("保存"==$(this).val()){var i=Number($(".pageInfo #currentPage").text()),t=$(this).parent().siblings("td:nth-child(1)").data("id"),e=$(".m_table4 tbody tr").find("td:nth-child(1)[data-id='"+t+"']").parent(),l=e.find(".notice_Subject").text(),s=e.find(".notice_Number").text(),o=e.find(".notice_Time").text(),a=e.find(".notice_Examiners").data("examineridstr").toString(),n=e.find(".notice_Examiners").text(),r=[],c=[];if(r=""==n?[]:n.split("、"),c=""==a?[]:a.split(","),0==r.length||0==c.length)return void $.MsgBox_Unload.Alert("提示","考核人员未选");if(r.length!=c.length)return void $.MsgBox_Unload.Alert("提示","考核人员选择操作失误");var d=e.find(".notice_departments").text();$.ajax({type:"POST",url:"AssessmentNotice",dataType:"text",data:{Type:"save",SubjectID:t,Examiners:r,ExaminerID:c,Subject:l,Number:s,Time:o,Department:d},contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){$.MsgBox_Unload.Alert("提示",t)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},complete:function(t,e){"success"==e&&getAssessNotice(i)}})}else{var p=$(this).parent().siblings(".notice_Examiners").text();if(""==p||null==p)return $.MsgBox_Unload.Alert("提示","考核人员未选"),!1;var u=p.split("、"),h="";u.map(function(t,e,i){h+='<li title="'+t+'"><input type="checkbox">'+t+"</li>"}),$("#publish_Candidate").empty().append(h),$(".bg_cover, .publish_NonStandard").slideDown(200),$(".publish_NonStandard").attr("value",$(this).parent().siblings("td:nth-child(1)").data("id"))}}),$(document).on("click","#NonStandard_publishSend, .publish_NonStandard_tit_r",function(){$(".publish_NonStandard, .bg_cover").slideUp(200)}),$(document).on("click","#NonStandard_publishSave",function(){var t=$(".publish_NonStandard").attr("value"),e=$(".m_table4 tbody tr").find("td:nth-child(1)[data-id='"+t+"']").parent(),i=e.find(".notice_Subject").text(),l=e.find(".notice_Number").text(),s=e.find(".notice_Time").text(),o=e.find(".notice_Examiners").data("examineridstr").toString(),a=e.find(".notice_Examiners").text(),n=[],r=[];n=""==a?[]:a.split("、"),r=""==o?[]:o.split(",");var c,d=[];if($("#publish_Candidate li").each(function(){$(this).find("input").prop("checked")&&d.push($(this).attr("title"))}),0==d.length)return $.MsgBox_Unload.Alert("提示","未选择收件人"),!1;if(c=d.join(";"),0==n.length||0==r.length)return $.MsgBox_Unload.Alert("提示","考核人员未选"),void $("#NonStandard_publishSend").trigger("click");if(n.length!=r.length)return $.MsgBox_Unload.Alert("提示","考核人员选择操作失误"),void $("#NonStandard_publishSend").trigger("click");var p=e.find(".notice_departments").text();$.ajax({type:"POST",url:"AssessmentNotice",dataType:"text",data:{Type:"send",SubjectID:t,Examiners:n,ExaminerID:r,Subject:i,Number:l,Time:s,Department:p,Recipient:c},contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){$.MsgBox_Unload.Alert("提示",t)},error:function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")},beforeSend:function(t){$("#NonStandard_publishSave").css({cursor:"not-allowed"}),$("#NonStandard_publishSave").prop("disabled",!0)},complete:function(t,e){$("#NonStandard_publishSave").css({cursor:"pointer"}),$("#NonStandard_publishSave").prop("disabled",!1),"success"==e&&(getAssessNotice(1),$("#NonStandard_publishSend").trigger("click"))}})}),$(document).on("click",".notice_departments",function(){curNoticeIndex=$(this).parent("tr").index();var t,e=$(this).attr("title");t=null==e||""==e||"--"==e?[]:e.split("、"),$("#department_select").multiselect("deselectAll",!1),$("#department_select").multiselect("updateButtonText"),$("#department_select").multiselect("select",t),$(".cover_bg2, .department_sele").slideDown(300)}),$(".department_sele_top_r").click(function(){var t=[];$("#department_select option:selected").each(function(){t.push($(this).val())});var e=$(".exam_detail_notice_detable tbody tr").eq(curNoticeIndex),i=t.join("、");e.find(".notice_departments").text(i).attr("title",i),$(".cover_bg2, .department_sele").slideUp(300)}),$(document).on("click",".notice_Examiners",function(){var t=$(this).siblings(".notice_departments").text();if(""==t||"--"==t)return $.MsgBox_Unload.Alert("提示","请先选择部门！"),!1;var e=t.split("、"),l=[],i=[];for(var s in department2ExamierObj)-1<e.indexOf(s)?department2ExamierObj[s].map(function(t,e,i){l.push(t.ID)}):i.push(s);$("option",$("#examiner_select")).prop("disabled",!0),$("option",$("#examiner_select")).each(function(t){$(this).removeAttr("selected").prop("selected",!1)}),$(".examiner_sel .multiselect-item.multiselect-group input").prop("disabled",!1),l.map(function(t,e,i){$('option[value="'+t+'"]',$("#examiner_select")).prop("disabled",!1)}),$("#examiner_select").multiselect("refresh");var o,a=$(this).siblings("td:nth-child(1)").data("id");$(".examiner_sel").attr("value",a),o=null==$(this).data("examineridstr")||""==$(this).data("examineridstr")?[]:$(this).data("examineridstr").toString().split(","),$("#examiner_select").multiselect("select",o),i.map(function(t,e,i){$(".examiner_sel .multiselect-item.multiselect-group input[value='"+t+"']").prop("disabled",!0).removeAttr("checked").prop("checked",!1).parents("li.multiselect-item.multiselect-group.active").removeClass("active")}),$(".cover_bg2, .examiner_sel").slideDown(300)}),$(".examiner_sel_top_r").on("click",function(){var t=[],e=[];$("#examiner_select option:selected").each(function(){t.push($(this).val()),e.push($(this).data("examiner"))});var i=t.join(","),l=e.join("、"),s=$(".examiner_sel").attr("value"),o=$(".m_table4 tbody tr").find("td:nth-child(1)[data-id='"+s+"']").parent().find(".notice_Examiners");o.data("examineridstr",i),o.text(l),o.attr("title",l),console.log("考核通知选人关闭"),console.log(o.data("examineridstr")),console.log(typeof o.data("examineridstr")),$(".cover_bg2, .examiner_sel").slideUp(300)}),$(document).on("focus",".exam_detail_more_detable .hastd_details_Score",function(){return"P"==$(this).attr("title")?($(this).text(""),!1):"待批阅"==$(this).text().trim()?($(this).text(""),!1):void 0}),$(document).on("blur",".exam_detail_more_detable .hastd_details_Score",function(){var t=$(this).text().trim();if("P"==t||"p"==t)return $(this).html('<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>'),$(this).attr("title","P"),!1;new RegExp("^(\\d|[1-9]\\d|[1][0-1]\\d|120)$").test(t)?($(this).text(t),$(this).attr("title",t)):$(this).text("待批阅")}),$(".g_container_info_l li").click(function(){setCoverWH(),$(this).addClass("current_tab").siblings("li").removeClass("current_tab");var t=$(this).data("classify").replace("_tab","_content");$("div[class$='_content']:not(."+t+")").slideUp(250,"swing",function(){$("div."+t).slideDown(300),"exam_statistics_content"==t?($("form.exam_detail_form").fadeIn(100),$(".form_sel_depart").fadeOut(50,function(){examStatisInit()})):"exam_detail_content"==t&&$(".form_sel_depart").fadeIn(50,function(){$(".presentation_div ul li:nth-child(1)").trigger("click")})})}),$(".presentation_div ul>li").click(function(){setCoverWH(),$(this).addClass("active").siblings("li").removeClass("active");var t=$(this).data("classify").replace("_presentation","_detable");$("div[class$='_detable']:not(."+t+")").slideUp(250,"swing",function(){$("div."+t).slideDown(250),"exam_detail_more_detable"==t?(presentSwitchClassify="detail",$(".exam_btn_div input[value='添加']").fadeOut(125,function(){$("form.exam_detail_form, .exam_btn_div .InScore").fadeIn(125,function(){$("#exam_detail_freshen").trigger("click")}),$(".exam_btn_div .InScore").val("录入分数")})):"exam_detail_notice_detable"==t&&(getAssessNotice(1),presentSwitchClassify="notice",$("form.exam_detail_form, .exam_btn_div .InScore").fadeOut(125,function(){$(".exam_btn_div input[value='添加']").fadeIn(125)}))})}),$(window).on("resize",function(){var t=$(".exam_statistics_chart").width();$("#exam_statis_chart").css({width:t+"px"})}),$("select[name='subject_select']").on("change",function(){var t=$(this).val(),e=$(this).attr("id").replace("_subject","_paper");getQuesBySubject(t,function(t){var l="";t.map(function(t,e,i){0<e&&(l+='<option value="'+t.Number+'" data-tit="'+t.Title+'">'+t.Number+"&nbsp;&nbsp;"+t.Title.substring(0,10)+"</option>")}),$("#"+e).empty().append(l)},function(){})}),$("#exam_detail_freshen").click(function(){if($(".form_sel_depart").is(":visible"))getDetailBySearch(1);else{var t=$("#exam_detail_subject").val(),e=$("#exam_detail_paper").val();chartGetData(e,t,e)}$(".exam_btn_div .InScore").val("录入分数")});