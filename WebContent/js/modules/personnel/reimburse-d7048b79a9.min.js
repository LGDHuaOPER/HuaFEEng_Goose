!function(){$.Response_Load={Before:function(t,e,a){i(t,e),""===a||null==a?alertGroupOpen(".eoulu-response-load-bg",".eoulu-response-load",200):alertGroupOpen(".eoulu-response-load-bg",".eoulu-response-load",a),$(window).on("resize",function(){alertResponse(".eoulu-response-load",250,355)})},Loading:function(t){e(t)},After:function(t,e){a(t,e)}};var i=function(t,e){if(0==$(".eoulu-response-load").length){var a="";a+='<div class="eoulu-response-load-bg" style="display:none"></div><div class="eoulu-response-load" style="display:none"><div class="eoulu-response-load-tit">'+t+'</div><div class="eoulu-response-load-message"><img width="190" height="14"><p>'+e+"</p></div></div>",$("body").append(a),l()}else $(".eoulu-response-load-tit").text(t),$(".eoulu-response-load-message p").text(e)},l=function(){$(".eoulu-response-load-bg").css({width:"100%",height:"100%","z-index":"99998",position:"fixed",filter:"Alpha(opacity=60)","background-color":"rgba(10%,20%,30%,0.6)",top:"0",left:"0",opacity:"0.6"}),$(".eoulu-response-load").css({position:"fixed",width:"355px",height:"190px","z-index":"99999","background-color":"rgba(255,255,255,0.95)","border-radius":"10px","font-family":"microsoft yahei"}),alertResponse(".eoulu-response-load",250,355),$(".eoulu-response-load-tit").css({height:"30px","line-height":"30px","font-size":"16px",color:"#fff",padding:"2px 15px","background-color":"#707070","border-top-left-radius":"10px","border-top-right-radius":"10px"}),$(".eoulu-response-load-message img").attr("src","./image/response-loading.gif"),$(".eoulu-response-load-message img").css({margin:"30px auto"}),$(".eoulu-response-load-message").css({margin:"5px auto",width:"350px",height:"165px","font-size":"16px","text-align":"center"}),$(".eoulu-response-load-message p").css({height:"30px","line-height":"30px",width:"350px","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden","text-align":"center"})},e=function(t){0!=$(".eoulu-response-load").length&&$(".eoulu-response-load-message p").text(t)},a=function(t,e){0!=$(".eoulu-response-load").length&&($(".eoulu-response-load-message p").text(t),e?alertGroupDelayClose(".eoulu-response-load-bg",".eoulu-response-load",e):alertGroupDelayClose(".eoulu-response-load-bg",".eoulu-response-load",200))}}();var addSubmitObj=new Object;addSubmitObj.Type=null,addSubmitObj.Department=null,addSubmitObj.Name=null,addSubmitObj.TotalAmount=null,addSubmitObj.DetailJson=null,addSubmitObj.TravelJson=null;var updateSubmitObj=new Object;updateSubmitObj.Type=null,updateSubmitObj.ID=null,updateSubmitObj.Department=null,updateSubmitObj.Name=null,updateSubmitObj.Pass=null,updateSubmitObj.TotalAmount=null,updateSubmitObj.DetailJson=null,updateSubmitObj.TravelJson=null;var reimburseState=new Object;reimburseState.allUploadObj={a:{uploadFileNo:0,uploadFileList:{}},b:{uploadFileNo:0,uploadFileList:{}},c:{uploadFileNo:0,uploadFileList:{}},HasSummitYM:null,StaffName:null,ID:null},reimburseState.remindDeleteloading=!1,reimburseState.detailObject={DeleteFile:"",ElectronicInvoice:"",TravelPaper:"",Others:"",DeleteFileNoSubmit:""},reimburseState.hasSearch=!1,reimburseState.Application={ID:null,State:"",Name:"",FilingDate:"",Reason:""},reimburseState.exportAll=!1,reimburseState.detailModalUpdate=!1;var reimburse_daysReg=/^((([1-9][0-9]*)+(\.[0,5]{1})?)|0\.5)$/,reimburseCategory=["飞机票","高铁/动车票","出租车票","住宿费","汽油费","停车费","快递费","其他","请餐费","招待费","礼品费"],reimburseCategoryAddStr='<tr><td class="detail_td_Amount"></td><td class="detail_td_MainContent"></td><td class="detail_td_CustomerName"></td><td class="detail_td_City"><input type="text" class="detail_td_City_1">&nbsp--&nbsp;<input type="text" class="detail_td_City_2"></td><td class="detail_td_Time"><input type="date" class="detail_td_Time_1">&nbsp--&nbsp;<input type="date" class="detail_td_Time_2"></td><td class="detail_td_Operation"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td></tr>',reimburseCategoryStr="";reimburseCategory.map(function(t,e,a){reimburseCategoryStr+='<tr value="'+t+'"><td class="detail_td_Type">'+t+'</td><td class="detail_td_Amount"></td><td class="detail_td_MainContent"></td><td class="detail_td_CustomerName"></td><td class="detail_td_City"><input type="text" class="detail_td_City_1">&nbsp--&nbsp;<input type="text" class="detail_td_City_2"></td><td class="detail_td_Time"><input type="date" class="detail_td_Time_1">&nbsp--&nbsp;<input type="date" class="detail_td_Time_2"></td><td class="detail_td_Operation"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td></tr>'});var address_businessStr='<tr><td>出差地点</td><td class="detail_td_TravelPlace"></td><td>事由</td><td class="detail_td_MainContent"></td><td>往返时间</td><td class="detail_td_TravelTime"><input type="date" class="detail_td_TravelTime_1">&nbsp--&nbsp;<input type="date" class="detail_td_TravelTime_2"></td><td>天数&nbsp;<span class="glyphicon glyphicon-refresh refresh_days" aria-hidden="true"></span></td><td class="detail_td_Days">0</td><td><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td></tr>';function pageStyle(t,e){1==e?$("#fistPage, #upPage, #nextPage, #lastPage, #Gotojump").prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"):1==t?($("#fistPage, #upPage").prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#lastPage, #nextPage, #Gotojump").prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):t==e?($("#lastPage, #nextPage").prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#fistPage, #upPage, #Gotojump").prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):$("#lastPage, #nextPage, #fistPage, #upPage, #Gotojump").prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")}function splitFilePath(t){var i="";if(""==t||"--"==t)i="";else{var e=t.split("::"),l=(e=$.grep(e,function(t,e){return""!=t})).length-1;e.map(function(t,e,a){i+=e<l?'<span class="downFile_span" title="'+t+'">'+t+"</span><br/>":'<span class="downFile_span" title="'+t+'">'+t+"</span>"})}return i}function getPageData(i,l,n){$.ajax({type:"GET",url:"Reimburse",data:{LoadType:"data",Year:i,Month:l,CurrentPage:n},dataType:"json"}).then(function(t){var e=t.datas,a=t.pageCount;renderPageData(e,n,a),reimburseState.hasSearch=!(!i&&!l)},function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")})}function renderPageData(t,s,e){var r="";1==t.length?r+='<tr><td colspan="8">无数据......</td></tr>':1<t.length&&t.map(function(t,e,a){if(0<e){var i=parseInt(10*(s-1)+e),l="审核第"+i+"条记录<span class='glyphicon glyphicon-remove popover_close' aria-hidden='true'></span>",n="--"==t.Reason?"":t.Reason,d="<div class='container-fluid'><div class='row'><div class='form-group'><label>已发送过的未通过原因：</label><div class='well well-sm'>"+n+"</div></div></div><div class='row'><div class='form-group'><label for='exampleInputEmail1'>原因</label><input type='text' class='form-control' id='exampleInputEmail1' placeholder='填写需要发送的未通过原因'></div></div><div class='row' style='text-align:center'><div style='display: inline-block;'><input type='button' class='btn btn-success' id='ReimburseApplication_y' value='通过'><input type='button' class='btn btn-warning' id='ReimburseApplication_n' value='未通过'></div></div></div>";r+='<tr><td><input type="checkbox"></td><td class="update_td" data-iid="'+t.ID+'">'+i+'</td><td class="hastd_Department" title="'+t.Department+'">'+t.Department+'</td><td class="hastd_Name" title="'+t.Name+'">'+t.Name+'</td><td class="hastd_TotalAmount" title="'+t.TotalAmount+'">'+t.TotalAmount+'</td><td class="reimburse_detail_td" title="点此查看详情"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></td><td class="hastd_FilingDate" title="'+t.FilingDate+'">'+t.FilingDate+'</td><td class="hastd_BillScreenshot" title="'+t.BillScreenshot+'" data-ivalue="'+t.BillScreenshot+'"></td><td class="hastd_ElectronicInvoice" title="'+t.ElectronicInvoice+'" data-ivalue="'+t.ElectronicInvoice+'"></td><td class="hastd_TravelPaper" title="'+t.TravelPaper+'" data-ivalue="'+t.TravelPaper+'"></td><td class="hastd_Others" title="'+t.Others+'" data-ivalue="'+t.Others+'"></td><td class="hastd_Pass" title="'+n+'"><input type="button" value="'+t.Pass+'" data-container="body" data-toggle="popover" data-placement="left" data-content="'+d+'" title="'+l+'"></td></tr>'}}),$(".m_table table tbody").empty().append(r),$(".m_page #currentPage").text(s),$(".m_page #allPage").text(e),pageStyle(s,e),$('[data-toggle="popover"]:not([value="通过"])').popover({html:!0}),$(".m_table thead .t0>input, .m_table tbody td:nth-child(1)>input").prop("checked",reimburseState.exportAll),$('[data-toggle="popover"]:not([value="通过"])').each(function(){$(this).attr("title",$(this).parent().attr("title"))}),$('[data-toggle="popover"][value="通过"]').each(function(){$(this).attr("title","已通过")})}function getDataByGoPage(t){var e,a;reimburseState.hasSearch?(e=$(".m_button_r_in_l div.btn-group>button:nth-child(1)").attr("title"),a=$(".m_button_r_in_m div.btn-group>button:nth-child(1)").attr("title")):a=e=void 0,getPageData(e,a,t)}function calcDays(t,e){var a=0;t.each(function(){a+=Number($(this).text())}),e.text(a)}function tdContenteditable(t){t.prop("contenteditable","true")}function addupdateInitTableStr(t){$("."+t+"_NonStandard_details_table>tbody").empty().append(reimburseCategoryStr),$("."+t+"_NonStandard_details_address_table>tbody").empty().append(address_businessStr),tdContenteditable($("."+t+"_NonStandard_details_table>tbody tr").children(".detail_td_Amount, .detail_td_MainContent, .detail_td_CustomerName")),tdContenteditable($("."+t+"_NonStandard_details_address_table>tbody tr").children(".detail_td_TravelPlace, .detail_td_MainContent, .detail_td_Days"))}function checkLineAllNull(t){var e=!0;return t.children(":not(.detail_td_Type):not(.detail_td_Operation)").each(function(){if($(this).is(".detail_td_City"))return $(this).children("input").each(function(){var t=$(this).val().trim();""!=t&&"--"!=t&&(e=!1)}),!0;if($(this).is(".detail_td_Time"))return $(this).children("input").each(function(){var t=$(this).val();""!=t&&"0000-00-00"!=t&&(e=!1)}),!0;var t=$(this).text().trim();""!=t&&"--"!=t&&(e=!1)}),e}function checkLineAllNull2(t){var e=!0;return t.children("td[class^='detail_td_']").each(function(){if($(this).is(".detail_td_TravelTime"))return $(this).children("input").each(function(){var t=$(this).val();""!=t&&"0000-00-00"!=t&&(e=!1)}),!0;if($(this).is(".detail_td_Days"))return!0;var t=$(this).text().trim();""!=t&&"--"!=t&&(e=!1)}),e}function sosuoInit(){reimburseState.hasSearch=!1,$(".m_button_r_in_l div.btn-group>button:nth-child(1)").attr("title","选择年"),$(".m_button_r_in_l div.btn-group>button:nth-child(1)").text("选择年"),$(".m_button_r_in_m div.btn-group>button:nth-child(1)").attr("title","All"),$(".m_button_r_in_m div.btn-group>button:nth-child(1)").text("All")}function uploadFiles(t,e,a,i,l){var n=new FormData;n.enctype="multipart/form-data",n.append("Folder",t),$.each(e,function(t,e){n.append("file",e)}),$.ajax({type:"POST",async:!0,accept:"application/json; charset=utf-8",data:n,url:"BatchUpload",processData:!1,contentType:!1,cache:!1,dataType:"json",success:function(t){0<t.length?"上传成功"==t[0].Message?(a.find(".detail_filename_td .detail_filename").text(t[0].FileName).attr("title",t[0].FileName),a.find(".detail_filename_td").data("operatetype",i).data("attachment",t[0].FileName).data("oldattachment",l),$.Response_Load.After("上传成功",1700)):-1<t[0].Message.indexOf("失败")?$.Response_Load.After("上传失败",1700):$.Response_Load.After("文件已存在",1700):0==t.length&&$.Response_Load.After("文件读取至服务器失败！",1700)},error:function(){$.Response_Load.After("网络繁忙！上传失败！",1700)},beforeSend:function(t){$.Response_Load.Before("上传提示","正在提交...",300)},complete:function(t,e){}})}function uploadFiles2(n,t,a){var i=new FormData;i.enctype="multipart/form-data",i.append("Folder",t);var e=reimburseState.allUploadObj[n.data("iclassify")].uploadFileList;$.each(e,function(t,e){i.append("file",e)}),$.ajax({type:"POST",async:!0,accept:"application/json; charset=utf-8",data:i,url:"BatchUpload",processData:!1,contentType:!1,cache:!1,dataType:"json",xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(t){var e=t.loaded,a=t.total,i=Math.floor(1e3*e/a)/10+"%";console.log("已经上传了："+i);var l=(100*globalToPoint(i)).toFixed(0);n.find("div.add_fileList_info>div:nth-child(1)>div.progress-bar").attr("aria-valuenow",l).css("width",i).text(i)},!1),myXhr},success:function(t){if(0<t.length){var i="";for(var e in t.map(function(t,e,a){-1<t.Message.indexOf("成功")?(i+='<li class="list-group-item list-group-item-success" title="'+t.FileName+'"><span class="badge uploaded">删除</span><span class="badge">成功</span>'+t.FileName+"</li>",0):-1<t.Message.indexOf("失败")?i+='<li class="list-group-item list-group-item-danger" title="'+t.FileName+'"><span class="badge">失败</span>'+t.FileName+"</li>":i+='<li class="list-group-item list-group-item-warning" title="'+t.FileName+'"><span class="badge">已存在</span>'+t.FileName+"</li>"}),n.find("ul>li>span.noUpload:contains('删除')").parent().remove(),n.find("ul").append(i),reimburseState.allUploadObj[n.data("iclassify")].uploadFileNo=0,reimburseState.allUploadObj[n.data("iclassify")].uploadFileList)delete reimburseState.allUploadObj[n.data("iclassify")].uploadFileList[e];n.find("input[type='file']").val("")}else 0==t.length&&$.MsgBox_Unload.Alert("上传提示","文件读取至服务器失败！")},error:function(){n.find("div.add_fileList_info>div:nth-child(1)>div.progress-bar").attr("aria-valuenow","0").css("width","0%").text("0%"),$.MsgBox_Unload.Alert("上传提示","网络繁忙！上传失败！")},beforeSend:function(t){a.css("cursor","not-allowed").prop("disabled","disabled")},complete:function(t,e){a.css("cursor","pointer").prop("disabled",!1)}})}function modalCloseInit(){for(var t in $(".bg_cover").slideUp(250),$("div.add_fileList_info").each(function(){$(this).is(":visible")&&$(this).slideUp(150,function(){$(this).children("div").children("div.progress-bar").attr("aria-valuenow","0").css("width","0%").text("0%")})}),$(".iParent ul").empty(),reimburseState.allUploadObj.a.uploadFileNo=0,reimburseState.allUploadObj.b.uploadFileNo=0,reimburseState.allUploadObj.c.uploadFileNo=0,reimburseState.allUploadObj.a.uploadFileList)delete reimburseState.allUploadObj.a.uploadFileList[t];for(var e in reimburseState.allUploadObj.b.uploadFileList)delete reimburseState.allUploadObj.b.uploadFileList[e];for(var a in reimburseState.allUploadObj.c.uploadFileList)delete reimburseState.allUploadObj.c.uploadFileList[a];$(".iParent input[type='file']").val(""),reimburseState.remindDeleteloading=!0,reimburseState.detailObject.DeleteFile="",reimburseState.detailModalUpdate=!1}$(function(){addupdateInitTableStr("add"),getPageData(void 0,void 0,1);var t=(new Date).getFullYear(),e=2018;do{var a='<li title="'+e+'">'+e+"年</li>";$(".m_button_r_in_l ul").append(a),e++}while(e<t+1);var i=1;do{i<10&&(i="0"+i);var l='<li title="'+i+'">'+i+"月</li>";$(".m_button_r_in_m ul").append(l),i=Number(i),i++}while(i<13);$("#reimburseModal").modal({keyboard:!0,show:!1});var n='<option value="" disabled="disabled">请选择</option>';globalEouluAllDepart.map(function(t,e,a){n+='<option value="'+t+'">'+t+"</option>"}),$("select.info_Department").empty().append(n)}),$(document).on("click",".add_NonStandard_details_table span.glyphicon-plus, .update_NonStandard_details_table span.glyphicon-plus",function(t){t.stopPropagation();var e=$(this).parent().parent();if(e.attr("value")){var a;e.after(reimburseCategoryAddStr);var i=e.attr("value");if(e.next().attr("value",i),$(this).parents(".add_NonStandard_details_table").length){var l=$(".add_NonStandard_details_table tbody tr[value='"+i+"']"),n=l.length;l.eq(0).children("td:nth-child(1)").attr("rowspan",n),a=$(".add_NonStandard_details_table>tbody tr").children(".detail_td_Amount, .detail_td_MainContent, .detail_td_CustomerName")}else if($(this).parents(".update_NonStandard_details_table").length){var d=$(".update_NonStandard_details_table tbody tr[value='"+i+"']"),s=d.length;d.eq(0).children("td:nth-child(1)").attr("rowspan",s),a=$(".update_NonStandard_details_table>tbody tr").children(".detail_td_Amount, .detail_td_MainContent, .detail_td_CustomerName")}tdContenteditable(a)}}),$(document).on("click",".add_NonStandard_details_address_table span.glyphicon-plus, .update_NonStandard_details_address_table span.glyphicon-plus",function(t){var e;t.stopPropagation(),$(this).parent().parent().after(address_businessStr),$(this).parents(".add_NonStandard").length?e="add":$(this).parents(".update_NonStandard").length&&(e="update"),tdContenteditable($("."+e+"_NonStandard_details_address_table>tbody tr").children(".detail_td_TravelPlace, .detail_td_MainContent, .detail_td_Days"))}),$(".m_button_l input[value='添加']").click(function(){$(".bg_cover, .add_NonStandard").slideDown(300),$(".add_NonStandard_body [class^='info_']").each(function(){if($(this).is(".info_Name"))return $(this).empty(),!0;($(this).is(".info_BillScreenshot")||$(this).is(".info_ElectronicInvoice")||$(this).is(".info_TravelPaper")||$(this).is(".info_Others"))&&$(this).attr("title",""),$(this).val("")}),addupdateInitTableStr("add"),calcDays($(".add_NonStandard_details_address_table>tbody .detail_td_Days"),$(".add_NonStandard_details_address_table>tfoot .insert_detail_td_calc_days"))}),$(".add_NonStandard_tit_r, #NonStandard_addclose").click(function(){for(var t in $(".bg_cover, .add_NonStandard").slideUp(300),addSubmitObj)addSubmitObj[t]=null}),$(document).on("click",".update_td",function(){if($("span#reimburse_name").text()!=$(this).siblings(".hastd_Name").text())return!1;var l=$(this).siblings(".hastd_Department").text(),r=$(this);updateSubmitObj.ID=Number($(this).data("iid")).toString(),updateSubmitObj.Pass=$(this).siblings(".hastd_Pass").children("input[type='button']").val();var t=$(this).data("iid").toString();$.ajax({type:"GET",url:"ReimburseApplication",data:{RequestID:t},dataType:"json"}).then(function(t){var e=t.detail,a=t.travel,n="",d=_.cloneDeep(reimburseCategory),s=[];e.map(function(t,e,a){if(0<e){var i=$.inArray(t.Type,d),l=$.inArray(t.Type,s);-1<i&&d.splice(i,1),n+='<tr data-iid="'+t.ID+'" value="'+t.Type+'">',-1==l&&(n+='<td title="'+t.Type+'" class="detail_td_Type">'+t.Type+"</td>",s.push(t.Type)),n+='<td title="'+t.Amount+'" class="detail_td_Amount">'+t.Amount+'</td><td title="'+t.MainContent+'" class="detail_td_MainContent">'+t.MainContent+'</td><td title="'+t.CustomerName+'" class="detail_td_CustomerName">'+t.CustomerName+'</td><td title="'+t.City.replace(";;"," -- ")+'" class="detail_td_City"><input type="text" class="detail_td_City_1" value="'+t.City.split(";;")[0]+'">&nbsp--&nbsp;<input type="text" class="detail_td_City_2" value="'+t.City.split(";;")[1]+'"></td><td title="'+t.Time.replace(";;"," -- ")+'" class="detail_td_Time"><input type="date" class="detail_td_Time_1" value="'+t.Time.split(";;")[0]+'">&nbsp--&nbsp;<input type="date" class="detail_td_Time_2" value="'+t.Time.split(";;")[1]+'"></td><td class="detail_td_Operation"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td><td class="detail_td_Attachment">'+t.Attachment+"</td></tr>"}}),d.map(function(t,e,a){n+='<tr value="'+t+'"><td class="detail_td_Type">'+t+'</td><td class="detail_td_Amount"></td><td class="detail_td_MainContent"></td><td class="detail_td_CustomerName"></td><td class="detail_td_City"><input type="text" class="detail_td_City_1">&nbsp--&nbsp;<input type="text" class="detail_td_City_2"></td><td class="detail_td_Time"><input type="date" class="detail_td_Time_1">&nbsp--&nbsp;<input type="date" class="detail_td_Time_2"></td><td class="detail_td_Operation"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td></tr>'});var i="";a.map(function(t,e,a){0<e&&(i+='<tr data-iid="'+t.ID+'"><td>出差地点</td><td title="'+t.TravelPlace+'" class="detail_td_TravelPlace">'+t.TravelPlace+'</td><td>事由</td><td title="'+t.MainContent+'" class="detail_td_MainContent">'+t.MainContent+'</td><td>往返时间</td><td title="'+t.TravelTime.replace(";;"," -- ")+'" class="detail_td_TravelTime"><input type="date" class="detail_td_TravelTime_1" value="'+t.TravelTime.split(";;")[0]+'">&nbsp--&nbsp;<input type="date" class="detail_td_TravelTime_2" value="'+t.TravelTime.split(";;")[1]+'"></td><td>天数&nbsp;<span class="glyphicon glyphicon-refresh refresh_days" aria-hidden="true"></span></td><td title="'+t.Days+'" class="detail_td_Days">'+t.Days+'</td><td><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></td></tr>')}),1==e.length&&1==a.length?addupdateInitTableStr("update"):1<e.length&&1==a.length?($(".update_NonStandard_details_table>tbody").empty().append(n),$(".update_NonStandard_details_address_table>tbody").empty().append(address_businessStr)):(1==e.length&&1<a.length?$(".update_NonStandard_details_table>tbody").empty().append(reimburseCategoryStr):$(".update_NonStandard_details_table>tbody").empty().append(n),$(".update_NonStandard_details_address_table>tbody").empty().append(i)),calcDays($(".update_NonStandard_details_address_table>tbody .detail_td_Days"),$(".update_NonStandard_details_address_table>tfoot .insert_detail_td_calc_days")),s.map(function(t,e,a){var i=$(".update_NonStandard_details_table tbody tr[value='"+t+"']"),l=i.length;i.eq(0).children("td:nth-child(1)").attr("rowspan",l)}),tdContenteditable($(".update_NonStandard_details_table>tbody tr").children(".detail_td_Amount, .detail_td_MainContent, .detail_td_CustomerName")),tdContenteditable($(".update_NonStandard_details_address_table>tbody tr").children(".detail_td_TravelPlace, .detail_td_MainContent, .detail_td_Days")),$(".bg_cover, .update_NonStandard").slideDown(300),globalGetStaffAllInfoByDepart(l,function(t){var i="";t.map(function(t,e,a){0<e&&(i+='<option value="'+t.StaffName+'" text="'+t.ID+'">'+t.StaffName+"</option>")}),$(".update_NonStandard .info_Name").empty().append(i),$(".update_NonStandard_body [class^='info_']").each(function(){var t=$(this).attr("class").split(" ")[0].replace("info_","hastd_"),e=r.siblings("."+t).attr("title"),a=globalDataHandle(e,"");$(this).val(a),($(this).is(".info_BillScreenshot")||$(this).is(".info_ElectronicInvoice")||$(this).is(".info_TravelPaper")||$(this).is(".info_Others"))&&$(this).attr("title",a)})})},function(){$.MsgBox_Unload.Alert("查看详情提示","网络繁忙！")})}),$(".update_NonStandard_tit_r, #NonStandard_updateclose").click(function(){for(var t in $(".bg_cover, .update_NonStandard").slideUp(300),updateSubmitObj)updateSubmitObj[t]=null}),$(document).on("change",".info_Department",function(){var e=$(this),t=$(this).val();if(""==t||"请选择"==t)return!1;globalGetStaffAllInfoByDepart(t,function(t){var i="";t.map(function(t,e,a){0<e&&(i+='<option value="'+t.StaffName+'" text="'+t.ID+'">'+t.StaffName+"</option>")}),e.parents(".add_NonStandard").length?$(".add_NonStandard .info_Name").empty().append(i):e.parents(".update_NonStandard").length&&$(".update_NonStandard .info_Name").empty().append(i)})}),$("#NonStandard_addsubmit").click(function(){for(var t in addSubmitObj)"Type"!=t?"TotalAmount"!=t&&"DetailJson"!=t&&"TravelJson"!=t&&(addSubmitObj[t]=$(".add_NonStandard").find(".info_"+t).val()):addSubmitObj[t]="add";for(var e in addSubmitObj){if(addSubmitObj[e]=globalDataHandle(addSubmitObj[e],"").trim(),"Department"==e&&""==addSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择部门！"),!1;if("Name"==e&&""==addSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择姓名！"),!1}var a=0;$(".add_NonStandard .detail_td_Amount").each(function(){""!=$(this).text()&&(a+=Number($(this).text()))}),addSubmitObj.TotalAmount=a.toFixed(2);var i=[];$(".add_NonStandard_details_div tbody tr").each(function(){var t=$(this);if(!checkLineAllNull(t)){var e={};e.Type=t.attr("value"),e.Amount=Number(t.children(".detail_td_Amount").text()).toFixed(2),e.MainContent=t.children(".detail_td_MainContent").text().trim(),e.CustomerName=t.children(".detail_td_CustomerName").text().trim(),e.City=t.find(".detail_td_City_1").val().trim()+";;"+t.find(".detail_td_City_2").val().trim(),e.Time=t.find(".detail_td_Time_1").val()+";;"+t.find(".detail_td_Time_2").val(),i.push(e)}}),addSubmitObj.DetailJson=JSON.stringify(i);var l=[];$(".add_NonStandard_details_address tbody tr").each(function(){var t=$(this);if(!checkLineAllNull2(t)){var e={};e.TravelPlace=t.children(".detail_td_TravelPlace").text().trim(),e.MainContent=t.children(".detail_td_MainContent").text().trim(),e.TravelTime=t.find(".detail_td_TravelTime_1").val()+";;"+t.find(".detail_td_TravelTime_2").val(),e.Days=Number(t.children(".detail_td_Days").text()),l.push(e)}}),addSubmitObj.TravelJson=JSON.stringify(l),console.log("add我执行了吗"),console.log(addSubmitObj);var n=$(this);$.ajax({type:"POST",url:"Reimburse",dataType:"text",data:addSubmitObj,success:function(t){"0"!==t?($.MsgBox_Unload.Alert("提示","添加成功！"),$("#NonStandard_addclose").trigger("click"),sosuoInit(),getPageData(void 0,void 0,1)):"0"===t&&$.MsgBox_Unload.Alert("提示","添加失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},beforeSend:function(t){eouluGlobal.C_btnDisabled(n,!0,"正在提交...")},complete:function(t,e){eouluGlobal.C_btnAbled(n,!0,"提交")}})}),$("#NonStandard_updatesubmit").click(function(){for(var t in updateSubmitObj)"Type"!=t?"ID"!=t&&"Pass"!=t&&"TotalAmount"!=t&&"DetailJson"!=t&&"TravelJson"!=t&&(updateSubmitObj[t]=$(".update_NonStandard").find(".info_"+t).val()):updateSubmitObj[t]="update";for(var e in updateSubmitObj){if(updateSubmitObj[e]=globalDataHandle(updateSubmitObj[e],"").trim(),"Department"==e&&""==updateSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择部门！"),!1;if("Name"==e&&""==updateSubmitObj[e])return $.MsgBox_Unload.Alert("提示","未选择姓名！"),!1}var a=0;$(".update_NonStandard .detail_td_Amount").each(function(){""!=$(this).text()&&(a+=Number($(this).text()))}),updateSubmitObj.TotalAmount=a.toFixed(2);var i=[];$(".update_NonStandard_details_div tbody tr").each(function(){var t=$(this);if(!checkLineAllNull(t)){var e={};e.Type=t.attr("value"),e.Amount=Number(t.children(".detail_td_Amount").text()).toFixed(2),e.MainContent=t.children(".detail_td_MainContent").text().trim(),e.CustomerName=t.children(".detail_td_CustomerName").text().trim(),e.City=t.find(".detail_td_City_1").val().trim()+";;"+t.find(".detail_td_City_2").val().trim(),e.Time=t.find(".detail_td_Time_1").val()+";;"+t.find(".detail_td_Time_2").val();var a=t.find(".detail_td_Attachment").text();null!=a&&"--"!=a||(a=""),e.Attachment=a,i.push(e)}}),updateSubmitObj.DetailJson=JSON.stringify(i);var l=[];$(".update_NonStandard_details_address tbody tr").each(function(){var t=$(this);if(!checkLineAllNull2(t)){var e={};e.TravelPlace=t.children(".detail_td_TravelPlace").text().trim(),e.MainContent=t.children(".detail_td_MainContent").text().trim(),e.TravelTime=t.find(".detail_td_TravelTime_1").val()+";;"+t.find(".detail_td_TravelTime_2").val(),e.Days=Number(t.children(".detail_td_Days").text()),l.push(e)}}),updateSubmitObj.TravelJson=JSON.stringify(l),console.log("update我执行了吗"),console.log(updateSubmitObj);var n=$(this);$.ajax({type:"POST",url:"Reimburse",dataType:"text",data:updateSubmitObj,success:function(t){"true"==t?($("#NonStandard_updateclose").trigger("click"),getDataByGoPage(Number($("span#currentPage").text())),$.MsgBox_Unload.Alert("提示","信息修改成功！")):"false"==t&&$.MsgBox_Unload.Alert("提示","信息修改失败！")},error:function(){$.MsgBox_Unload.Alert("提示","网络繁忙，刷新页面试下！")},beforeSend:function(t){eouluGlobal.C_btnDisabled(n,!0,"正在提交...")},complete:function(t,e){eouluGlobal.C_btnAbled(n,!0,"提交")}})}),$(document).on("click",".m_button_r_in .dropdown-menu>li",function(){var t=$(this).text(),e=$(this).attr("title");$(this).parent().prev().prev().text(t),$(this).parent().prev().prev().attr("title",e)}),$(".m_button_r_in_r input[value='搜索']").click(function(){var t=$(".m_button_r_in_l div.btn-group>button:nth-child(1)").attr("title"),e=$(".m_button_r_in_m div.btn-group>button:nth-child(1)").attr("title");"选择年"==t&&(t=(new Date).getFullYear(),$(".m_button_r_in_l div.btn-group>button:nth-child(1)").attr("title",t),$(".m_button_r_in_l div.btn-group>button:nth-child(1)").text(t+"年")),getPageData(t,e,1)}),$(".m_button_r_in_r input[value='取消']").click(function(){sosuoInit(),getPageData(void 0,void 0,1),$("#jumpNumber").val(""),reimburseState.exportAll=!1,$(".m_button_l>input:nth-child(2)").val("全选").removeClass("btn-warning").addClass("btn-info")}),$("#jumpNumber").on("input propertychange",function(){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}),$("#fistPage").click(function(){getDataByGoPage(1)}),$("#lastPage").click(function(){getDataByGoPage(Number($("#allPage").text()))}),$("#upPage").click(function(){var t=Number($("#currentPage").text());1!=t&&getDataByGoPage(--t)}),$("#nextPage").click(function(){var t=Number($("#currentPage").text());t!=Number($("#allPage").text())&&getDataByGoPage(++t)}),$("#Gotojump").click(function(){var t=$("#jumpNumber").val().trim(),e=Number($("#allPage").text());t==Number($("#currentPage").text())||t<=0||e<t?$("#jumpNumber").val(""):getDataByGoPage(t)}),$(".trigger_click").click(function(t){t.preventDefault(),$(this).next().trigger("click")}),$(".modal-body .row fieldset input[type='file']").on("change",function(){var t=$(this).parents(".iParent");t.find(".add_fileList_info").is(":visible")||t.find(".add_fileList_info").slideDown(150);var e=$(this)[0].files,a="",i=reimburseState.allUploadObj[$(this).parents(".iParent").data("iclassify")].uploadFileNo,l=reimburseState.allUploadObj[$(this).parents(".iParent").data("iclassify")].uploadFileList;$.each(e,function(t,e){i++,a+='<li class="list-group-item" title="'+e.name+'" value="'+i+'"><span class="badge noUpload">删除</span><span class="badge">待上传</span>'+e.name+"</li>",l[i]=e}),t.find("ul").append(a),t.find(".add_fileList_info>div>div.progress-bar").prop("aria-valuenow","0").css("width","0%").text("0%")}),$(document).on("click",".iParent ul>li>span.noUpload:contains('删除')",function(){var t=$(this).parent().attr("value");delete reimburseState.allUploadObj[$(this).parents(".iParent").data("iclassify")].uploadFileList[t],$(this).parents(".iParent").find("input[type='file']").val(""),$(this).parent().remove()}),$(".iParent label[class^='add_info_upload']>button").click(function(){if(0==Object.keys(reimburseState.allUploadObj[$(this).parents(".iParent").data("iclassify")].uploadFileList).length)return $.MsgBox_Unload.Alert("上传提示","请选择文件！"),!1;uploadFiles2($(this).parents(".iParent"),"报销申请"+reimburseState.allUploadObj.HasSummitYM+"-"+reimburseState.allUploadObj.StaffName+"-"+reimburseState.allUploadObj.ID,$(this))}),$(document).on("click",".reimburse_detail_td span",function(){var m=$(this).parent(),b=m.siblings(".update_td").data("iid").toString(),h=m.siblings(".hastd_Name").text();$.ajax({type:"GET",url:"ReimburseApplication",data:{RequestID:b},dataType:"json"}).then(function(t){var e=t.detail,a=t.travel;if(1==e.length&&1==a.length)$.MsgBox_Unload.Alert("查看详情提示","无报销详情记录");else{reimburseState.allUploadObj.HasSummitYM=m.siblings(".hastd_FilingDate").text().trim().split("-")[0]+m.siblings(".hastd_FilingDate").text().trim().split("-")[1],reimburseState.allUploadObj.StaffName=h,reimburseState.allUploadObj.ID=b;var l="";e.map(function(t,e,a){if(0<e){var i="--"==t.Attachment?"":t.Attachment;i=""==i?"未上传":i,l+='<tr data-iid="'+t.ID+'"><td title="'+t.Type+'">'+t.Type+'</td><td title="'+t.Amount+'">'+t.Amount+'</td><td title="'+t.MainContent+'">'+t.MainContent+'</td><td title="'+t.CustomerName+'">'+t.CustomerName+'</td><td title="'+t.City.replace(";;"," -- ")+'">'+t.City.replace(";;"," -- ")+'</td><td title="'+t.Time.replace(";;"," -- ")+'">'+t.Time.replace(";;"," -- ")+'</td><td class="detail_filename_td" data-operatetype="no" data-attachment="" data-oldattachment=""><input type="file"><span class="detail_filename" title="'+i+'" data-originfile="'+i+'">'+i+'</span><span class="glyphicon glyphicon-open" aria-hidden="true"></span><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></td></tr>'}}),$(".modal-body_detail tbody").empty().append(l);var i="";1==a.length?i+="<tr><td>出差地点</td><td></td><td>事由</td><td></td><td>往返时间</td><td></td><td>天数</td><td></td></tr>":a.map(function(t,e,a){0<e&&(i+='<tr data-iid="'+t.ID+'"><td>出差地点</td><td title="'+t.TravelPlace+'">'+t.TravelPlace+'</td><td>事由</td><td title="'+t.MainContent+'">'+t.MainContent+'</td><td>往返时间</td><td title="'+t.TravelTime.replace(";;"," -- ")+'">'+t.TravelTime.replace(";;"," -- ")+'</td><td>天数</td><td title="'+t.Days+'" class="details_calc_days">'+t.Days+"</td></tr>")}),$(".modal-body_travel tbody").empty().append(i),calcDays($(".modal-body_travel tbody .details_calc_days"),$(".modal-body_travel .insert_detail_calc_days")),$(".modal-header .modal-title").text(h+"的报销详情"),$(".bg_cover").slideDown(250),$("#reimburseModal").modal("show");var n=m.siblings(".hastd_ElectronicInvoice").data("ivalue");if(null!=n){var d=$.grep(String(n).split("::"),function(t,e){return""!=t}),s="";d.map(function(t,e,a){s+='<li class="list-group-item list-group-item-info" title="'+t+'"><span class="badge uploaded">删除</span><span class="badge">已上传</span>'+t+"</li>"}),$("#add_fileList_ul").empty().append(s)}var r=m.siblings(".hastd_TravelPaper").data("ivalue");if(null!=r){var o=$.grep(String(r).split("::"),function(t,e){return""!=t}),u="";o.map(function(t,e,a){u+='<li class="list-group-item list-group-item-info" title="'+t+'"><span class="badge uploaded">删除</span><span class="badge">已上传</span>'+t+"</li>"}),$("#add_fileList_ul2").empty().append(u)}var p=m.siblings(".hastd_Others").data("ivalue");if(null!=p){var c=$.grep(String(p).split("::"),function(t,e){return""!=t}),_="";c.map(function(t,e,a){_+='<li class="list-group-item list-group-item-info" title="'+t+'"><span class="badge uploaded">删除</span><span class="badge">已上传</span>'+t+"</li>"}),$("#add_fileList_ul3").empty().append(_)}}},function(){$.MsgBox_Unload.Alert("查看详情提示","网络繁忙！")})}),$("#reimburseModal").on("hide.bs.modal",function(t){if(reimburseState.detailModalUpdate)modalCloseInit();else{var e=!1;if($("div.modal-body_detail tbody>tr").each(function(){var t=$(this).children(".detail_filename_td").data("operatetype");if("add"==t||"update"==t||"delete"==t)return!(e=!0)}),e||$(".iParent ul>li.list-group-item-success").length||""!=reimburseState.detailObject.DeleteFileNoSubmit){$.Response_Load.Before("直接关闭提示","正在撤销操作...",500);reimburseState.detailObject.ElectronicInvoice,reimburseState.detailObject.TravelPaper,reimburseState.detailObject.Others;var a=[];$(".iParent ul>li.list-group-item-success").each(function(){a.push($(this).attr("title"))});var i=globalArrStrUnique(a),d=0==i.length?"":i.join("::")+"::";$("div.modal-body_detail tbody>tr").each(function(){var t=$(this).children(".detail_filename_td").data("operatetype");if(null==t||"no"==t)return!0;var e=$(this).children(".detail_filename_td").data("oldattachment");null==e&&(e="");var a,i=$(this).children(".detail_filename_td").data("attachment");if(null==i&&(i=""),""==e)a="";else{var l=$(this).find("span.detail_filename").data("originfile");"未上传"==l&&(l="");var n=_.pull(e.toString().split("::"),l);a=0==n.length?"":n.join("::")+"::"}d+=a,d+=""==i?"":i+"::"}),d+=reimburseState.detailObject.DeleteFileNoSubmit,console.log(d),$.Response_Load.Loading("正在撤销操作..."),$.ajax({type:"POST",url:"ReimburseAttachment",data:{ID:void 0,ElectronicInvoice:void 0,TravelPaper:void 0,Others:void 0,AttachmentJson:void 0,Folder:"报销申请"+reimburseState.allUploadObj.HasSummitYM+"-"+reimburseState.allUploadObj.StaffName+"-"+reimburseState.allUploadObj.ID,DeleteFile:d,IsRevoke:"YES"}}).then(function(t){console.log(typeof t),"true"==t?($.Response_Load.After("撤销成功！",1e3),getDataByGoPage(Number($("span#currentPage").text())),reimburseState.detailObject.DeleteFile="",reimburseState.detailObject.DeleteFileNoSubmit=""):"false"==t?$.Response_Load.After("撤销失败！",1e3):$.Response_Load.After(t,1e3)},function(){$.Response_Load.After("网络繁忙！撤销失败",1e3)}).always(function(){modalCloseInit()})}else modalCloseInit()}}),$(document).on("click",".detail_filename+span",function(){$(this).prev().prev().val("").trigger("click")}),$(document).on("change",".detail_filename_td>input[type='file']",function(){var t,e,a=$(this).parent().parent(),i=$(this).next().attr("title");t="未上传"==i&&"no"==$(this).parent().data("operatetype")?"add":"update";var l=$(this).parent().data("oldattachment");null==l||""==l?e="未上传"==i?"":i:(e=String(l),e+="未上传"==i?"":"::"+i),uploadFiles("报销申请"+reimburseState.allUploadObj.HasSummitYM+"-"+reimburseState.allUploadObj.StaffName+"-"+reimburseState.allUploadObj.ID,$(this)[0].files,a,t,e)}),$(".modal-footer>.btn-success").click(function(){var t=[];$("#add_fileList_ul>li.list-group-item-success, #add_fileList_ul>li.list-group-item-info").each(function(){t.push($(this).attr("title"))});var e=globalArrStrUnique(t),a=0==e.length?"":e.join("::")+"::",i=[];$("#add_fileList_ul2>li.list-group-item-success, #add_fileList_ul2>li.list-group-item-info").each(function(){i.push($(this).attr("title"))});var l=globalArrStrUnique(i),n=0==l.length?"":l.join("::")+"::",d=[];$("#add_fileList_ul3>li.list-group-item-success, #add_fileList_ul3>li.list-group-item-info").each(function(){d.push($(this).attr("title"))});var s=globalArrStrUnique(d),r=0==s.length?"":s.join("::")+"::",o=[];$("div.modal-body_detail tbody>tr").each(function(){var t=$(this).children(".detail_filename_td").data("operatetype");if(null==t||"no"==t)return!0;var e={};e.ID=String($(this).data("iid")),e.OperateType=t;var a=$(this).children(".detail_filename_td").data("attachment");null==a&&(a="");var i=$(this).children(".detail_filename_td").data("oldattachment");null==i&&(i=""),"add"==t?(e.Attachment=a,e.iclassify="R3"):"update"==t?(e.OldAttachment=i,e.Attachment=a,e.iclassify="R2"):"delete"==t&&(e.OldAttachment=i,e.iclassify="R1"),o.push(e)}),console.log(_.sortBy(o,function(t){return t.iclassify}));var u=JSON.stringify(_.sortBy(o,function(t){return t.iclassify}));$.ajax({type:"POST",url:"ReimburseAttachment",data:{ID:reimburseState.allUploadObj.ID,ElectronicInvoice:a,TravelPaper:n,Others:r,AttachmentJson:u,Folder:"报销申请"+reimburseState.allUploadObj.HasSummitYM+"-"+reimburseState.allUploadObj.StaffName+"-"+reimburseState.allUploadObj.ID,DeleteFile:reimburseState.detailObject.DeleteFile}}).then(function(t){"true"==t?($.MsgBox_Unload.Alert("更新提示","更新成功！"),reimburseState.detailModalUpdate=!0,reimburseState.detailObject.DeleteFile="",reimburseState.detailObject.DeleteFileNoSubmit="",$("#reimburseModal").modal("hide"),getDataByGoPage(Number($("span#currentPage").text()))):"false"==t?$.MsgBox_Unload.Alert("更新提示","更新失败！"):$.MsgBox_Unload.Alert("更新提示",t)},function(){$.MsgBox_Unload.Alert("查看详情提示","网络繁忙！")}).always(function(){})}),$(document).on("click","li.list-group-item-success, li.list-group-item-info, span.detail_filename",function(t){t.stopPropagation();var e=$(this).attr("title");if(!e||"未上传"==e)return $.MsgBox_Unload.Alert("下载提示","无数据或文件已被删除！"),!1;$.ajax({type:"GET",url:"ReimburseAttachment",data:{Type:"download",ID:reimburseState.allUploadObj.ID,StaffName:reimburseState.allUploadObj.StaffName,FileName:e,FolderMonth:reimburseState.allUploadObj.HasSummitYM}}).then(function(t){window.open(t)},function(){$.MsgBox_Unload.Alert("下载提示","网络繁忙或文件已被删除！")})}),$(document).on("click","span.badge.uploaded",function(t){t.stopPropagation(),reimburseState.remindDeleteloading||($.Response_Load.Before("删除提示","已删除，请记得提交保存",300),$.Response_Load.After("已删除，请记得提交保存",800),reimburseState.remindDeleteloading=!0),reimburseState.detailObject.DeleteFile+=$(this).parent().attr("title"),reimburseState.detailObject.DeleteFile+="::",$(this).parent().is(".list-group-item-success")&&(reimburseState.detailObject.DeleteFileNoSubmit+=$(this).parent().attr("title"),reimburseState.detailObject.DeleteFileNoSubmit+="::"),$(this).parent().remove()}),$(document).on("click","td.detail_filename_td>.glyphicon-trash",function(t){if(t.stopPropagation(),"未上传"==$(this).prev().prev().attr("title"))return!1;reimburseState.remindDeleteloading||($.Response_Load.Before("删除提示","已删除，请记得提交保存",300),$.Response_Load.After("已删除，请记得提交保存",800),reimburseState.remindDeleteloading=!0);var e,a=$(this).siblings(".detail_filename").attr("title"),i=$(this).parent().data("oldattachment");e=null==i||""==i?a:i+"::"+a,$(this).parent().data("operatetype","delete").data("oldattachment",e).data("attachment","").children(".detail_filename").attr("title","未上传").text("未上传")});var curThIndex=-1;$(document).on("click",".hastd_Pass>input",function(t){if(t.stopPropagation(),"通过"==$(this).val())return reimburseState.Application.State="",!1;reimburseState.Application.ID=$(this).parent().siblings(".update_td").data("iid").toString(),reimburseState.Application.Name=$(this).parent().siblings(".hastd_Name").text(),reimburseState.Application.FilingDate=$(this).parent().siblings(".hastd_FilingDate").text(),curThIndex=$(this).parent().parent().index(),$(".m_table tbody>tr:not(:eq("+curThIndex+')) [data-toggle="popover"]').popover("hide")}),$(document).on("click","div.popover",function(t){t.stopPropagation()}),$(document).on("click",function(){$('[data-toggle="popover"]:not([value="通过"])').popover("hide")}),$(document).on("click","span.popover_close",function(t){t.stopPropagation(),$('[data-toggle="popover"]:not([value="通过"])').popover("hide")}),$(document).on("hidden.bs.popover",'[data-toggle="popover"]:not([value="通过"])',function(){0===$("div.popover").length&&(reimburseState.Application={ID:null,State:"",Name:"",FilingDate:"",Reason:""})}),$(document).on("click","#ReimburseApplication_y",function(){var t=$(this);eouluGlobal.C_btnDisabled(t,!0,"正在发送..."),reimburseState.Application.State="通过",$.ajax({type:"POST",url:"ReimburseApplication",data:{ID:reimburseState.Application.ID,State:reimburseState.Application.State,Name:reimburseState.Application.Name,FilingDate:reimburseState.Application.FilingDate},dataType:"text"}).then(function(t){-1<t.indexOf("操作成功")&&($("div.popover").remove(),getDataByGoPage(Number($("span#currentPage").text())),reimburseState.Application={ID:null,State:"",Name:"",FilingDate:"",Reason:""});$.MsgBox_Unload.Alert("审批提示",t)},function(){$.MsgBox_Unload.Alert("审批提示","网络繁忙！")}).always(function(){eouluGlobal.C_btnAbled(t,!0,"通过")})}),$(document).on("click","#ReimburseApplication_n",function(){reimburseState.Application.State="未通过";var t=$("#exampleInputEmail1").val().trim();$("#ReimburseApplication_n").css("cursor","not-allowed").prop("disabled","disabled"),$.ajax({type:"POST",url:"ReimburseApplication",data:{ID:reimburseState.Application.ID,State:reimburseState.Application.State,Name:reimburseState.Application.Name,FilingDate:reimburseState.Application.FilingDate,Reason:t},dataType:"text"}).then(function(t){-1<t.indexOf("操作成功")&&($("div.popover").remove(),getDataByGoPage(Number($("span#currentPage").text())),reimburseState.Application={ID:null,State:"",Name:"",FilingDate:"",Reason:""});$.MsgBox_Unload.Alert("审批提示",t)},function(){$.MsgBox_Unload.Alert("审批提示","网络繁忙！")}).always(function(){$("#ReimburseApplication_n").css("cursor","pointer").prop("disabled",!1)})}),$(document).on("click",".refresh_days",function(){var t=$(this).parent().next(),e=$(this).parent().prev().children(".detail_td_TravelTime_1").val(),a=$(this).parent().prev().children(".detail_td_TravelTime_2").val();if(!e||!a)return!1;t.text(Number(globalCalcTimeDiff(a,e,!0).replace("天",""))+1),t.trigger("blur")}),$(document).on("blur","[class$='NonStandard_details_address'] .detail_td_Days",function(){var t,e=$(this).text().trim();reimburse_daysReg.test(e)?$(this).text(e):$(this).text(""),$(this).parents(".add_NonStandard").length?t="add":$(this).parents(".update_NonStandard").length&&(t="update"),calcDays($("."+t+"_NonStandard_details_address_table>tbody .detail_td_Days"),$("."+t+"_NonStandard_details_address_table>tfoot .insert_detail_td_calc_days"))}),$(document).on("blur","[class$='NonStandard_details_div'] .detail_td_Amount",function(){var t=$(this).text().trim();regIntOr1To2DeciPoi.test(t)?$(this).text(t):$(this).text("")}),$(document).on("click",".m_table thead .t0>input",function(){$(".m_table tbody td:nth-child(1)>input").prop("checked",$(this).prop("checked"))}),$(document).on("click",".m_table tbody td:nth-child(1)>input",function(){$(".m_table thead .t0>input").prop("checked",$(".m_table tbody td:nth-child(1)>input").length==$(".m_table tbody td:nth-child(1)>input").filter(":checked").length)}),$(".m_button_l>input:nth-child(2)").click(function(){$(this).toggleClass("btn-info btn-warning"),$(this).hasClass("btn-warning")?($(this).val("全不选"),reimburseState.exportAll=!0,$(".m_table thead .t0>input, .m_table tbody td:nth-child(1)>input").prop("checked",!0)):$(this).hasClass("btn-info")&&($(this).val("全选"),reimburseState.exportAll=!1,$(".m_table thead .t0>input, .m_table tbody td:nth-child(1)>input").prop("checked",!1))}),$(".m_button_l>input:nth-child(3)").click(function(){var t,e,a;if(reimburseState.exportAll)t=void 0;else{var i=[];if($(".m_table tbody td:nth-child(1)>input").each(function(){$(this).prop("checked")&&i.push($(this).parent().siblings(".update_td").data("iid").toString())}),0==i.length)return!1;t=i.join(",")}reimburseState.hasSearch?(e=$(".m_button_r_in_l div.btn-group>button:nth-child(1)").attr("title"),a=$(".m_button_r_in_m div.btn-group>button:nth-child(1)").attr("title")):a=e=void 0,$.ajax({type:"GET",url:"ReimburseAttachment",data:{Type:"export",ids:t,Year:e,Month:a}}).then(function(t){window.open(t)},function(){$.MsgBox_Unload.Alert("导出提示","网络繁忙或文件已被删除！")})}),$(".m_button_l>input:nth-child(4)").click(function(){window.open("ReimburseMailList")});