function pageStyle(t,e,a){a=a||"",1==e?$("#fistPage"+a+", #upPage"+a+", #nextPage"+a+", #lastPage"+a+", #Gotojump"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"):1==t?($("#fistPage"+a+", #upPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#lastPage"+a+", #nextPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):t==e?($("#lastPage"+a+", #nextPage"+a).prop("disabled","disabled").removeClass("btn-primary").addClass("btn-default"),$("#fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")):$("#lastPage"+a+", #nextPage"+a+", #fistPage"+a+", #upPage"+a+", #Gotojump"+a).prop("disabled",!1).removeClass("btn-default").addClass("btn-primary")}function Check(t){"singleSelect"==t?($(".select2").hide(),$(".select-content").css("margin-left","33%")):($(".select2").show(),$(".select-content").css("margin-left","23%"))}function INSearch(){$("#search").val("search"),$("#top_text_from").submit()}function Cancel(){window.location.href="MachineDetails"}function FistPage(t){"GetMachineDetailsRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+"1"),$("#top_text_from").submit()):window.location.href=t+"1"}function UpPage(t){"GetMachineDetailsRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t),$("#top_text_from").submit()):window.location.href=t}function NextPage(t){"GetMachineDetailsRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t),$("#top_text_from").submit()):window.location.href=t}function PageJump(t){var e=document.getElementById("jumpNumber").value;null==e||0==e?e=$("#currentPage").html():e>parseInt($("#allPage").html())&&(e=$("#allPage").html()),"GetMachineDetailsRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+e),$("#top_text_from").submit()):window.location.href=t+e}function LastPage(t){var e=parseInt($("#allPage").html());"GetMachineDetailsRoute"==t.split("?")[0]?($("#search").val("search"),$("#top_text_from").attr("action",t+e),$("#top_text_from").submit()):window.location.href=t+e}!function(){$.MsgBox={Alert:function(t,e,a){i("alert",t,e),l(a),s()},Judge:function(t,e,a){i("judge",t,e),o(a),s()},Confirm:function(t,e,a){i("confirm",t,e),l(a),s()},Prompt:function(t,e,a){i("prompt",t,e),l(a),s()},Remind:function(t,e,a){i("remind",t,e),l(a),s()}};var i=function(t,e,a){var i="";i+='<div id="mb_box"></div><div id="mb_con"><span id="mb_tit">'+e+"</span>",i+='<a id="mb_ico"></a><div id="mb_msg">'+a+'</div><div id="mb_btnbox">',"alert"==t&&(i+='<input id="mb_btn_ok" type="button" value="确定" />'),"judge"==t&&(i+='<input id="mb_jug_ok" type="button" value="确定" />'),"confirm"==t&&(i+='<input id="mb_btn_ok" type="button" value="是" />',i+='<input id="mb_btn_no" type="button" value="否" />'),"prompt"==t&&(i+='<span style="display:inline-block;width:100%;height:27px;background:#00aeef"></span>'),"remind"==t&&(i+='<span style="display:inline-block;width:100%;height:27px;background:#fff;margin-top: -1px;"></span>'),i+="</div></div>",$("body").append(i),n()},n=function(){$("#mb_box").css({width:"100%",height:"100%",zIndex:"99999",position:"fixed",filter:"Alpha(opacity=60)",backgroundColor:"rgba(10%,20%,30%,0.6)",top:"0",left:"0",opacity:"0.6"}),$("#mb_con").css({zIndex:"999999",width:"355px",height:"189px",position:"fixed",backgroundColor:"White",borderRadius:"",border:"1px solid #fff"}),$("#mb_tit").css({display:"block",fontSize:"16px",color:"#444",padding:"2px 15px",backgroundColor:"#00aeef",borderRadius:"",borderBottom:"",fontWeight:"normal",fontFamily:"microsoft yahei"}),$("#mb_msg").css({height:"60px",lineHeight:"125px",fontSize:"13px",textAlign:"center",fontSize:"16px",fontFamily:"microsoft yahei"}),$("#mb_msg p").css({height:"30px",lineHeight:"30px",width:"350px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}),$("#mb_btnbox").css({margin:"75px 0 0",textAlign:"center",background:"#00aeef",paddingTop:"1px"}),$("#mb_btn_ok,#mb_jug_ok,#mb_btn_no").css({width:"60px",height:"28px",color:"#000",border:"1px solid #fff",borderRadius:"3px",background:"#00aeef",fontSize:"14px",fontFamily:"microsoft yahei"}),$("#mb_btn_ok,#mb_jug_ok").css({backgroundColor:"#00aeef"}),$("#mb_btn_no").css({backgroundColor:"#00aeef",marginLeft:"20px"}),$("#mb_ico").hover(function(){$(this).css({backgroundColor:"Red",color:"White"})},function(){$(this).css({backgroundColor:"#DDD",color:"black"})});var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,a=$("#mb_con").width(),i=$("#mb_con").height();$("#mb_con").css({top:(e-i)/2+"px",left:(t-a)/2+"px"})},l=function(t){$("#mb_btn_ok").click(function(){$("#mb_box,#mb_con").remove(),"function"==typeof t&&t()})},o=function(t){$("#mb_jug_ok").click(function(){$("#mb_box,#mb_con").remove(),"function"==typeof t&&t()})},s=function(){$("#mb_btn_no,#mb_ico").click(function(){$("#mb_box,#mb_con").remove()})}}(),"singleSelect"==$('input[name="selected"]:checked').val()?$(".select-content").css("margin-left","33%"):$(".select-content").css("margin-left","23%"),$("#searchContent1").keypress(function(t){$("#search").val("search"),"13"==(t.keyCode?t.keyCode:t.which)&&$("#top_text_from").submit()}),$("#searchContent2").keypress(function(t){$("#search").val("search"),"13"==(t.keyCode?t.keyCode:t.which)&&$("#top_text_from").submit()}),$(document).on("click","#mb_btn_ok",function(){window.location.reload()});var MachineDetailsState=new Object;function addSearchCustomer(){var t=$("#add_infomation_CustomerUnit").val();if(""==t)return!1;var e=t.trim();if(""==e||"--"==e)return $.MsgBox_Unload.Alert("提示","客户单位搜索值为空或格式错误！"),!1;eouluGlobal.C_getCustomerUnitInfo(e,function(t){if(1<t.length){var i="";t.map(function(t,e,a){0<e&&(i+='<option data-iid="'+t.ID+'" value="'+t.CustomerName+'" data-contact="'+t.Contact+'">'+t.CustomerName+"&nbsp;:&nbsp;"+t.Contact+"</option>")}),$("#add_infomation_CustomerUnit").siblings("select[name='CustomerUnit_select']").empty().append(i).slideDown(150)}},function(){$.MsgBox_Unload.Alert("提示","网络繁忙！")},null)}function updateSearchCustomer(){var t=$("#update_infomation_CustomerUnit").val();if(""==t)return!1;var e=t.trim();if(""==e||"--"==e)return $.MsgBox_Unload.Alert("提示","客户单位搜索值为空或格式错误！"),!1;eouluGlobal.C_getCustomerUnitInfo(e,function(t){if(1<t.length){var i="";t.map(function(t,e,a){0<e&&(i+='<option data-iid="'+t.ID+'" value="'+t.CustomerName+'" data-contact="'+t.Contact+'">'+t.CustomerName+"&nbsp;:&nbsp;"+t.Contact+"</option>")}),$("#update_infomation_CustomerUnit").siblings("select[name='CustomerUnit_select']").empty().append(i).slideDown(150)}},function(){$.MsgBox_Unload.Alert("提示","网络繁忙！")},null)}MachineDetailsState.statusNumMap={"交付":"1","尾款":"2","完结":"3"},MachineDetailsState.addSubmitObj=new Object,MachineDetailsState.addSubmitObj.CustomerID=null,MachineDetailsState.addSubmitObj.classify=null,MachineDetailsState.addSubmitObj.Model=null,MachineDetailsState.addSubmitObj.SN=null,MachineDetailsState.addSubmitObj.ContractNO=null,MachineDetailsState.addSubmitObj.InstalledTime=null,MachineDetailsState.addSubmitObj.Status=null,MachineDetailsState.addSubmitObj.Responsible=null,MachineDetailsState.addSubmitObj.CurrentProgress=null,MachineDetailsState.addSubmitObj.LatestProgress=null,MachineDetailsState.updateSubmitObj=new Object,MachineDetailsState.updateSubmitObj.ID=null,MachineDetailsState.updateSubmitObj.CustomerID=null,MachineDetailsState.updateSubmitObj.classify=null,MachineDetailsState.updateSubmitObj.Model=null,MachineDetailsState.updateSubmitObj.SN=null,MachineDetailsState.updateSubmitObj.ContractNO=null,MachineDetailsState.updateSubmitObj.InstalledTime=null,MachineDetailsState.updateSubmitObj.Status=null,MachineDetailsState.updateSubmitObj.Responsible=null,MachineDetailsState.updateSubmitObj.CurrentProgress=null,MachineDetailsState.updateSubmitObj.LatestProgress=null,MachineDetailsState.modelExpiredObj={2:["EPS150","MPS150"],3:["SUMMIT","T200","PA200"],4:["CM300"]},$(function(){pageStyle(Number($("#currentPage").html()),Number($("#allPage").html()),""),"common"==$("#queryType_input").val()||"singleSelect"==$("#queryType_input").val()?$(".select2").hide():$(".select2").show();var t=new Awesomplete("#global_add_update_module_add input.form-control.dropdown-input",{minChars:0,list:["交付","尾款","完结"]});$("#global_add_update_module_add button.awesomplete_btn").click(function(){0===t.ul.childNodes.length?(t.minChars=0,t.evaluate()):t.ul.hasAttribute("hidden")?t.open():t.close()});var a=new Awesomplete("#global_add_update_module_update input.form-control.dropdown-input",{minChars:0,list:["交付","尾款","完结"]});$("#global_add_update_module_update button.awesomplete_btn").each(function(t,e){e.addEventListener("click",function(){0===a.ul.childNodes.length?(a.minChars=0,a.evaluate()):a.ul.hasAttribute("hidden")?a.open():a.close()})}),$("td.td_Status").each(function(){var i=$(this).data("ivalue");if(null==i||""==i||"--"==i)i="未选择状态";else if("1"==i){i=_.findKey(MachineDetailsState.statusNumMap,function(t,e,a){return t==i});var t=$(this).siblings(".td_InstalledTime").text(),n=$(this).siblings(".td_Model").text(),e=_.findKey(MachineDetailsState.modelExpiredObj,function(t,e,a){return!_.isNil(_.find(t,function(t,e,a){return-1<n.indexOf(t)}))});""===globalDateDataHandle(t,"")?$(this).addClass("cell_yellow").siblings(".td_InstalledTime").addClass("cell_yellow").parent().addClass("line_font_yellow"):globalCalcTimeDiff(globalGetToday(!1),t,!0).replace("天","")>e-1&&$(this).addClass("cell_yellow").siblings(".td_InstalledTime").addClass("cell_yellow").parent().addClass("line_font_yellow")}else i=_.findKey(MachineDetailsState.statusNumMap,function(t,e,a){return t==i});$(this).text(i).attr("title",i)}),$("td.td_Responsible").each(function(){var t=$(this).attr("title");null!=t&&""!=t&&"--"!=t||(t="未填写"),$(this).text(t)}),$("td.td_LatestProgress").each(function(){var t,e,a=$(this).data("ivalue");null==a||""==a||"--"==a?e=t="未填写":"object"==typeof a?(t=a[0].CurrentProgress,e=a[0].Date):"string"==typeof a&&(t=JSON.parse(a)[0].CurrentProgress,e=JSON.parse(a)[0].Date),$(this).text(t).attr("title","详情："+t+"  时间："+e)})}),$(document).on("click","[data-targetmodule]",function(){var t=$(this).data("targetmodule");if("add"==t)$("#global_add_update_module_cover, #global_add_update_module_add").slideDown(200),$("[id^='add_infomation_']").each(function(){$(this).val("")}),$("#global_add_update_module_add div.append_line_div tbody").empty();else if("update"==t){$("#global_add_update_module_cover, #global_add_update_module_update").slideDown(200),MachineDetailsState.updateSubmitObj.ID=$(this).attr("value");var a=$(this).parent(),i="";MachineDetailsState.updateSubmitObj.CustomerID=a.find(".td_CustomerID").text(),$("[id^='update_infomation_']").each(function(){var t=$(this).attr("id").replace("update_infomation_","td_");if($(this).is("#update_infomation_Status")){var i=globalDateDataHandle(a.find("."+t).data("ivalue"),""),e=_.findKey(MachineDetailsState.statusNumMap,function(t,e,a){return t==i.toString()});return _.isNil(e)&&(e=""),$(this).val(e),!0}$(this).val(globalDateDataHandle(a.find("."+t).attr("title"),""))});var e=a.find(".td_CurrentProgress").text();_.isNil(e)||""==e?i="":JSON.parse(a.find(".td_CurrentProgress").text()).map(function(t,e,a){0<e&&(i+='<tr><td class="xuhao" value="'+t.ID+'"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span><span class="span_num">'+e+'</span></td><td class="progress_detail" contenteditable="true">'+t.CurrentProgress+'</td><td class="progress_detail_time"><input type="date" class="form-control" value="'+t.Date+'"></td></tr>')}),$("#global_add_update_module_update div.append_line_div tbody").empty().append(i)}}),$(document).on("click",".global_add_update_module_title>span.glyphicon, .global_add_update_module_cancel",function(){var t=$(this).parents("[data-parents='addANDupdate']");if($("#global_add_update_module_cover").slideUp(200),t.slideUp(200),"add"==t.data("classify"))for(var e in MachineDetailsState.addSubmitObj)MachineDetailsState.addSubmitObj[e]=null;else if("update"==t.data("classify"))for(var a in MachineDetailsState.updateSubmitObj)MachineDetailsState.updateSubmitObj[a]=null}),$(document).on("click",".global_add_update_module_submit",function(){var e,t=$(this).parents("[data-parents='addANDupdate']"),a=$(this),i={};if("add"==t.data("classify")){for(var n in MachineDetailsState.addSubmitObj)"classify"!=n?"CustomerID"!=n&&"CurrentProgress"!=n&&"LatestProgress"!=n&&(MachineDetailsState.addSubmitObj[n]="Status"!=n?$("#add_infomation_"+n).val():_.find(MachineDetailsState.statusNumMap,function(t,e,a){return e==$("#add_infomation_Status").val().trim()})):MachineDetailsState.addSubmitObj[n]="Add";for(var l in MachineDetailsState.addSubmitObj){if(MachineDetailsState.addSubmitObj[l]=globalDataHandle(MachineDetailsState.addSubmitObj[l],"").toString().trim(),"CustomerID"==l&&""==MachineDetailsState.addSubmitObj[l])return $.MsgBox_Unload.Alert("提示","未选择客户单位！"),!1;if("Status"==l&&""==MachineDetailsState.addSubmitObj[l])return $.MsgBox_Unload.Alert("提示","项目状态未填或错误！"),!1}var o=$("#global_add_update_module_add .append_line_div tbody>tr");if(0==o.length)return $.MsgBox_Unload.Alert("提示","请至少添加一条详情！"),!1;if(""==$("#global_add_update_module_add .append_line_div tbody>tr:last").find(".progress_detail").text().trim())return $.MsgBox_Unload.Alert("提示","最新进展未填写内容！"),!1;eouluGlobal.C_btnDisabled(a,!0,"正在提交...");var s=[];o.each(function(){var t={};t.CurrentProgress=$(this).find(".progress_detail").text().trim(),t.Date=$(this).find(".progress_detail_time>input").val(),s.push(t)});var d=[];d.push(_.last(s)),MachineDetailsState.addSubmitObj.LatestProgress=JSON.stringify(d),MachineDetailsState.addSubmitObj.CurrentProgress=JSON.stringify(s),i=MachineDetailsState.addSubmitObj,e="添加"}else if("update"==t.data("classify")){for(var u in MachineDetailsState.updateSubmitObj)"classify"!=u?"ID"!=u&&"CustomerID"!=u&&"CurrentProgress"!=u&&"LatestProgress"!=u&&(MachineDetailsState.updateSubmitObj[u]="Status"!=u?$("#update_infomation_"+u).val():_.find(MachineDetailsState.statusNumMap,function(t,e,a){return e==$("#update_infomation_Status").val().trim()})):MachineDetailsState.updateSubmitObj[u]="Modify";for(var r in MachineDetailsState.updateSubmitObj){if(MachineDetailsState.updateSubmitObj[r]=globalDataHandle(MachineDetailsState.updateSubmitObj[r],"").toString().trim(),"CustomerID"==r&&""==MachineDetailsState.updateSubmitObj[r])return $.MsgBox_Unload.Alert("提示","未选择客户单位！"),!1;if("Status"==r&&""==MachineDetailsState.updateSubmitObj[r])return $.MsgBox_Unload.Alert("提示","项目状态未填或错误！"),!1}var c=$("#global_add_update_module_update .append_line_div tbody>tr");if(0==c.length)return $.MsgBox_Unload.Alert("提示","请至少添加一条详情！"),!1;if(""==$("#global_add_update_module_update .append_line_div tbody>tr:last").find(".progress_detail").text().trim())return $.MsgBox_Unload.Alert("提示","最新进展未填写内容！"),!1;eouluGlobal.C_btnDisabled(a,!0,"正在提交...");var p=[];c.each(function(){var t={};t.CurrentProgress=$(this).find(".progress_detail").text().trim(),t.Date=$(this).find(".progress_detail_time>input").val(),p.push(t)});var m=[];m.push(_.last(p)),MachineDetailsState.updateSubmitObj.LatestProgress=JSON.stringify(m),MachineDetailsState.updateSubmitObj.CurrentProgress=JSON.stringify(p),i=MachineDetailsState.updateSubmitObj,e="修改"}$.ajax({type:"POST",url:"MachineDetailsOperate",data:i,dataType:"json"}).then(function(t){$.MsgBox.Alert("提示",e+"成功！")},function(){$.MsgBox_Unload.Alert("提示","服务器繁忙！")}).always(function(){eouluGlobal.C_btnAbled(a,!0,"提交")})}),$(".global_add_update_module span.append_line").click(function(){var t=$(this).parent().next().find("tbody"),e='<tr><td class="xuhao"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span><span class="span_num">'+(t.children("tr").length+1)+'</span></td><td class="progress_detail" contenteditable="true"></td><td class="progress_detail_time"><input type="date" class="form-control" value="'+globalGetToday(!1)+'"></td></tr>';t.append(e)}),$(document).on("click","div.append_line_div .xuhao>span.glyphicon",function(){var t=$(this).parents("tbody");$(this).parent().parent().remove(),t.children("tr").each(function(t,e){$(e).find("span.span_num").text(t+1)})}),$("#add_infomation_CustomerUnit").on("input propertychange",_.debounce(addSearchCustomer,350,{maxWait:1e3})),$("#update_infomation_CustomerUnit").on("input propertychange",_.debounce(updateSearchCustomer,350,{maxWait:1e3})),$(document).on("click","select[name='CustomerUnit_select']>option",function(t){t.stopPropagation(),$(this).parent().siblings("input[type='text']").val($(this).val()).parents("[data-parents='addANDupdate']").find("input[data-customername]").val($(this).data("contact")),$(this).parent().slideUp(150);var e=$(this).parents("[data-parents='addANDupdate']").data("classify"),a=$(this).data("iid");"add"==e?MachineDetailsState.addSubmitObj.CustomerID=a:"update"==e&&(MachineDetailsState.updateSubmitObj.CustomerID=a)}),$("div.form-group.has-feedback>div.col-sm-9>.form-control-feedback").click(function(){$(this).prev().val("").siblings("select[name='CustomerUnit_select']").slideUp(150);var t=$(this).parents("[data-parents='addANDupdate']").data("classify");"add"==t?(MachineDetailsState.addSubmitObj.CustomerID=null,$("#add_infomation_CustomerName").val("")):"update"==t&&(MachineDetailsState.updateSubmitObj.CustomerID=null,$("#update_infomation_CustomerName").val(""))}),$(document).on("click",function(){$("select[name='CustomerUnit_select']").slideUp(150)});